Loading profile from flag: supabase
Supabase CLI 2.72.8
Using profile: supabase (supabase.co)
Loading project ref from file: supabase\.temp\project-ref
 storage Skipped - Image is already present locally 
 imgProxy Skipped - Image is already present locally 
 pgmeta Skipped - Image is already present locally 
 analytics Skipped - Image is already present locally 
 vector Skipped - Image is already present locally 
 db Skipped - Image is already present locally 
 gateway Skipped - Image is already present locally 
 auth Skipped - Image is already present locally 
 mailpit Skipped - Image is already present locally 
 realtime Skipped - Image is already present locally 
 studio Skipped - Image is already present locally 
 api Skipped - Image is already present locally 
 edgeRuntime Skipped - Image is already present locally 
Starting database...
2026/01/28 15:06:05 PG Send: {"Type":"StartupMessage","ProtocolVersion":196608,"Parameters":{"database":"postgres","user":"postgres"}}
2026/01/28 15:06:05 PG Recv: {"Type":"AuthenticationSASL","AuthMechanisms":["SCRAM-SHA-256"]}
2026/01/28 15:06:05 PG Send: {"Type":"SASLInitialResponse","AuthMechanism":"SCRAM-SHA-256","Data":"n,,n=,r=E5Ffu1KVTAudEiKzRN8e2uwZ"}
2026/01/28 15:06:05 PG Recv: {"Type":"AuthenticationSASLContinue","Data":"r=E5Ffu1KVTAudEiKzRN8e2uwZXTg9EQzr7T6k5DjL75KYUfsk,s=LzmlwfWTmrlu6WJzjq6d5A==,i=4096"}
2026/01/28 15:06:05 PG Send: {"Type":"SASLResponse","Data":"c=biws,r=E5Ffu1KVTAudEiKzRN8e2uwZXTg9EQzr7T6k5DjL75KYUfsk,p=pCG3Vw3tFLd5RUbQqq7Kh90Mps3bxTtXS1KLAAqIosk="}
2026/01/28 15:06:05 PG Recv: {"Type":"AuthenticationSASLFinal","Data":"v=JTUHxf8OWT2ge1pG0U1C8RfzDz3Ot8PlX8nEVMTvetY="}
2026/01/28 15:06:05 PG Recv: {"Type":"AuthenticationOK"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"in_hot_standby","Value":"off"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"integer_datetimes","Value":"on"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"TimeZone","Value":"UTC"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"IntervalStyle","Value":"postgres"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"is_superuser","Value":"off"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"application_name","Value":""}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"default_transaction_read_only","Value":"off"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"scram_iterations","Value":"4096"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"DateStyle","Value":"ISO, MDY"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"standard_conforming_strings","Value":"on"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"session_authorization","Value":"postgres"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"client_encoding","Value":"UTF8"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"server_version","Value":"17.6"}
2026/01/28 15:06:05 PG Recv: {"Type":"ParameterStatus","Name":"server_encoding","Value":"UTF8"}
2026/01/28 15:06:05 PG Recv: {"Type":"BackendKeyData","ProcessID":225,"SecretKey":1655557392}
2026/01/28 15:06:05 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Initialising schema...
+ ulimit -n
+ '[' '!' -z '' ']'
+ export ERL_CRASH_DUMP=/tmp/erl_crash.dump
+ ERL_CRASH_DUMP=/tmp/erl_crash.dump
+ '[' false = true ']'
+ [[ -n '' ]]
+ echo 'Running migrations'
+ sudo -E -u nobody /app/bin/migrate
+ '[' true = true ']'
+ echo 'Seeding selfhosted Realtime'
+ sudo -E -u nobody /app/bin/realtime eval 'Realtime.Release.seeds(Realtime.Repo)'
[os_mon] memory supervisor port (memsup): Erlang has closed
[os_mon] cpu supervisor port (cpu_sup): Erlang has closed
+ echo 'Starting Realtime'
+ ulimit -n
+ exec /app/bin/realtime eval '{:ok, _} = Application.ensure_all_started(:realtime)
{:ok, _} = Realtime.Tenants.health_check("realtime-dev")'
[os_mon] cpu supervisor port (cpu_sup): Erlang has closed
[os_mon] memory supervisor port (memsup): Erlang has closed
Seeding globals from roles.sql...
Skipping migration 20260128140341_rpc_signature_align.sql.bak.20260128_144819... (file name must match pattern "<timestamp>_name.sql")
Skipping migration 20260128140341_rpc_signature_align.sql.bak.20260128_145248... (file name must match pattern "<timestamp>_name.sql")
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"SET lock_timeout = '4s'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"CREATE SCHEMA IF NOT EXISTS supabase_migrations","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"CREATE TABLE IF NOT EXISTS supabase_migrations.schema_migrations (version text NOT NULL PRIMARY KEY)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE supabase_migrations.schema_migrations ADD COLUMN IF NOT EXISTS statements text[]","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"ALTER TABLE supabase_migrations.schema_migrations ADD COLUMN IF NOT EXISTS name text","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE SCHEMA"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123025325_placeholder.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder to match remote migration history (no-op)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123025325"},{"text":"placeholder"},{"binary":"0000000100000000000000190000000100000001000000382d2d20706c616365686f6c64657220746f206d617463682072656d6f7465206d6967726174696f6e20686973746f727920286e6f2d6f7029"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"EmptyQueryResponse"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123100000_000_core_schema.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"begin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create extension if not exists pgcrypto","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Enums (idempotent)\ndo $m$\nbegin\n  if not exists (\n    select 1\n    from pg_type t\n    join pg_namespace n on n.oid = t.typnamespace\n    where n.nspname = 'public' and t.typname = 'subscription_status'\n  ) then\n    create type public.subscription_status as enum ('pending','trialing','active','past_due','canceled','locked');\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $m$\nbegin\n  if not exists (\n    select 1\n    from pg_type t\n    join pg_namespace n on n.oid = t.typnamespace\n    where n.nspname = 'public' and t.typname = 'subscription_tier'\n  ) then\n    create type public.subscription_tier as enum ('free','core');\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Tenants\ncreate table if not exists public.tenants (\n  id uuid primary key default gen_random_uuid(),\n  workspace_name text not null,\n  workspace_name_lc text generated always as (lower(workspace_name)) stored,\n  subscription_tier public.subscription_tier not null default 'free',\n  subscription_status public.subscription_status not null default 'pending',\n  trial_started_at timestamptz,\n  trial_ends_at timestamptz,\n  seats_limit int not null default 1,\n  created_at timestamptz not null default now(),\n  updated_at timestamptz not null default now(),\n  deleted_at timestamptz\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create unique index if not exists tenants_workspace_name_lc_ux\n  on public.tenants (workspace_name_lc)\n  where deleted_at is null","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Memberships\ncreate table if not exists public.tenant_memberships (\n  tenant_id uuid not null references public.tenants(id) on delete cascade,\n  user_id uuid not null,\n  role text not null check (role in ('owner','member')),\n  created_at timestamptz not null default now(),\n  primary key (tenant_id, user_id)\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- User profiles (for current_tenant_id)\ncreate table if not exists public.user_profiles (\n  user_id uuid primary key,\n  current_tenant_id uuid references public.tenants(id),\n  created_at timestamptz not null default now(),\n  updated_at timestamptz not null default now()\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Deals (minimal)\ncreate table if not exists public.deals (\n  id uuid primary key default gen_random_uuid(),\n  tenant_id uuid not null references public.tenants(id) on delete cascade,\n  status text not null default 'New',\n  row_version int not null default 1,\n  payload jsonb not null default '{}'::jsonb,\n  created_at timestamptz not null default now(),\n  updated_at timestamptz not null default now()\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $m$\nbegin\n  if not exists (select 1 from pg_constraint where conname = 'deals_status_check') then\n    alter table public.deals\n      add constraint deals_status_check\n      check (status in ('New','Contacted','Qualified','Under Contract','Closed','Dead'));\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Audit log (minimal)\ncreate table if not exists public.audit_log (\n  id bigserial primary key,\n  tenant_id uuid,\n  actor_user_id uuid,\n  action text not null,\n  entity_type text,\n  entity_id uuid,\n  meta jsonb not null default '{}'::jsonb,\n  created_at timestamptz not null default now()\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Invites (minimal, to avoid downstream missing-table failures)\ncreate table if not exists public.invites (\n  id uuid primary key default gen_random_uuid(),\n  tenant_id uuid not null references public.tenants(id) on delete cascade,\n  invited_email text not null,\n  invited_email_lc text,\n  token text,\n  token_hash text,\n  revoked_at timestamptz,\n  accepted_at timestamptz,\n  created_at timestamptz not null default now(),\n  created_by uuid\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123100000"},{"text":"000_core_schema"},{"binary":"0000000100000000000000190000000d0000000100000005626567696e0000002763726561746520657874656e73696f6e206966206e6f742065786973747320706763727970746f000001592d2d20456e756d7320286964656d706f74656e74290a646f20246d240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f7479706520740a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e7479706e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c69632720616e6420742e7479706e616d65203d2027737562736372697074696f6e5f737461747573270a202029207468656e0a202020206372656174652074797065207075626c69632e737562736372697074696f6e5f73746174757320617320656e756d20282770656e64696e67272c27747269616c696e67272c27616374697665272c27706173745f647565272c2763616e63656c6564272c276c6f636b656427293b0a2020656e642069663b0a656e640a246d2400000110646f20246d240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f7479706520740a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e7479706e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c69632720616e6420742e7479706e616d65203d2027737562736372697074696f6e5f74696572270a202029207468656e0a202020206372656174652074797065207075626c69632e737562736372697074696f6e5f7469657220617320656e756d20282766726565272c27636f726527293b0a2020656e642069663b0a656e640a246d24000002472d2d2054656e616e74730a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e747320280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a2020776f726b73706163655f6e616d652074657874206e6f74206e756c6c2c0a2020776f726b73706163655f6e616d655f6c6320746578742067656e65726174656420616c7761797320617320286c6f77657228776f726b73706163655f6e616d6529292073746f7265642c0a2020737562736372697074696f6e5f74696572207075626c69632e737562736372697074696f6e5f74696572206e6f74206e756c6c2064656661756c74202766726565272c0a2020737562736372697074696f6e5f737461747573207075626c69632e737562736372697074696f6e5f737461747573206e6f74206e756c6c2064656661756c74202770656e64696e67272c0a2020747269616c5f737461727465645f61742074696d657374616d70747a2c0a2020747269616c5f656e64735f61742074696d657374616d70747a2c0a202073656174735f6c696d697420696e74206e6f74206e756c6c2064656661756c7420312c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757064617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a202064656c657465645f61742074696d657374616d70747a0a290000008163726561746520756e6971756520696e646578206966206e6f74206578697374732074656e616e74735f776f726b73706163655f6e616d655f6c635f75780a20206f6e207075626c69632e74656e616e74732028776f726b73706163655f6e616d655f6c63290a202077686572652064656c657465645f6174206973206e756c6c000001382d2d204d656d62657273686970730a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e745f6d656d626572736869707320280a202074656e616e745f69642075756964206e6f74206e756c6c207265666572656e636573207075626c69632e74656e616e747328696429206f6e2064656c65746520636173636164652c0a2020757365725f69642075756964206e6f74206e756c6c2c0a2020726f6c652074657874206e6f74206e756c6c20636865636b2028726f6c6520696e2028276f776e6572272c276d656d6265722729292c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a20207072696d617279206b6579202874656e616e745f69642c20757365725f6964290a29000001112d2d20557365722070726f66696c65732028666f722063757272656e745f74656e616e745f6964290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e757365725f70726f66696c657320280a2020757365725f69642075756964207072696d617279206b65792c0a202063757272656e745f74656e616e745f69642075756964207265666572656e636573207075626c69632e74656e616e7473286964292c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757064617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728290a29000001952d2d204465616c7320286d696e696d616c290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e6465616c7320280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a202074656e616e745f69642075756964206e6f74206e756c6c207265666572656e636573207075626c69632e74656e616e747328696429206f6e2064656c65746520636173636164652c0a20207374617475732074657874206e6f74206e756c6c2064656661756c7420274e6577272c0a2020726f775f76657273696f6e20696e74206e6f74206e756c6c2064656661756c7420312c0a20207061796c6f6164206a736f6e62206e6f74206e756c6c2064656661756c7420277b7d273a3a6a736f6e622c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757064617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728290a2900000115646f20246d240a626567696e0a20206966206e6f7420657869737473202873656c65637420312066726f6d2070675f636f6e73747261696e7420776865726520636f6e6e616d65203d20276465616c735f7374617475735f636865636b2729207468656e0a20202020616c746572207461626c65207075626c69632e6465616c730a20202020202061646420636f6e73747261696e74206465616c735f7374617475735f636865636b0a202020202020636865636b202873746174757320696e2028274e6577272c27436f6e746163746564272c275175616c6966696564272c27556e64657220436f6e7472616374272c27436c6f736564272c27446561642729293b0a2020656e642069663b0a656e640a246d24000001232d2d204175646974206c6f6720286d696e696d616c290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e61756469745f6c6f6720280a202069642062696773657269616c207072696d617279206b65792c0a202074656e616e745f696420757569642c0a20206163746f725f757365725f696420757569642c0a2020616374696f6e2074657874206e6f74206e756c6c2c0a2020656e746974795f7479706520746578742c0a2020656e746974795f696420757569642c0a20206d657461206a736f6e62206e6f74206e756c6c2064656661756c7420277b7d273a3a6a736f6e622c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728290a29000001bb2d2d20496e766974657320286d696e696d616c2c20746f2061766f696420646f776e73747265616d206d697373696e672d7461626c65206661696c75726573290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e696e766974657320280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a202074656e616e745f69642075756964206e6f74206e756c6c207265666572656e636573207075626c69632e74656e616e747328696429206f6e2064656c65746520636173636164652c0a2020696e76697465645f656d61696c2074657874206e6f74206e756c6c2c0a2020696e76697465645f656d61696c5f6c6320746578742c0a2020746f6b656e20746578742c0a2020746f6b656e5f6861736820746578742c0a20207265766f6b65645f61742074696d657374616d70747a2c0a202061636365707465645f61742074696d657374616d70747a2c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020637265617465645f627920757569640a2900000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42710","Message":"extension \"pgcrypto\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"extension.c","Line":1791,"Routine":"CreateExtension","UnknownFields":null}
NOTICE (42710): extension "pgcrypto" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE EXTENSION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123121839_placeholder.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder: exists only to satisfy supabase CLI migration history alignment\n-- remote version 20260123121839 was a snapshot migration previously moved out of migrations\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123121839"},{"text":"placeholder"},{"binary":"0000000100000000000000190000000100000001000000b52d2d20706c616365686f6c6465723a20657869737473206f6e6c7920746f207361746973667920737570616261736520434c49206d6967726174696f6e20686973746f727920616c69676e6d656e740a2d2d2072656d6f74652076657273696f6e20323032363031323331323138333920776173206120736e617073686f74206d6967726174696f6e2070726576696f75736c79206d6f766564206f7574206f66206d6967726174696f6e730a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123131850_001_provision_upgrade_save.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Provision tenant + seed first deal (atomic, idempotent)\n-- Server-authenticated (authenticated), never anon.\n\ncreate or replace function public.provision_upgrade_save(\n  p_workspace_name text,\n  p_first_deal jsonb default '{}'::jsonb\n)\nreturns table(tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_user_id uuid := auth.uid();\n  v_tenant_id uuid;\n  v_deal_id uuid;\nbegin\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  -- Idempotent: if user already owns a tenant, reuse it\n  select tm.tenant_id\n    into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = v_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  if v_tenant_id is null then\n    insert into public.tenants (name, subscription_status, subscription_tier)\n    values (coalesce(nullif(p_workspace_name,''), 'Workspace'), 'trialing', 'core')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, v_user_id, 'owner');\n  end if;\n\n  -- Seed first deal (safe defaults)\n  insert into public.deals (\n    tenant_id,\n    status\n  )\n  values (\n    v_tenant_id,\n    'lead'\n  )\n  returning id into v_deal_id;\n\n  return query select v_tenant_id, v_deal_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.provision_upgrade_save(text, jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.provision_upgrade_save(text, jsonb) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123131850"},{"text":"001_provision_upgrade_save"},{"binary":"0000000100000000000000190000000300000001000005362d2d2050726f766973696f6e2074656e616e74202b2073656564206669727374206465616c202861746f6d69632c206964656d706f74656e74290a2d2d205365727665722d61757468656e74696361746564202861757468656e74696361746564292c206e6576657220616e6f6e2e0a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f73617665280a2020705f776f726b73706163655f6e616d6520746578742c0a2020705f66697273745f6465616c206a736f6e622064656661756c7420277b7d273a3a6a736f6e620a290a72657475726e73207461626c652874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f757365725f69642075756964203a3d20617574682e75696428293b0a2020765f74656e616e745f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a20202d2d204964656d706f74656e743a206966207573657220616c7265616479206f776e7320612074656e616e742c2072657573652069740a202073656c65637420746d2e74656e616e745f69640a20202020696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20765f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e747320286e616d652c20737562736372697074696f6e5f7374617475732c20737562736372697074696f6e5f74696572290a2020202076616c7565732028636f616c65736365286e756c6c696628705f776f726b73706163655f6e616d652c2727292c2027576f726b737061636527292c2027747269616c696e67272c2027636f726527290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20765f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a20202d2d2053656564206669727374206465616c2028736166652064656661756c7473290a2020696e7365727420696e746f207075626c69632e6465616c7320280a2020202074656e616e745f69642c0a202020207374617475730a2020290a202076616c75657320280a20202020765f74656e616e745f69642c0a20202020276c656164270a2020290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202072657475726e2071756572792073656c65637420765f74656e616e745f69642c20765f6465616c5f69643b0a656e643b0a2466756e6374696f6e240000004d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e62292066726f6d207075626c6963000000556772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e622920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123133122_002_admin_provision_upgrade_save.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.admin_provision_upgrade_save(\n  p_user_id uuid,\n  p_workspace_name text,\n  p_first_deal jsonb default '{}'::jsonb\n)\nreturns table(tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_tenant_id uuid;\n  v_deal_id uuid;\nbegin\n  if auth.role() \u003c\u003e 'service_role' then\n    raise exception 'SERVICE_ROLE_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  if p_user_id is null then\n    raise exception 'USER_ID_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  select tm.tenant_id\n    into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = p_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  if v_tenant_id is null then\n    insert into public.tenants (name, subscription_status, subscription_tier)\n    values (coalesce(nullif(p_workspace_name,''), 'Workspace'), 'trialing', 'core')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, p_user_id, 'owner');\n  end if;\n\n  insert into public.deals (tenant_id, status)\n  values (v_tenant_id, 'lead')\n  returning id into v_deal_id;\n\n  return query select v_tenant_id, v_deal_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.admin_provision_upgrade_save(uuid, text, jsonb) to service_role","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123133122"},{"text":"002_admin_provision_upgrade_save"},{"binary":"0000000100000000000000190000000500000001000004c2637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f73617665280a2020705f757365725f696420757569642c0a2020705f776f726b73706163655f6e616d6520746578742c0a2020705f66697273745f6465616c206a736f6e622064656661756c7420277b7d273a3a6a736f6e620a290a72657475726e73207461626c652874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620617574682e726f6c652829203c3e2027736572766963655f726f6c6527207468656e0a20202020726169736520657863657074696f6e2027534552564943455f524f4c455f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a2020696620705f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027555345525f49445f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a202073656c65637420746d2e74656e616e745f69640a20202020696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20705f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e747320286e616d652c20737562736372697074696f6e5f7374617475732c20737562736372697074696f6e5f74696572290a2020202076616c7565732028636f616c65736365286e756c6c696628705f776f726b73706163655f6e616d652c2727292c2027576f726b737061636527292c2027747269616c696e67272c2027636f726527290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20705f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c20737461747573290a202076616c7565732028765f74656e616e745f69642c20276c65616427290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202072657475726e2071756572792073656c65637420765f74656e616e745f69642c20765f6465616c5f69643b0a656e643b0a2466756e6374696f6e24000000597265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d207075626c6963000000607265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d2061757468656e74696361746564000000577265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d20616e6f6e000000606772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e622920746f20736572766963655f726f6c65"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123133902_placeholder.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder to match remote migration history (no-op)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123133902"},{"text":"placeholder"},{"binary":"0000000100000000000000190000000100000001000000382d2d20706c616365686f6c64657220746f206d617463682072656d6f7465206d6967726174696f6e20686973746f727920286e6f2d6f7029"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"EmptyQueryResponse"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260123134339_005_fix_seed_status_value.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.provision_upgrade_save(\n  p_workspace_name text,\n  p_first_deal jsonb default '{}'::jsonb\n)\nreturns table(tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_user_id uuid := auth.uid();\n  v_tenant_id uuid;\n  v_deal_id uuid;\nbegin\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  select tm.tenant_id into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = v_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  if v_tenant_id is null then\n    insert into public.tenants (name, subscription_status, subscription_tier)\n    values (coalesce(nullif(p_workspace_name,''), 'Workspace'), 'trialing', 'core')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, v_user_id, 'owner');\n  end if;\n\n  insert into public.deals (tenant_id, status, market_area)\n  values (v_tenant_id, 'New', 'default')\n  returning id into v_deal_id;\n\n  return query select v_tenant_id, v_deal_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.provision_upgrade_save(text, jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.provision_upgrade_save(text, jsonb) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.admin_provision_upgrade_save(\n  p_user_id uuid,\n  p_workspace_name text,\n  p_first_deal jsonb default '{}'::jsonb\n)\nreturns table(tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_tenant_id uuid;\n  v_deal_id uuid;\nbegin\n  if auth.role() \u003c\u003e 'service_role' then\n    raise exception 'SERVICE_ROLE_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  if p_user_id is null then\n    raise exception 'USER_ID_REQUIRED' using errcode = 'P0001';\n  end if;\n\n  select tm.tenant_id into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = p_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  if v_tenant_id is null then\n    insert into public.tenants (name, subscription_status, subscription_tier)\n    values (coalesce(nullif(p_workspace_name,''), 'Workspace'), 'trialing', 'core')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, p_user_id, 'owner');\n  end if;\n\n  insert into public.deals (tenant_id, status, market_area)\n  values (v_tenant_id, 'New', 'default')\n  returning id into v_deal_id;\n\n  return query select v_tenant_id, v_deal_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.admin_provision_upgrade_save(uuid, text, jsonb) from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.admin_provision_upgrade_save(uuid, text, jsonb) to service_role","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260123134339"},{"text":"005_fix_seed_status_value"},{"binary":"000000010000000000000019000000080000000100000462637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f73617665280a2020705f776f726b73706163655f6e616d6520746578742c0a2020705f66697273745f6465616c206a736f6e622064656661756c7420277b7d273a3a6a736f6e620a290a72657475726e73207461626c652874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f757365725f69642075756964203a3d20617574682e75696428293b0a2020765f74656e616e745f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a202073656c65637420746d2e74656e616e745f696420696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20765f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e747320286e616d652c20737562736372697074696f6e5f7374617475732c20737562736372697074696f6e5f74696572290a2020202076616c7565732028636f616c65736365286e756c6c696628705f776f726b73706163655f6e616d652c2727292c2027576f726b737061636527292c2027747269616c696e67272c2027636f726527290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20765f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c207374617475732c206d61726b65745f61726561290a202076616c7565732028765f74656e616e745f69642c20274e6577272c202764656661756c7427290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202072657475726e2071756572792073656c65637420765f74656e616e745f69642c20765f6465616c5f69643b0a656e643b0a2466756e6374696f6e240000004d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e62292066726f6d207075626c6963000000556772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e622920746f2061757468656e74696361746564000004d5637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f73617665280a2020705f757365725f696420757569642c0a2020705f776f726b73706163655f6e616d6520746578742c0a2020705f66697273745f6465616c206a736f6e622064656661756c7420277b7d273a3a6a736f6e620a290a72657475726e73207461626c652874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620617574682e726f6c652829203c3e2027736572766963655f726f6c6527207468656e0a20202020726169736520657863657074696f6e2027534552564943455f524f4c455f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a2020696620705f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027555345525f49445f524551554952454427207573696e6720657272636f6465203d20275030303031273b0a2020656e642069663b0a0a202073656c65637420746d2e74656e616e745f696420696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20705f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e747320286e616d652c20737562736372697074696f6e5f7374617475732c20737562736372697074696f6e5f74696572290a2020202076616c7565732028636f616c65736365286e756c6c696628705f776f726b73706163655f6e616d652c2727292c2027576f726b737061636527292c2027747269616c696e67272c2027636f726527290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20705f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c207374617475732c206d61726b65745f61726561290a202076616c7565732028765f74656e616e745f69642c20274e6577272c202764656661756c7427290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202072657475726e2071756572792073656c65637420765f74656e616e745f69642c20765f6465616c5f69643b0a656e643b0a2466756e6374696f6e24000000597265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d207075626c6963000000607265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d2061757468656e74696361746564000000577265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e62292066726f6d20616e6f6e000000606772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e61646d696e5f70726f766973696f6e5f757067726164655f7361766528757569642c20746578742c206a736f6e622920746f20736572766963655f726f6c65"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124000000_000_current_tenant_id.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Core context helpers (must exist before entitlements/functions that reference them)\n\ncreate or replace function public.current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nset search_path = public, auth\nas $function$\n  select coalesce(\n    nullif(auth.jwt()-\u003e\u003e'tenant_id','')::uuid,\n    nullif(current_setting('app.tenant_id', true),'')::uuid\n  );\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.current_tenant_id() to anon, authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124000000"},{"text":"000_current_tenant_id"},{"binary":"0000000100000000000000190000000200000001000001692d2d20436f726520636f6e746578742068656c7065727320286d757374206578697374206265666f726520656e7469746c656d656e74732f66756e6374696f6e732074686174207265666572656e6365207468656d290a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a202073656c65637420636f616c65736365280a202020206e756c6c696628617574682e6a777428292d3e3e2774656e616e745f6964272c2727293a3a757569642c0a202020206e756c6c69662863757272656e745f73657474696e6728276170702e74656e616e745f6964272c2074727565292c2727293a3a757569640a2020293b0a2466756e6374696f6e240000004b6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f6964282920746f20616e6f6e2c2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124000005_000_tenant_context_functions.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Tenant context helpers (required by documents RLS)\n\ncreate or replace function public.current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $m$\n  select coalesce(\n    nullif(auth.jwt()-\u003e\u003e'tenant_id','')::uuid,\n    nullif(current_setting('app.tenant_id', true),'')::uuid\n  );\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.tenant_write_allowed(p_tenant_id uuid)\nreturns boolean\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $m$\n  select\n    p_tenant_id is not null\n    and exists (select 1 from public.tenants t where t.id = p_tenant_id)\n    and exists (\n      select 1\n      from public.tenant_memberships tm\n      where tm.tenant_id = p_tenant_id\n        and tm.user_id = auth.uid()\n    );\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.can_write_current_tenant()\nreturns boolean\nlanguage sql\nstable\nas $m$\n  select public.tenant_write_allowed(public.current_tenant_id());\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.current_tenant_id() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.tenant_write_allowed(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.can_write_current_tenant() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124000005"},{"text":"000_tenant_context_functions"},{"binary":"00000001000000000000001900000006000000010000011b2d2d2054656e616e7420636f6e746578742068656c706572732028726571756972656420627920646f63756d656e747320524c53290a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a617320246d240a202073656c65637420636f616c65736365280a202020206e756c6c696628617574682e6a777428292d3e3e2774656e616e745f6964272c2727293a3a757569642c0a202020206e756c6c69662863757272656e745f73657474696e6728276170702e74656e616e745f6964272c2074727565292c2727293a3a757569640a2020293b0a246d24000001af637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e74656e616e745f77726974655f616c6c6f77656428705f74656e616e745f69642075756964290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a617320246d240a202073656c6563740a20202020705f74656e616e745f6964206973206e6f74206e756c6c0a20202020616e6420657869737473202873656c65637420312066726f6d207075626c69632e74656e616e7473207420776865726520742e6964203d20705f74656e616e745f6964290a20202020616e642065786973747320280a20202020202073656c65637420310a20202020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a202020202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a2020202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a20202020293b0a246d24000000ad637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63616e5f77726974655f63757272656e745f74656e616e7428290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a617320246d240a202073656c656374207075626c69632e74656e616e745f77726974655f616c6c6f776564287075626c69632e63757272656e745f74656e616e745f69642829293b0a246d24000000456772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f6964282920746f2061757468656e746963617465640000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e74656e616e745f77726974655f616c6c6f77656428757569642920746f2061757468656e746963617465640000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e63616e5f77726974655f63757272656e745f74656e616e74282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124000006_001_tenant_seats_cols.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Tenants: seat_limit + seat_count (needed by get_current_tenant_seats + seat enforcement)\n\nalter table public.tenants\n  add column if not exists seat_limit int not null default 100,\n  add column if not exists seat_count int not null default 0","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Backfill seat_count from memberships\nupdate public.tenants t\nset seat_count = coalesce(m.cnt, 0)\nfrom (\n  select tenant_id, count(*)::int as cnt\n  from public.tenant_memberships\n  group by tenant_id\n) m\nwhere m.tenant_id = t.id","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"update public.tenants set seat_count = 0 where seat_count is null","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Keep seat_count in sync\ncreate or replace function public._sync_tenant_seat_count()\nreturns trigger\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $m$\ndeclare\n  v_tenant_id uuid := coalesce(new.tenant_id, old.tenant_id);\nbegin\n  update public.tenants t\n  set seat_count = (\n    select count(*)::int\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tenant_id\n  )\n  where t.id = v_tenant_id;\n\n  return null;\nend;\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop trigger if exists trg_sync_tenant_seat_count_ins on public.tenant_memberships","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop trigger if exists trg_sync_tenant_seat_count_del on public.tenant_memberships","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create trigger trg_sync_tenant_seat_count_ins\nafter insert on public.tenant_memberships\nfor each row execute function public._sync_tenant_seat_count()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create trigger trg_sync_tenant_seat_count_del\nafter delete on public.tenant_memberships\nfor each row execute function public._sync_tenant_seat_count()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124000006"},{"text":"001_tenant_seats_cols"},{"binary":"0000000100000000000000190000000800000001000000f42d2d2054656e616e74733a20736561745f6c696d6974202b20736561745f636f756e7420286e6565646564206279206765745f63757272656e745f74656e616e745f7365617473202b207365617420656e666f7263656d656e74290a0a616c746572207461626c65207075626c69632e74656e616e74730a202061646420636f6c756d6e206966206e6f742065786973747320736561745f6c696d697420696e74206e6f74206e756c6c2064656661756c74203130302c0a202061646420636f6c756d6e206966206e6f742065786973747320736561745f636f756e7420696e74206e6f74206e756c6c2064656661756c742030000000e62d2d204261636b66696c6c20736561745f636f756e742066726f6d206d656d62657273686970730a757064617465207075626c69632e74656e616e747320740a73657420736561745f636f756e74203d20636f616c65736365286d2e636e742c2030290a66726f6d20280a202073656c6563742074656e616e745f69642c20636f756e74282a293a3a696e7420617320636e740a202066726f6d207075626c69632e74656e616e745f6d656d62657273686970730a202067726f75702062792074656e616e745f69640a29206d0a7768657265206d2e74656e616e745f6964203d20742e696400000041757064617465207075626c69632e74656e616e74732073657420736561745f636f756e74203d203020776865726520736561745f636f756e74206973206e756c6c000001c02d2d204b65657020736561745f636f756e7420696e2073796e630a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e5f73796e635f74656e616e745f736561745f636f756e7428290a72657475726e7320747269676765720a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a617320246d240a6465636c6172650a2020765f74656e616e745f69642075756964203a3d20636f616c65736365286e65772e74656e616e745f69642c206f6c642e74656e616e745f6964293b0a626567696e0a2020757064617465207075626c69632e74656e616e747320740a202073657420736561745f636f756e74203d20280a2020202073656c65637420636f756e74282a293a3a696e740a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f74656e616e745f69640a2020290a2020776865726520742e6964203d20765f74656e616e745f69643b0a0a202072657475726e206e756c6c3b0a656e643b0a246d240000005264726f70207472696767657220696620657869737473207472675f73796e635f74656e616e745f736561745f636f756e745f696e73206f6e207075626c69632e74656e616e745f6d656d62657273686970730000005264726f70207472696767657220696620657869737473207472675f73796e635f74656e616e745f736561745f636f756e745f64656c206f6e207075626c69632e74656e616e745f6d656d6265727368697073000000966372656174652074726967676572207472675f73796e635f74656e616e745f736561745f636f756e745f696e730a616674657220696e73657274206f6e207075626c69632e74656e616e745f6d656d62657273686970730a666f72206561636820726f7720657865637574652066756e6374696f6e207075626c69632e5f73796e635f74656e616e745f736561745f636f756e742829000000966372656174652074726967676572207472675f73796e635f74656e616e745f736561745f636f756e745f64656c0a61667465722064656c657465206f6e207075626c69632e74656e616e745f6d656d62657273686970730a666f72206561636820726f7720657865637574652066756e6374696f6e207075626c69632e5f73796e635f74656e616e745f736561745f636f756e742829"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"trigger \"trg_sync_tenant_seat_count_ins\" for relation \"public.tenant_memberships\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"trigger \"trg_sync_tenant_seat_count_del\" for relation \"public.tenant_memberships\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): trigger "trg_sync_tenant_seat_count_ins" for relation "public.tenant_memberships" does not exist, skipping
NOTICE (00000): trigger "trg_sync_tenant_seat_count_del" for relation "public.tenant_memberships" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124000007_002_deal_status_enum.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 20260124000007_002_deal_status_enum.sql\n-- FIX: drop legacy CHECK constraints on deals.status before changing type (prevents deal_status = text)\n\ndo $m$\nbegin\n  if not exists (\n    select 1\n    from pg_type t\n    join pg_namespace n on n.oid = t.typnamespace\n    where n.nspname = 'public'\n      and t.typname = 'deal_status'\n  ) then\n    create type public.deal_status as enum (\n      'New',\n      'Contacted',\n      'Under Contract',\n      'Dead'\n    );\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $m$\ndeclare\n  r record;\nbegin\n  -- if column missing, no-op\n  if not exists (\n    select 1\n    from information_schema.columns\n    where table_schema='public' and table_name='deals' and column_name='status'\n  ) then\n    return;\n  end if;\n\n  -- DROP any CHECK constraints that reference \"status\" on public.deals\n  -- (legacy constraints comparing enum to text will fail during ALTER TYPE validation)\n  for r in\n    select c.conname\n    from pg_constraint c\n    join pg_class t on t.oid = c.conrelid\n    join pg_namespace n on n.oid = t.relnamespace\n    where n.nspname = 'public'\n      and t.relname = 'deals'\n      and c.contype = 'c'\n      and pg_get_constraintdef(c.oid) ilike '%status%'\n  loop\n    execute format('alter table public.deals drop constraint if exists %I', r.conname);\n  end loop;\n\n  -- drop default if any (ignore errors)\n  begin\n    execute 'alter table public.deals alter column status drop default';\n  exception when others then\n    null;\n  end;\n\n  -- convert type using text mapping (works for text or enum input)\n  execute\n    'alter table public.deals ' ||\n    'alter column status type public.deal_status ' ||\n    'using ( ' ||\n      'case ' ||\n        'when status is null then ''New'' ' ||\n        'when lower(status::text) = ''new'' then ''New'' ' ||\n        'when lower(status::text) = ''contacted'' then ''Contacted'' ' ||\n        'when lower(status::text) in (''under contract'',''under_contract'',''undercontract'') then ''Under Contract'' ' ||\n        'when lower(status::text) = ''dead'' then ''Dead'' ' ||\n        'else ''New'' end ' ||\n    ')::public.deal_status';\n\n  execute 'alter table public.deals alter column status set default ''New''::public.deal_status';\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124000007"},{"text":"002_deal_status_enum"},{"binary":"0000000100000000000000190000000200000001000001dc2d2d2032303236303132343030303030375f3030325f6465616c5f7374617475735f656e756d2e73716c0a2d2d204649583a2064726f70206c656761637920434845434b20636f6e73747261696e7473206f6e206465616c732e737461747573206265666f7265206368616e67696e672074797065202870726576656e7473206465616c5f737461747573203d2074657874290a0a646f20246d240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f7479706520740a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e7479706e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c6963270a202020202020616e6420742e7479706e616d65203d20276465616c5f737461747573270a202029207468656e0a202020206372656174652074797065207075626c69632e6465616c5f73746174757320617320656e756d20280a202020202020274e6577272c0a20202020202027436f6e746163746564272c0a20202020202027556e64657220436f6e7472616374272c0a2020202020202744656164270a20202020293b0a2020656e642069663b0a656e640a246d24000006ad646f20246d240a6465636c6172650a202072207265636f72643b0a626567696e0a20202d2d20696620636f6c756d6e206d697373696e672c206e6f2d6f700a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e730a202020207768657265207461626c655f736368656d613d277075626c69632720616e64207461626c655f6e616d653d276465616c732720616e6420636f6c756d6e5f6e616d653d27737461747573270a202029207468656e0a2020202072657475726e3b0a2020656e642069663b0a0a20202d2d2044524f5020616e7920434845434b20636f6e73747261696e74732074686174207265666572656e6365202273746174757322206f6e207075626c69632e6465616c730a20202d2d20286c656761637920636f6e73747261696e747320636f6d706172696e6720656e756d20746f20746578742077696c6c206661696c20647572696e6720414c54455220545950452076616c69646174696f6e290a2020666f72207220696e0a2020202073656c65637420632e636f6e6e616d650a2020202066726f6d2070675f636f6e73747261696e7420630a202020206a6f696e2070675f636c6173732074206f6e20742e6f6964203d20632e636f6e72656c69640a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e72656c6e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c6963270a202020202020616e6420742e72656c6e616d65203d20276465616c73270a202020202020616e6420632e636f6e74797065203d202763270a202020202020616e642070675f6765745f636f6e73747261696e7464656628632e6f69642920696c696b6520272573746174757325270a20206c6f6f700a202020206578656375746520666f726d61742827616c746572207461626c65207075626c69632e6465616c732064726f7020636f6e73747261696e7420696620657869737473202549272c20722e636f6e6e616d65293b0a2020656e64206c6f6f703b0a0a20202d2d2064726f702064656661756c7420696620616e79202869676e6f7265206572726f7273290a2020626567696e0a20202020657865637574652027616c746572207461626c65207075626c69632e6465616c7320616c74657220636f6c756d6e207374617475732064726f702064656661756c74273b0a2020657863657074696f6e207768656e206f7468657273207468656e0a202020206e756c6c3b0a2020656e643b0a0a20202d2d20636f6e766572742074797065207573696e672074657874206d617070696e672028776f726b7320666f722074657874206f7220656e756d20696e707574290a2020657865637574650a2020202027616c746572207461626c65207075626c69632e6465616c732027207c7c0a2020202027616c74657220636f6c756d6e207374617475732074797065207075626c69632e6465616c5f7374617475732027207c7c0a20202020277573696e6720282027207c7c0a20202020202027636173652027207c7c0a2020202020202020277768656e20737461747573206973206e756c6c207468656e2027274e657727272027207c7c0a2020202020202020277768656e206c6f776572287374617475733a3a7465787429203d2027276e65772727207468656e2027274e657727272027207c7c0a2020202020202020277768656e206c6f776572287374617475733a3a7465787429203d202727636f6e7461637465642727207468656e202727436f6e74616374656427272027207c7c0a2020202020202020277768656e206c6f776572287374617475733a3a746578742920696e20282727756e64657220636f6e747261637427272c2727756e6465725f636f6e747261637427272c2727756e646572636f6e7472616374272729207468656e202727556e64657220436f6e747261637427272027207c7c0a2020202020202020277768656e206c6f776572287374617475733a3a7465787429203d202727646561642727207468656e2027274465616427272027207c7c0a202020202020202027656c73652027274e6577272720656e642027207c7c0a2020202027293a3a7075626c69632e6465616c5f737461747573273b0a0a2020657865637574652027616c746572207461626c65207075626c69632e6465616c7320616c74657220636f6c756d6e20737461747573207365742064656661756c742027274e657727273a3a7075626c69632e6465616c5f737461747573273b0a656e640a246d24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124000010_001_tenant_invites_table.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- tenant_invites table (must exist before any GRANT/funcs referencing it)\n\ncreate table if not exists public.tenant_invites (\n  id uuid primary key default gen_random_uuid(),\n  tenant_id uuid not null references public.tenants(id) on delete cascade,\n\n  invited_email text not null,\n  invited_role text not null default 'member',\n  invited_email_lc text generated always as (lower(invited_email)) stored,\n\n  token text not null,\n  created_by uuid not null,\n  created_at timestamptz not null default now(),\n\n  revoked_at timestamptz,\n  revoked_by uuid,\n\n  accepted_at timestamptz,\n  accepted_by uuid\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create unique index if not exists tenant_invites_tenant_token_uq\n  on public.tenant_invites(tenant_id, token)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create index if not exists tenant_invites_tenant_pending_idx\n  on public.tenant_invites(tenant_id)\n  where revoked_at is null and accepted_at is null","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.tenant_invites enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Minimal RLS: members can see invites for their tenant; only members can create/revoke\ndrop policy if exists tenant_invites_select on public.tenant_invites","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy tenant_invites_select\non public.tenant_invites\nfor select\nto authenticated\nusing (\n  exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = tenant_invites.tenant_id\n      and tm.user_id = auth.uid()\n  )\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists tenant_invites_insert on public.tenant_invites","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy tenant_invites_insert\non public.tenant_invites\nfor insert\nto authenticated\nwith check (\n  exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = tenant_invites.tenant_id\n      and tm.user_id = auth.uid()\n  )\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists tenant_invites_update on public.tenant_invites","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy tenant_invites_update\non public.tenant_invites\nfor update\nto authenticated\nusing (\n  exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = tenant_invites.tenant_id\n      and tm.user_id = auth.uid()\n  )\n)\nwith check (\n  exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = tenant_invites.tenant_id\n      and tm.user_id = auth.uid()\n  )\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Grants (now safe)\ngrant select, insert, update, delete on table public.tenant_invites to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124000010"},{"text":"001_tenant_invites_table"},{"binary":"0000000100000000000000190000000b00000001000002582d2d2074656e616e745f696e7669746573207461626c6520286d757374206578697374206265666f726520616e79204752414e542f66756e6373207265666572656e63696e67206974290a0a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e745f696e766974657320280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a202074656e616e745f69642075756964206e6f74206e756c6c207265666572656e636573207075626c69632e74656e616e747328696429206f6e2064656c65746520636173636164652c0a0a2020696e76697465645f656d61696c2074657874206e6f74206e756c6c2c0a2020696e76697465645f726f6c652074657874206e6f74206e756c6c2064656661756c7420276d656d626572272c0a2020696e76697465645f656d61696c5f6c6320746578742067656e65726174656420616c7761797320617320286c6f77657228696e76697465645f656d61696c29292073746f7265642c0a0a2020746f6b656e2074657874206e6f74206e756c6c2c0a2020637265617465645f62792075756964206e6f74206e756c6c2c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a0a20207265766f6b65645f61742074696d657374616d70747a2c0a20207265766f6b65645f627920757569642c0a0a202061636365707465645f61742074696d657374616d70747a2c0a202061636365707465645f627920757569640a290000006d63726561746520756e6971756520696e646578206966206e6f74206578697374732074656e616e745f696e76697465735f74656e616e745f746f6b656e5f75710a20206f6e207075626c69632e74656e616e745f696e76697465732874656e616e745f69642c20746f6b656e290000009563726561746520696e646578206966206e6f74206578697374732074656e616e745f696e76697465735f74656e616e745f70656e64696e675f6964780a20206f6e207075626c69632e74656e616e745f696e76697465732874656e616e745f6964290a20207768657265207265766f6b65645f6174206973206e756c6c20616e642061636365707465645f6174206973206e756c6c0000003b616c746572207461626c65207075626c69632e74656e616e745f696e766974657320656e61626c6520726f77206c6576656c2073656375726974790000009d2d2d204d696e696d616c20524c533a206d656d626572732063616e2073656520696e766974657320666f722074686569722074656e616e743b206f6e6c79206d656d626572732063616e206372656174652f7265766f6b650a64726f7020706f6c696379206966206578697374732074656e616e745f696e76697465735f73656c656374206f6e207075626c69632e74656e616e745f696e7669746573000000f863726561746520706f6c6963792074656e616e745f696e76697465735f73656c6563740a6f6e207075626c69632e74656e616e745f696e76697465730a666f722073656c6563740a746f2061757468656e746963617465640a7573696e6720280a202065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d2074656e616e745f696e76697465732e74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020290a290000004464726f7020706f6c696379206966206578697374732074656e616e745f696e76697465735f696e73657274206f6e207075626c69632e74656e616e745f696e7669746573000000fd63726561746520706f6c6963792074656e616e745f696e76697465735f696e736572740a6f6e207075626c69632e74656e616e745f696e76697465730a666f7220696e736572740a746f2061757468656e746963617465640a7769746820636865636b20280a202065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d2074656e616e745f696e76697465732e74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020290a290000004464726f7020706f6c696379206966206578697374732074656e616e745f696e76697465735f757064617465206f6e207075626c69632e74656e616e745f696e76697465730000019d63726561746520706f6c6963792074656e616e745f696e76697465735f7570646174650a6f6e207075626c69632e74656e616e745f696e76697465730a666f72207570646174650a746f2061757468656e746963617465640a7573696e6720280a202065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d2074656e616e745f696e76697465732e74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020290a290a7769746820636865636b20280a202065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d2074656e616e745f696e76697465732e74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020290a29000000692d2d204772616e747320286e6f772073616665290a6772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e74656e616e745f696e766974657320746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"tenant_invites_select\" for relation \"public.tenant_invites\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "tenant_invites_select" for relation "public.tenant_invites" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"tenant_invites_insert\" for relation \"public.tenant_invites\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "tenant_invites_insert" for relation "public.tenant_invites" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"tenant_invites_update\" for relation \"public.tenant_invites\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "tenant_invites_update" for relation "public.tenant_invites" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124125020_get_tenant_members.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Bootstrap for fresh local DB: ensure tenant_memberships exists before creating get_tenant_members()\n-- NOTE: This is ONLY to prevent migration-order failure on fresh local start.\n\ncreate table if not exists public.tenant_memberships (\n  tenant_id     uuid        not null,\n  user_id       uuid        not null,\n  role          text        not null default 'member',\n  tier          text        not null default 'free',\n  status        text        not null default 'pending',\n  trial_ends_at timestamptz,\n  created_at    timestamptz not null default now(),\n  updated_at    timestamptz not null default now(),\n  primary key (tenant_id, user_id)\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.get_tenant_members(p_tenant_id uuid)\nreturns table(user_id uuid, email text, role text, created_at timestamptz)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $function$\n  select\n    tm.user_id,\n    u.email,\n    (tm.role)::text as role,\n    tm.created_at\n  from public.tenant_memberships tm\n  join auth.users u on u.id = tm.user_id\n  where tm.tenant_id = p_tenant_id\n  order by tm.created_at asc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124125020"},{"text":"get_tenant_members"},{"binary":"0000000100000000000000190000000200000001000002872d2d20426f6f74737472617020666f72206672657368206c6f63616c2044423a20656e737572652074656e616e745f6d656d626572736869707320657869737473206265666f7265206372656174696e67206765745f74656e616e745f6d656d6265727328290a2d2d204e4f54453a2054686973206973204f4e4c5920746f2070726576656e74206d6967726174696f6e2d6f72646572206661696c757265206f6e206672657368206c6f63616c2073746172742e0a0a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e745f6d656d626572736869707320280a202074656e616e745f696420202020207575696420202020202020206e6f74206e756c6c2c0a2020757365725f6964202020202020207575696420202020202020206e6f74206e756c6c2c0a2020726f6c65202020202020202020207465787420202020202020206e6f74206e756c6c2064656661756c7420276d656d626572272c0a202074696572202020202020202020207465787420202020202020206e6f74206e756c6c2064656661756c74202766726565272c0a202073746174757320202020202020207465787420202020202020206e6f74206e756c6c2064656661756c74202770656e64696e67272c0a2020747269616c5f656e64735f61742074696d657374616d70747a2c0a2020637265617465645f61742020202074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757064617465645f61742020202074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a20207072696d617279206b6579202874656e616e745f69642c20757365725f6964290a29000001d1637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f74656e616e745f6d656d6265727328705f74656e616e745f69642075756964290a72657475726e73207461626c6528757365725f696420757569642c20656d61696c20746578742c20726f6c6520746578742c20637265617465645f61742074696d657374616d70747a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a202073656c6563740a20202020746d2e757365725f69642c0a20202020752e656d61696c2c0a2020202028746d2e726f6c65293a3a7465787420617320726f6c652c0a20202020746d2e637265617465645f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e20617574682e75736572732075206f6e20752e6964203d20746d2e757365725f69640a2020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a20206f7264657220627920746d2e637265617465645f6174206173633b0a2466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42P07","Message":"relation \"tenant_memberships\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"parse_utilcmd.c","Line":207,"Routine":"transformCreateStmt","UnknownFields":null}
NOTICE (42P07): relation "tenant_memberships" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124125230_bootstrap_subscription_enums.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Idempotent enum bootstrap\ndo $m$\nbegin\n  if not exists (\n    select 1\n    from pg_type t\n    join pg_namespace n on n.oid = t.typnamespace\n    where n.nspname = 'public' and t.typname = 'subscription_status'\n  ) then\n    create type public.subscription_status as enum ('pending','trialing','active','past_due','canceled','locked');\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $m$\nbegin\n  if not exists (\n    select 1\n    from pg_type t\n    join pg_namespace n on n.oid = t.typnamespace\n    where n.nspname = 'public' and t.typname = 'subscription_tier'\n  ) then\n    create type public.subscription_tier as enum ('free','core');\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124125230"},{"text":"bootstrap_subscription_enums"},{"binary":"0000000100000000000000190000000200000001000001602d2d204964656d706f74656e7420656e756d20626f6f7473747261700a646f20246d240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f7479706520740a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e7479706e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c69632720616e6420742e7479706e616d65203d2027737562736372697074696f6e5f737461747573270a202029207468656e0a202020206372656174652074797065207075626c69632e737562736372697074696f6e5f73746174757320617320656e756d20282770656e64696e67272c27747269616c696e67272c27616374697665272c27706173745f647565272c2763616e63656c6564272c276c6f636b656427293b0a2020656e642069663b0a656e640a246d2400000110646f20246d240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f7479706520740a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20742e7479706e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c69632720616e6420742e7479706e616d65203d2027737562736372697074696f6e5f74696572270a202029207468656e0a202020206372656174652074797065207075626c69632e737562736372697074696f6e5f7469657220617320656e756d20282766726565272c27636f726527293b0a2020656e642069663b0a656e640a246d24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124125322_get_entitlements_workspace_name.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"begin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.get_entitlements()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_entitlements()\nreturns table(\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public\nas $function$\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    (tm.role)::text as role,\n    (t.subscription_tier)::text as tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenants t\n  join public.tenant_memberships tm on tm.tenant_id = t.id\n  where tm.user_id = auth.uid()\n    and t.id = public.current_tenant_id()\n  limit 1;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124125322"},{"text":"get_entitlements_workspace_name"},{"binary":"000000010000000000000019000000050000000100000005626567696e0000003164726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f656e7469746c656d656e74732829000002726372656174652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328290a72657475726e73207461626c65280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a2020202028746d2e726f6c65293a3a7465787420617320726f6c652c0a2020202028742e737562736372697074696f6e5f74696572293a3a7465787420617320746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e747320740a20206a6f696e207075626c69632e74656e616e745f6d656d626572736869707320746d206f6e20746d2e74656e616e745f6964203d20742e69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20202020616e6420742e6964203d207075626c69632e63757272656e745f74656e616e745f696428290a20206c696d697420313b0a2466756e6374696f6e24000000446772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e7473282920746f2061757468656e7469636174656400000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.get_entitlements() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.get_entitlements() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124125403_get_entitlements_workspace_name.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder: duplicate entitlements migration replaced with no-op\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124125403"},{"text":"get_entitlements_workspace_name"},{"binary":"00000001000000000000001900000001000000010000004d2d2d20706c616365686f6c6465723a206475706c696361746520656e7469746c656d656e7473206d6967726174696f6e207265706c616365642077697468206e6f2d6f700a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124130812_get_entitlements_workspace_name.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder: duplicate entitlements migration replaced with no-op\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124130812"},{"text":"get_entitlements_workspace_name"},{"binary":"00000001000000000000001900000001000000010000004d2d2d20706c616365686f6c6465723a206475706c696361746520656e7469746c656d656e7473206d6967726174696f6e207265706c616365642077697468206e6f2d6f700a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124131009_get_entitlements_workspace_name.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- placeholder: duplicate entitlements migration replaced with no-op\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124131009"},{"text":"get_entitlements_workspace_name"},{"binary":"00000001000000000000001900000001000000010000004d2d2d20706c616365686f6c6465723a206475706c696361746520656e7469746c656d656e7473206d6967726174696f6e207265706c616365642077697468206e6f2d6f700a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124185043_hardening_memberships_trial_constraints.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create unique index if not exists tenant_memberships_tenant_user_ux\non public.tenant_memberships(tenant_id, user_id)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\n  if not exists (\n    select 1\n    from pg_constraint\n    where conname = 'tenants_trial_fields_chk'\n      and conrelid = 'public.tenants'::regclass\n  ) then\n    alter table public.tenants\n      add constraint tenants_trial_fields_chk\n      check (\n        subscription_status \u003c\u003e 'trialing'::public.subscription_status\n        or (\n          trial_started_at is not null\n          and trial_ends_at is not null\n          and trial_ends_at \u003e trial_started_at\n        )\n      );\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124185043"},{"text":"hardening_memberships_trial_constraints"},{"binary":"00000001000000000000001900000002000000010000007463726561746520756e6971756520696e646578206966206e6f74206578697374732074656e616e745f6d656d62657273686970735f74656e616e745f757365725f75780a6f6e207075626c69632e74656e616e745f6d656d62657273686970732874656e616e745f69642c20757365725f69642900000209646f202466756e6374696f6e240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d2070675f636f6e73747261696e740a20202020776865726520636f6e6e616d65203d202774656e616e74735f747269616c5f6669656c64735f63686b270a202020202020616e6420636f6e72656c6964203d20277075626c69632e74656e616e7473273a3a726567636c6173730a202029207468656e0a20202020616c746572207461626c65207075626c69632e74656e616e74730a20202020202061646420636f6e73747261696e742074656e616e74735f747269616c5f6669656c64735f63686b0a202020202020636865636b20280a2020202020202020737562736372697074696f6e5f737461747573203c3e2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475730a20202020202020206f7220280a20202020202020202020747269616c5f737461727465645f6174206973206e6f74206e756c6c0a20202020202020202020616e6420747269616c5f656e64735f6174206973206e6f74206e756c6c0a20202020202020202020616e6420747269616c5f656e64735f6174203e20747269616c5f737461727465645f61740a2020202020202020290a202020202020293b0a2020656e642069663b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124185714_hardening_grants_rls.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure RLS is enabled (idempotent)\nalter table if exists public.tenants enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table if exists public.tenant_memberships enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table if exists public.deals enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table if exists public.tenant_invites enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table if exists public.user_profiles enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Table privileges for app runtime (RLS still gates rows)\ngrant usage on schema public to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select, insert, update, delete on table public.tenants to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select, insert, update, delete on table public.tenant_memberships to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select, insert, update, delete on table public.deals to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select, insert, update, delete on table public.tenant_invites to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select, insert, update, delete on table public.user_profiles to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Keep anon minimal\nrevoke all on table public.tenants from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.tenant_memberships from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.deals from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.tenant_invites from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.user_profiles from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124185714"},{"text":"hardening_grants_rls"},{"binary":"0000000100000000000000190000001000000001000000642d2d20456e7375726520524c5320697320656e61626c656420286964656d706f74656e74290a616c746572207461626c6520696620657869737473207075626c69632e74656e616e747320656e61626c6520726f77206c6576656c20736563757269747900000049616c746572207461626c6520696620657869737473207075626c69632e74656e616e745f6d656d626572736869707320656e61626c6520726f77206c6576656c2073656375726974790000003c616c746572207461626c6520696620657869737473207075626c69632e6465616c7320656e61626c6520726f77206c6576656c20736563757269747900000045616c746572207461626c6520696620657869737473207075626c69632e74656e616e745f696e766974657320656e61626c6520726f77206c6576656c20736563757269747900000044616c746572207461626c6520696620657869737473207075626c69632e757365725f70726f66696c657320656e61626c6520726f77206c6576656c207365637572697479000000682d2d205461626c652070726976696c6567657320666f72206170702072756e74696d652028524c53207374696c6c20676174657320726f7773290a6772616e74207573616765206f6e20736368656d61207075626c696320746f2061757468656e746963617465640000004d6772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e74656e616e747320746f2061757468656e74696361746564000000586772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e74656e616e745f6d656d626572736869707320746f2061757468656e746963617465640000004b6772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e6465616c7320746f2061757468656e74696361746564000000546772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e74656e616e745f696e766974657320746f2061757468656e74696361746564000000536772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e757365725f70726f66696c657320746f2061757468656e74696361746564000000412d2d204b65657020616e6f6e206d696e696d616c0a7265766f6b6520616c6c206f6e207461626c65207075626c69632e74656e616e74732066726f6d20616e6f6e000000377265766f6b6520616c6c206f6e207461626c65207075626c69632e74656e616e745f6d656d62657273686970732066726f6d20616e6f6e0000002a7265766f6b6520616c6c206f6e207461626c65207075626c69632e6465616c732066726f6d20616e6f6e000000337265766f6b6520616c6c206f6e207461626c65207075626c69632e74656e616e745f696e76697465732066726f6d20616e6f6e000000327265766f6b6520616c6c206f6e207461626c65207075626c69632e757365725f70726f66696c65732066726f6d20616e6f6e"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124190540_documents_storage.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Bucket\ninsert into storage.buckets (id, name, public)\nvalues ('deal-files', 'deal-files', false)\non conflict (id) do nothing","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Helper: parse tenant_id + deal_id from storage path \"tenant_id/deal_id/...\"\ncreate or replace function public.storage_tenant_id(p_name text)\nreturns uuid\nlanguage sql\nstable\nas $function$\n  select nullif(split_part(p_name,'/',1),'')::uuid;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.storage_deal_id(p_name text)\nreturns uuid\nlanguage sql\nstable\nas $function$\n  select nullif(split_part(p_name,'/',2),'')::uuid;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Documents table\ncreate table if not exists public.documents (\n  id uuid primary key default gen_random_uuid(),\n  tenant_id uuid not null,\n  deal_id uuid not null references public.deals(id) on delete cascade,\n  storage_bucket text not null default 'deal-files',\n  storage_path text not null,\n  file_name text,\n  mime_type text,\n  size_bytes bigint,\n  created_at timestamptz not null default now(),\n  created_by uuid not null default auth.uid()\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create index if not exists documents_tenant_id_idx on public.documents(tenant_id)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create index if not exists documents_deal_id_idx on public.documents(deal_id)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.documents enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS: tenant scoped\ndrop policy if exists documents_select on public.documents","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy documents_select\non public.documents\nfor select\nto authenticated\nusing (tenant_id = public.current_tenant_id())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists documents_insert on public.documents","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy documents_insert\non public.documents\nfor insert\nto authenticated\nwith check (tenant_id = public.current_tenant_id() and public.can_write_current_tenant())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists documents_update on public.documents","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy documents_update\non public.documents\nfor update\nto authenticated\nusing (tenant_id = public.current_tenant_id())\nwith check (tenant_id = public.current_tenant_id() and public.can_write_current_tenant())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists documents_delete on public.documents","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy documents_delete\non public.documents\nfor delete\nto authenticated\nusing (tenant_id = public.current_tenant_id() and public.can_write_current_tenant())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Grants\ngrant select, insert, update, delete on table public.documents to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- RPC: create doc row after upload\ncreate or replace function public.create_document_after_upload(\n  p_deal_id uuid,\n  p_storage_path text,\n  p_file_name text,\n  p_mime_type text,\n  p_size_bytes bigint\n)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nas $function$\ndeclare\n  v_tenant uuid;\n  v_id uuid;\nbegin\n  v_tenant := public.current_tenant_id();\n  if v_tenant is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if public.storage_tenant_id(p_storage_path) is distinct from v_tenant\n     or public.storage_deal_id(p_storage_path) is distinct from p_deal_id then\n    raise exception 'PATH_MISMATCH';\n  end if;\n\n  insert into public.documents (\n    tenant_id, deal_id, storage_bucket, storage_path, file_name, mime_type, size_bytes\n  ) values (\n    v_tenant, p_deal_id, 'deal-files', p_storage_path, p_file_name, p_mime_type, p_size_bytes\n  )\n  returning id into v_id;\n\n  return v_id;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.create_document_after_upload(uuid, text, text, text, bigint) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_document_after_upload(uuid, text, text, text, bigint) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Storage RLS policies MUST be created in Supabase Dashboard Storage Policies UI\n-- because role ownership for storage.objects is not available via CLI migrations.","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124190540"},{"text":"documents_storage"},{"binary":"00000001000000000000001900000014000000010000007f2d2d204275636b65740a696e7365727420696e746f2073746f726167652e6275636b657473202869642c206e616d652c207075626c6963290a76616c7565732028276465616c2d66696c6573272c20276465616c2d66696c6573272c2066616c7365290a6f6e20636f6e666c696374202869642920646f206e6f7468696e67000000fd2d2d2048656c7065723a2070617273652074656e616e745f6964202b206465616c5f69642066726f6d2073746f726167652070617468202274656e616e745f69642f6465616c5f69642f2e2e2e220a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746f726167655f74656e616e745f696428705f6e616d652074657874290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a6173202466756e6374696f6e240a202073656c656374206e756c6c69662873706c69745f7061727428705f6e616d652c272f272c31292c2727293a3a757569643b0a2466756e6374696f6e24000000ac637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746f726167655f6465616c5f696428705f6e616d652074657874290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a6173202466756e6374696f6e240a202073656c656374206e756c6c69662873706c69745f7061727428705f6e616d652c272f272c32292c2727293a3a757569643b0a2466756e6374696f6e24000001c02d2d20446f63756d656e7473207461626c650a637265617465207461626c65206966206e6f7420657869737473207075626c69632e646f63756d656e747320280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a202074656e616e745f69642075756964206e6f74206e756c6c2c0a20206465616c5f69642075756964206e6f74206e756c6c207265666572656e636573207075626c69632e6465616c7328696429206f6e2064656c65746520636173636164652c0a202073746f726167655f6275636b65742074657874206e6f74206e756c6c2064656661756c7420276465616c2d66696c6573272c0a202073746f726167655f706174682074657874206e6f74206e756c6c2c0a202066696c655f6e616d6520746578742c0a20206d696d655f7479706520746578742c0a202073697a655f627974657320626967696e742c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020637265617465645f62792075756964206e6f74206e756c6c2064656661756c7420617574682e75696428290a290000005163726561746520696e646578206966206e6f742065786973747320646f63756d656e74735f74656e616e745f69645f696478206f6e207075626c69632e646f63756d656e74732874656e616e745f6964290000004d63726561746520696e646578206966206e6f742065786973747320646f63756d656e74735f6465616c5f69645f696478206f6e207075626c69632e646f63756d656e7473286465616c5f69642900000036616c746572207461626c65207075626c69632e646f63756d656e747320656e61626c6520726f77206c6576656c207365637572697479000000502d2d20524c533a2074656e616e742073636f7065640a64726f7020706f6c6963792069662065786973747320646f63756d656e74735f73656c656374206f6e207075626c69632e646f63756d656e74730000007d63726561746520706f6c69637920646f63756d656e74735f73656c6563740a6f6e207075626c69632e646f63756d656e74730a666f722073656c6563740a746f2061757468656e746963617465640a7573696e67202874656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f69642829290000003a64726f7020706f6c6963792069662065786973747320646f63756d656e74735f696e73657274206f6e207075626c69632e646f63756d656e7473000000a863726561746520706f6c69637920646f63756d656e74735f696e736572740a6f6e207075626c69632e646f63756d656e74730a666f7220696e736572740a746f2061757468656e746963617465640a7769746820636865636b202874656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f6964282920616e64207075626c69632e63616e5f77726974655f63757272656e745f74656e616e742829290000003a64726f7020706f6c6963792069662065786973747320646f63756d656e74735f757064617465206f6e207075626c69632e646f63756d656e7473000000d763726561746520706f6c69637920646f63756d656e74735f7570646174650a6f6e207075626c69632e646f63756d656e74730a666f72207570646174650a746f2061757468656e746963617465640a7573696e67202874656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f69642829290a7769746820636865636b202874656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f6964282920616e64207075626c69632e63616e5f77726974655f63757272656e745f74656e616e742829290000003a64726f7020706f6c6963792069662065786973747320646f63756d656e74735f64656c657465206f6e207075626c69632e646f63756d656e7473000000a363726561746520706f6c69637920646f63756d656e74735f64656c6574650a6f6e207075626c69632e646f63756d656e74730a666f722064656c6574650a746f2061757468656e746963617465640a7573696e67202874656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f6964282920616e64207075626c69632e63616e5f77726974655f63757272656e745f74656e616e74282929000000592d2d204772616e74730a6772616e742073656c6563742c20696e736572742c207570646174652c2064656c657465206f6e207461626c65207075626c69632e646f63756d656e747320746f2061757468656e74696361746564000003912d2d205250433a2063726561746520646f6320726f772061667465722075706c6f61640a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6372656174655f646f63756d656e745f61667465725f75706c6f6164280a2020705f6465616c5f696420757569642c0a2020705f73746f726167655f7061746820746578742c0a2020705f66696c655f6e616d6520746578742c0a2020705f6d696d655f7479706520746578742c0a2020705f73697a655f627974657320626967696e740a290a72657475726e7320757569640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e7420757569643b0a2020765f696420757569643b0a626567696e0a2020765f74656e616e74203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e74206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966207075626c69632e73746f726167655f74656e616e745f696428705f73746f726167655f70617468292069732064697374696e63742066726f6d20765f74656e616e740a20202020206f72207075626c69632e73746f726167655f6465616c5f696428705f73746f726167655f70617468292069732064697374696e63742066726f6d20705f6465616c5f6964207468656e0a20202020726169736520657863657074696f6e2027504154485f4d49534d41544348273b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e646f63756d656e747320280a2020202074656e616e745f69642c206465616c5f69642c2073746f726167655f6275636b65742c2073746f726167655f706174682c2066696c655f6e616d652c206d696d655f747970652c2073697a655f62797465730a2020292076616c75657320280a20202020765f74656e616e742c20705f6465616c5f69642c20276465616c2d66696c6573272c20705f73746f726167655f706174682c20705f66696c655f6e616d652c20705f6d696d655f747970652c20705f73697a655f62797465730a2020290a202072657475726e696e6720696420696e746f20765f69643b0a0a202072657475726e20765f69643b0a656e64202466756e6374696f6e24000000667265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6372656174655f646f63756d656e745f61667465725f75706c6f616428757569642c20746578742c20746578742c20746578742c20626967696e74292066726f6d207075626c69630000006e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f646f63756d656e745f61667465725f75706c6f616428757569642c20746578742c20746578742c20746578742c20626967696e742920746f2061757468656e74696361746564000000a42d2d2053746f7261676520524c5320706f6c6963696573204d555354206265206372656174656420696e2053757061626173652044617368626f6172642053746f7261676520506f6c69636965732055490a2d2d206265636175736520726f6c65206f776e65727368697020666f722073746f726167652e6f626a65637473206973206e6f7420617661696c61626c652076696120434c49206d6967726174696f6e732e"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"documents_select\" for relation \"public.documents\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "documents_select" for relation "public.documents" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"documents_insert\" for relation \"public.documents\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "documents_insert" for relation "public.documents" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"documents_update\" for relation \"public.documents\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "documents_update" for relation "public.documents" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"documents_delete\" for relation \"public.documents\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "documents_delete" for relation "public.documents" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"EmptyQueryResponse"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124191422_seat_enforcement_ui_support.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Seat info (for UI + API checks)\ncreate or replace function public.get_current_tenant_seats()\nreturns table(seat_limit int, seat_count int)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  select t.seat_limit, t.seat_count\n  from public.tenants t\n  where t.id = public.current_tenant_id();\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_current_tenant_seats() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_current_tenant_seats() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Hard enforcement: block membership insert when full (covers any path)\ncreate or replace function public.enforce_seat_limit_on_membership()\nreturns trigger\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  v_limit int;\n  v_count int;\nbegin\n  select seat_limit, seat_count\n    into v_limit, v_count\n  from public.tenants\n  where id = new.tenant_id\n  for update;\n\n  if v_limit is not null and v_count is not null and v_count \u003e= v_limit then\n    raise exception 'SEAT_LIMIT_REACHED';\n  end if;\n\n  return new;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop trigger if exists trg_enforce_seat_limit_on_membership on public.tenant_memberships","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create trigger trg_enforce_seat_limit_on_membership\nbefore insert on public.tenant_memberships\nfor each row\nexecute function public.enforce_seat_limit_on_membership()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124191422"},{"text":"seat_enforcement_ui_support"},{"binary":"0000000100000000000000190000000600000001000001602d2d205365617420696e666f2028666f72205549202b2041504920636865636b73290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f736561747328290a72657475726e73207461626c6528736561745f6c696d697420696e742c20736561745f636f756e7420696e74290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202073656c65637420742e736561745f6c696d69742c20742e736561745f636f756e740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d207075626c69632e63757272656e745f74656e616e745f696428293b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f736561747328292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f7365617473282920746f2061757468656e74696361746564000002402d2d204861726420656e666f7263656d656e743a20626c6f636b206d656d6265727368697020696e73657274207768656e2066756c6c2028636f7665727320616e792070617468290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e656e666f7263655f736561745f6c696d69745f6f6e5f6d656d6265727368697028290a72657475726e7320747269676765720a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a2020765f6c696d697420696e743b0a2020765f636f756e7420696e743b0a626567696e0a202073656c65637420736561745f6c696d69742c20736561745f636f756e740a20202020696e746f20765f6c696d69742c20765f636f756e740a202066726f6d207075626c69632e74656e616e74730a20207768657265206964203d206e65772e74656e616e745f69640a2020666f72207570646174653b0a0a2020696620765f6c696d6974206973206e6f74206e756c6c20616e6420765f636f756e74206973206e6f74206e756c6c20616e6420765f636f756e74203e3d20765f6c696d6974207468656e0a20202020726169736520657863657074696f6e2027534541545f4c494d49545f52454143484544273b0a2020656e642069663b0a0a202072657475726e206e65773b0a656e64202466756e6374696f6e240000005864726f70207472696767657220696620657869737473207472675f656e666f7263655f736561745f6c696d69745f6f6e5f6d656d62657273686970206f6e207075626c69632e74656e616e745f6d656d6265727368697073000000a66372656174652074726967676572207472675f656e666f7263655f736561745f6c696d69745f6f6e5f6d656d626572736869700a6265666f726520696e73657274206f6e207075626c69632e74656e616e745f6d656d62657273686970730a666f72206561636820726f770a657865637574652066756e6374696f6e207075626c69632e656e666f7263655f736561745f6c696d69745f6f6e5f6d656d626572736869702829"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"trigger \"trg_enforce_seat_limit_on_membership\" for relation \"public.tenant_memberships\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): trigger "trg_enforce_seat_limit_on_membership" for relation "public.tenant_memberships" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TRIGGER"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124191940_seats_set_limit_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.set_current_tenant_seat_limit(p_seat_limit int)\nreturns table(tenant_id uuid, seat_limit int, seat_count int)\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  v_tenant uuid;\nbegin\n  v_tenant := public.current_tenant_id();\n  if v_tenant is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not public.is_owner_or_admin(v_tenant) then\n    raise exception 'NOT_AUTHORIZED';\n  end if;\n\n  if p_seat_limit is null or p_seat_limit \u003c 1 then\n    raise exception 'INVALID_SEAT_LIMIT';\n  end if;\n\n  update public.tenants\n  set seat_limit = p_seat_limit\n  where id = v_tenant;\n\n  return query\n  select t.id, t.seat_limit, t.seat_count\n  from public.tenants t\n  where t.id = v_tenant;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_current_tenant_seat_limit(int) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_current_tenant_seat_limit(int) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124191940"},{"text":"seats_set_limit_rpc"},{"binary":"000000010000000000000019000000030000000100000314637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e745f736561745f6c696d697428705f736561745f6c696d697420696e74290a72657475726e73207461626c652874656e616e745f696420757569642c20736561745f6c696d697420696e742c20736561745f636f756e7420696e74290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e7420757569643b0a626567696e0a2020765f74656e616e74203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e74206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e69735f6f776e65725f6f725f61646d696e28765f74656e616e7429207468656e0a20202020726169736520657863657074696f6e20274e4f545f415554484f52495a4544273b0a2020656e642069663b0a0a2020696620705f736561745f6c696d6974206973206e756c6c206f7220705f736561745f6c696d6974203c2031207468656e0a20202020726169736520657863657074696f6e2027494e56414c49445f534541545f4c494d4954273b0a2020656e642069663b0a0a2020757064617465207075626c69632e74656e616e74730a202073657420736561745f6c696d6974203d20705f736561745f6c696d69740a20207768657265206964203d20765f74656e616e743b0a0a202072657475726e2071756572790a202073656c65637420742e69642c20742e736561745f6c696d69742c20742e736561745f636f756e740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d20765f74656e616e743b0a656e64202466756e6374696f6e240000004c7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e745f736561745f6c696d697428696e74292066726f6d207075626c6963000000546772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e745f736561745f6c696d697428696e742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124192924_deals_row_version_status_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- row_version for optimistic concurrency\nalter table public.deals\n  add column if not exists row_version int not null default 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- RPC: set status with optional optimistic concurrency check\ncreate or replace function public.set_deal_status(\n  p_deal_id uuid,\n  p_status public.deal_status,\n  p_expected_row_version int default null\n)\nreturns table(id uuid, status public.deal_status, row_version int)\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\nbegin\n  if public.current_tenant_id() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not public.can_write_current_tenant() then\n    raise exception 'WRITE_NOT_ALLOWED';\n  end if;\n\n  return query\n  update public.deals d\n  set\n    status = p_status,\n    row_version = d.row_version + 1\n  where\n    d.id = p_deal_id\n    and d.tenant_id = public.current_tenant_id()\n    and (p_expected_row_version is null or d.row_version = p_expected_row_version)\n  returning d.id, d.status, d.row_version;\n\n  if not found then\n    if p_expected_row_version is null then\n      raise exception 'NOT_FOUND';\n    else\n      raise exception 'ROW_VERSION_CONFLICT';\n    end if;\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_deal_status(uuid, public.deal_status, int) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_deal_status(uuid, public.deal_status, int) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124192924"},{"text":"deals_row_version_status_rpc"},{"binary":"0000000100000000000000190000000400000001000000802d2d20726f775f76657273696f6e20666f72206f7074696d697374696320636f6e63757272656e63790a616c746572207461626c65207075626c69632e6465616c730a202061646420636f6c756d6e206966206e6f742065786973747320726f775f76657273696f6e20696e74206e6f74206e756c6c2064656661756c742031000004282d2d205250433a20736574207374617475732077697468206f7074696f6e616c206f7074696d697374696320636f6e63757272656e637920636865636b0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f6465616c5f737461747573280a2020705f6465616c5f696420757569642c0a2020705f737461747573207075626c69632e6465616c5f7374617475732c0a2020705f65787065637465645f726f775f76657273696f6e20696e742064656661756c74206e756c6c0a290a72657475726e73207461626c6528696420757569642c20737461747573207075626c69632e6465616c5f7374617475732c20726f775f76657273696f6e20696e74290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a626567696e0a20206966207075626c69632e63757272656e745f74656e616e745f69642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e63616e5f77726974655f63757272656e745f74656e616e742829207468656e0a20202020726169736520657863657074696f6e202757524954455f4e4f545f414c4c4f574544273b0a2020656e642069663b0a0a202072657475726e2071756572790a2020757064617465207075626c69632e6465616c7320640a20207365740a20202020737461747573203d20705f7374617475732c0a20202020726f775f76657273696f6e203d20642e726f775f76657273696f6e202b20310a202077686572650a20202020642e6964203d20705f6465616c5f69640a20202020616e6420642e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a20202020616e642028705f65787065637465645f726f775f76657273696f6e206973206e756c6c206f7220642e726f775f76657273696f6e203d20705f65787065637465645f726f775f76657273696f6e290a202072657475726e696e6720642e69642c20642e7374617475732c20642e726f775f76657273696f6e3b0a0a20206966206e6f7420666f756e64207468656e0a20202020696620705f65787065637465645f726f775f76657273696f6e206973206e756c6c207468656e0a202020202020726169736520657863657074696f6e20274e4f545f464f554e44273b0a20202020656c73650a202020202020726169736520657863657074696f6e2027524f575f56455253494f4e5f434f4e464c494354273b0a20202020656e642069663b0a2020656e642069663b0a656e64202466756e6374696f6e24000000587265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f6465616c5f73746174757328757569642c207075626c69632e6465616c5f7374617475732c20696e74292066726f6d207075626c6963000000606772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f6465616c5f73746174757328757569642c207075626c69632e6465616c5f7374617475732c20696e742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"row_version\" of relation \"deals\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "row_version" of relation "deals" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124193506_billing_choose_plan_trial.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- subscription_tier enum (idempotent)\ndo $function$\nbegin\n  if not exists (select 1 from pg_type where typname = 'subscription_tier') then\n    create type public.subscription_tier as enum ('free','core');\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- tenants.subscription_tier (idempotent)\ndo $function$\nbegin\n  if not exists (\n    select 1\n    from information_schema.columns\n    where table_schema='public' and table_name='tenants' and column_name='subscription_tier'\n  ) then\n    alter table public.tenants\n      add column subscription_tier public.subscription_tier not null default 'free'::public.subscription_tier;\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"update public.tenants\nset subscription_tier = coalesce(subscription_tier, 'free'::public.subscription_tier)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- choose plan + start trial (owner/admin only)\ncreate or replace function public.choose_plan_and_start_trial(p_tier public.subscription_tier)\nreturns table(\n  tenant_id uuid,\n  tier public.subscription_tier,\n  status public.subscription_status,\n  trial_ends_at timestamptz,\n  seat_limit int,\n  seat_count int\n)\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  v_tenant uuid;\n  v_status public.subscription_status;\nbegin\n  v_tenant := public.current_tenant_id();\n  if v_tenant is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not public.is_owner_or_admin(v_tenant) then\n    raise exception 'NOT_AUTHORIZED';\n  end if;\n\n  select subscription_status into v_status\n  from public.tenants\n  where id = v_tenant;\n\n  -- Set tier always\n  update public.tenants\n  set subscription_tier = p_tier\n  where id = v_tenant;\n\n  -- Only auto-start trial when moving from pending -\u003e trialing\n  if v_status = 'pending'::public.subscription_status and p_tier = 'core'::public.subscription_tier then\n    update public.tenants\n    set\n      subscription_status = 'trialing'::public.subscription_status,\n      trial_started_at = now(),\n      trial_ends_at = now() + interval '14 days'\n    where id = v_tenant;\n  end if;\n\n  return query\n  select\n    t.id,\n    t.subscription_tier,\n    t.subscription_status,\n    t.trial_ends_at,\n    t.seat_limit,\n    t.seat_count\n  from public.tenants t\n  where t.id = v_tenant;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.choose_plan_and_start_trial(public.subscription_tier) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.choose_plan_and_start_trial(public.subscription_tier) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124193506"},{"text":"billing_choose_plan_trial"},{"binary":"0000000100000000000000190000000600000001000000e62d2d20737562736372697074696f6e5f7469657220656e756d20286964656d706f74656e74290a646f202466756e6374696f6e240a626567696e0a20206966206e6f7420657869737473202873656c65637420312066726f6d2070675f74797065207768657265207479706e616d65203d2027737562736372697074696f6e5f746965722729207468656e0a202020206372656174652074797065207075626c69632e737562736372697074696f6e5f7469657220617320656e756d20282766726565272c27636f726527293b0a2020656e642069663b0a656e64202466756e6374696f6e240000018d2d2d2074656e616e74732e737562736372697074696f6e5f7469657220286964656d706f74656e74290a646f202466756e6374696f6e240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e730a202020207768657265207461626c655f736368656d613d277075626c69632720616e64207461626c655f6e616d653d2774656e616e74732720616e6420636f6c756d6e5f6e616d653d27737562736372697074696f6e5f74696572270a202029207468656e0a20202020616c746572207461626c65207075626c69632e74656e616e74730a20202020202061646420636f6c756d6e20737562736372697074696f6e5f74696572207075626c69632e737562736372697074696f6e5f74696572206e6f74206e756c6c2064656661756c74202766726565273a3a7075626c69632e737562736372697074696f6e5f746965723b0a2020656e642069663b0a656e64202466756e6374696f6e240000006b757064617465207075626c69632e74656e616e74730a73657420737562736372697074696f6e5f74696572203d20636f616c6573636528737562736372697074696f6e5f746965722c202766726565273a3a7075626c69632e737562736372697074696f6e5f7469657229000005c32d2d2063686f6f736520706c616e202b20737461727420747269616c20286f776e65722f61646d696e206f6e6c79290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63686f6f73655f706c616e5f616e645f73746172745f747269616c28705f74696572207075626c69632e737562736372697074696f6e5f74696572290a72657475726e73207461626c65280a202074656e616e745f696420757569642c0a202074696572207075626c69632e737562736372697074696f6e5f746965722c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a2c0a2020736561745f6c696d697420696e742c0a2020736561745f636f756e7420696e740a290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e7420757569643b0a2020765f737461747573207075626c69632e737562736372697074696f6e5f7374617475733b0a626567696e0a2020765f74656e616e74203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e74206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e69735f6f776e65725f6f725f61646d696e28765f74656e616e7429207468656e0a20202020726169736520657863657074696f6e20274e4f545f415554484f52495a4544273b0a2020656e642069663b0a0a202073656c65637420737562736372697074696f6e5f73746174757320696e746f20765f7374617475730a202066726f6d207075626c69632e74656e616e74730a20207768657265206964203d20765f74656e616e743b0a0a20202d2d20536574207469657220616c776179730a2020757064617465207075626c69632e74656e616e74730a202073657420737562736372697074696f6e5f74696572203d20705f746965720a20207768657265206964203d20765f74656e616e743b0a0a20202d2d204f6e6c79206175746f2d737461727420747269616c207768656e206d6f76696e672066726f6d2070656e64696e67202d3e20747269616c696e670a2020696620765f737461747573203d202770656e64696e67273a3a7075626c69632e737562736372697074696f6e5f73746174757320616e6420705f74696572203d2027636f7265273a3a7075626c69632e737562736372697074696f6e5f74696572207468656e0a20202020757064617465207075626c69632e74656e616e74730a202020207365740a202020202020737562736372697074696f6e5f737461747573203d2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c0a202020202020747269616c5f737461727465645f6174203d206e6f7728292c0a202020202020747269616c5f656e64735f6174203d206e6f772829202b20696e74657276616c202731342064617973270a202020207768657265206964203d20765f74656e616e743b0a2020656e642069663b0a0a202072657475726e2071756572790a202073656c6563740a20202020742e69642c0a20202020742e737562736372697074696f6e5f746965722c0a20202020742e737562736372697074696f6e5f7374617475732c0a20202020742e747269616c5f656e64735f61742c0a20202020742e736561745f6c696d69742c0a20202020742e736561745f636f756e740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d20765f74656e616e743b0a656e64202466756e6374696f6e240000005f7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e63686f6f73655f706c616e5f616e645f73746172745f747269616c287075626c69632e737562736372697074696f6e5f74696572292066726f6d207075626c6963000000676772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e63686f6f73655f706c616e5f616e645f73746172745f747269616c287075626c69632e737562736372697074696f6e5f746965722920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124193920_start_trial_idempotent.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.start_trial(p_tenant_id uuid)\nreturns public.tenants\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  t public.tenants;\nbegin\n  if p_tenant_id is null then\n    raise exception 'TENANT_REQUIRED';\n  end if;\n\n  if not public.is_owner_or_admin(p_tenant_id) then\n    raise exception 'NOT_AUTHORIZED';\n  end if;\n\n  select * into t\n  from public.tenants\n  where id = p_tenant_id;\n\n  if not found then\n    raise exception 'NOT_FOUND';\n  end if;\n\n  -- Idempotent: only start if currently pending\n  if t.subscription_status = 'pending'::public.subscription_status then\n    update public.tenants\n    set\n      subscription_status = 'trialing'::public.subscription_status,\n      trial_started_at = now(),\n      trial_ends_at = now() + interval '14 days'\n    where id = p_tenant_id\n    returning * into t;\n  end if;\n\n  return t;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.start_trial(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.start_trial(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124193920"},{"text":"start_trial_idempotent"},{"binary":"000000010000000000000019000000030000000100000397637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746172745f747269616c28705f74656e616e745f69642075756964290a72657475726e73207075626c69632e74656e616e74730a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a202074207075626c69632e74656e616e74733b0a626567696e0a2020696620705f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e202754454e414e545f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e69735f6f776e65725f6f725f61646d696e28705f74656e616e745f696429207468656e0a20202020726169736520657863657074696f6e20274e4f545f415554484f52495a4544273b0a2020656e642069663b0a0a202073656c656374202a20696e746f20740a202066726f6d207075626c69632e74656e616e74730a20207768657265206964203d20705f74656e616e745f69643b0a0a20206966206e6f7420666f756e64207468656e0a20202020726169736520657863657074696f6e20274e4f545f464f554e44273b0a2020656e642069663b0a0a20202d2d204964656d706f74656e743a206f6e6c792073746172742069662063757272656e746c792070656e64696e670a2020696620742e737562736372697074696f6e5f737461747573203d202770656e64696e67273a3a7075626c69632e737562736372697074696f6e5f737461747573207468656e0a20202020757064617465207075626c69632e74656e616e74730a202020207365740a202020202020737562736372697074696f6e5f737461747573203d2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c0a202020202020747269616c5f737461727465645f6174203d206e6f7728292c0a202020202020747269616c5f656e64735f6174203d206e6f772829202b20696e74657276616c202731342064617973270a202020207768657265206964203d20705f74656e616e745f69640a2020202072657475726e696e67202a20696e746f20743b0a2020656e642069663b0a0a202072657475726e20743b0a656e64202466756e6374696f6e240000003b7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c2875756964292066726f6d207075626c6963000000436772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c28757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124195919_get_current_tenant_id_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.get_current_tenant_id()\nreturns uuid\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  select up.current_tenant_id\n  from public.user_profiles up\n  where up.user_id = auth.uid();\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_current_tenant_id() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_current_tenant_id() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124195919"},{"text":"get_current_tenant_id_rpc"},{"binary":"000000010000000000000019000000030000000100000109637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202073656c6563742075702e63757272656e745f74656e616e745f69640a202066726f6d207075626c69632e757365725f70726f66696c65732075700a202077686572652075702e757365725f6964203d20617574682e75696428293b0a2466756e6374696f6e24000000417265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f696428292066726f6d207075626c6963000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f63757272656e745f74656e616e745f6964282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124200711_members_set_role_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.set_member_role(\n  p_tenant_id uuid,\n  p_user_id uuid,\n  p_role text\n)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  v_owner uuid;\nbegin\n  if p_tenant_id is null or p_user_id is null then\n    raise exception 'ARG_REQUIRED';\n  end if;\n\n  if public.current_tenant_id() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not public.is_owner_or_admin(p_tenant_id) then\n    raise exception 'NOT_AUTHORIZED';\n  end if;\n\n  if p_role not in ('owner','admin','member') then\n    raise exception 'INVALID_ROLE';\n  end if;\n\n  select tm.user_id into v_owner\n  from public.tenant_memberships tm\n  where tm.tenant_id = p_tenant_id and tm.role = 'owner'\n  limit 1;\n\n  if v_owner is not null and p_user_id = v_owner and p_role \u003c\u003e 'owner' then\n    raise exception 'CANNOT_CHANGE_OWNER';\n  end if;\n\n  update public.tenant_memberships\n  set role = p_role\n  where tenant_id = p_tenant_id and user_id = p_user_id;\n\n  if not found then\n    raise exception 'NOT_FOUND';\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_member_role(uuid, uuid, text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_member_role(uuid, uuid, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124200711"},{"text":"members_set_role_rpc"},{"binary":"000000010000000000000019000000030000000100000442637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f6d656d6265725f726f6c65280a2020705f74656e616e745f696420757569642c0a2020705f757365725f696420757569642c0a2020705f726f6c6520746578740a290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a2020765f6f776e657220757569643b0a626567696e0a2020696620705f74656e616e745f6964206973206e756c6c206f7220705f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274152475f5245515549524544273b0a2020656e642069663b0a0a20206966207075626c69632e63757272656e745f74656e616e745f69642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e69735f6f776e65725f6f725f61646d696e28705f74656e616e745f696429207468656e0a20202020726169736520657863657074696f6e20274e4f545f415554484f52495a4544273b0a2020656e642069663b0a0a2020696620705f726f6c65206e6f7420696e2028276f776e6572272c2761646d696e272c276d656d6265722729207468656e0a20202020726169736520657863657074696f6e2027494e56414c49445f524f4c45273b0a2020656e642069663b0a0a202073656c65637420746d2e757365725f696420696e746f20765f6f776e65720a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f696420616e6420746d2e726f6c65203d20276f776e6572270a20206c696d697420313b0a0a2020696620765f6f776e6572206973206e6f74206e756c6c20616e6420705f757365725f6964203d20765f6f776e657220616e6420705f726f6c65203c3e20276f776e657227207468656e0a20202020726169736520657863657074696f6e202743414e4e4f545f4348414e47455f4f574e4552273b0a2020656e642069663b0a0a2020757064617465207075626c69632e74656e616e745f6d656d62657273686970730a202073657420726f6c65203d20705f726f6c650a202077686572652074656e616e745f6964203d20705f74656e616e745f696420616e6420757365725f6964203d20705f757365725f69643b0a0a20206966206e6f7420666f756e64207468656e0a20202020726169736520657863657074696f6e20274e4f545f464f554e44273b0a2020656e642069663b0a656e64202466756e6374696f6e240000004b7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f6d656d6265725f726f6c6528757569642c20757569642c2074657874292066726f6d207075626c6963000000536772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f6d656d6265725f726f6c6528757569642c20757569642c20746578742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124201352_deal_status_add_qualified_closed.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\n  if exists (select 1 from pg_type where typname = 'deal_status') then\n\n    if not exists (\n      select 1\n      from pg_enum e\n      join pg_type t on t.oid = e.enumtypid\n      where t.typname = 'deal_status' and e.enumlabel = 'Qualified'\n    ) then\n      execute 'alter type public.deal_status add value ''Qualified''';\n    end if;\n\n    if not exists (\n      select 1\n      from pg_enum e\n      join pg_type t on t.oid = e.enumtypid\n      where t.typname = 'deal_status' and e.enumlabel = 'Closed'\n    ) then\n      execute 'alter type public.deal_status add value ''Closed''';\n    end if;\n\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124201352"},{"text":"deal_status_add_qualified_closed"},{"binary":"00000001000000000000001900000001000000010000027c646f202466756e6374696f6e240a626567696e0a2020696620657869737473202873656c65637420312066726f6d2070675f74797065207768657265207479706e616d65203d20276465616c5f7374617475732729207468656e0a0a202020206966206e6f742065786973747320280a20202020202073656c65637420310a20202020202066726f6d2070675f656e756d20650a2020202020206a6f696e2070675f747970652074206f6e20742e6f6964203d20652e656e756d74797069640a202020202020776865726520742e7479706e616d65203d20276465616c5f7374617475732720616e6420652e656e756d6c6162656c203d20275175616c6966696564270a2020202029207468656e0a202020202020657865637574652027616c7465722074797065207075626c69632e6465616c5f737461747573206164642076616c75652027275175616c69666965642727273b0a20202020656e642069663b0a0a202020206966206e6f742065786973747320280a20202020202073656c65637420310a20202020202066726f6d2070675f656e756d20650a2020202020206a6f696e2070675f747970652074206f6e20742e6f6964203d20652e656e756d74797069640a202020202020776865726520742e7479706e616d65203d20276465616c5f7374617475732720616e6420652e656e756d6c6162656c203d2027436c6f736564270a2020202029207468656e0a202020202020657865637574652027616c7465722074797065207075626c69632e6465616c5f737461747573206164642076616c7565202727436c6f7365642727273b0a20202020656e642069663b0a0a2020656e642069663b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124201457_deal_status_add_qualified_closed.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\n  if exists (select 1 from pg_type where typname = 'deal_status') then\n\n    if not exists (\n      select 1\n      from pg_enum e\n      join pg_type t on t.oid = e.enumtypid\n      where t.typname = 'deal_status' and e.enumlabel = 'Qualified'\n    ) then\n      execute 'alter type public.deal_status add value ''Qualified''';\n    end if;\n\n    if not exists (\n      select 1\n      from pg_enum e\n      join pg_type t on t.oid = e.enumtypid\n      where t.typname = 'deal_status' and e.enumlabel = 'Closed'\n    ) then\n      execute 'alter type public.deal_status add value ''Closed''';\n    end if;\n\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124201457"},{"text":"deal_status_add_qualified_closed"},{"binary":"00000001000000000000001900000001000000010000027c646f202466756e6374696f6e240a626567696e0a2020696620657869737473202873656c65637420312066726f6d2070675f74797065207768657265207479706e616d65203d20276465616c5f7374617475732729207468656e0a0a202020206966206e6f742065786973747320280a20202020202073656c65637420310a20202020202066726f6d2070675f656e756d20650a2020202020206a6f696e2070675f747970652074206f6e20742e6f6964203d20652e656e756d74797069640a202020202020776865726520742e7479706e616d65203d20276465616c5f7374617475732720616e6420652e656e756d6c6162656c203d20275175616c6966696564270a2020202029207468656e0a202020202020657865637574652027616c7465722074797065207075626c69632e6465616c5f737461747573206164642076616c75652027275175616c69666965642727273b0a20202020656e642069663b0a0a202020206966206e6f742065786973747320280a20202020202073656c65637420310a20202020202066726f6d2070675f656e756d20650a2020202020206a6f696e2070675f747970652074206f6e20742e6f6964203d20652e656e756d74797069640a202020202020776865726520742e7479706e616d65203d20276465616c5f7374617475732720616e6420652e656e756d6c6162656c203d2027436c6f736564270a2020202029207468656e0a202020202020657865637574652027616c7465722074797065207075626c69632e6465616c5f737461747573206164642076616c7565202727436c6f7365642727273b0a20202020656e642069663b0a0a2020656e642069663b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124203044_user_profiles_autocreate_and_autoselect_tenant.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure user_profiles exists + is populated, and current_tenant_id is auto-selected.\n-- Fixes \"no workspace\" when profile row is missing.\n\ncreate table if not exists public.user_profiles (\n  user_id uuid primary key,\n  current_tenant_id uuid null,\n  created_at timestamptz not null default now()\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Backfill profiles for any user that already has memberships\ninsert into public.user_profiles (user_id)\nselect distinct tm.user_id\nfrom public.tenant_memberships tm\nleft join public.user_profiles up on up.user_id = tm.user_id\nwhere up.user_id is null","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.ensure_user_profile_and_tenant()\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\ndeclare\n  v_uid uuid;\n  v_cur uuid;\n  v_first uuid;\nbegin\n  v_uid := auth.uid();\n  if v_uid is null then\n    return;\n  end if;\n\n  insert into public.user_profiles (user_id)\n  values (v_uid)\n  on conflict (user_id) do nothing;\n\n  select current_tenant_id into v_cur\n  from public.user_profiles\n  where user_id = v_uid;\n\n  if v_cur is null then\n    select tm.tenant_id into v_first\n    from public.tenant_memberships tm\n    where tm.user_id = v_uid\n    order by tm.created_at asc\n    limit 1;\n\n    if v_first is not null then\n      update public.user_profiles\n      set current_tenant_id = v_first\n      where user_id = v_uid;\n    end if;\n  end if;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.ensure_user_profile_and_tenant() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.ensure_user_profile_and_tenant() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Auto-heal profile/selection whenever the app asks for entitlements\ncreate or replace function public.get_entitlements()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  with _ensure as (\n    select public.ensure_user_profile_and_tenant()\n  )\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role,\n    t.subscription_tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n    and tm.tenant_id = public.current_tenant_id()\n  limit 1;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_entitlements() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124203044"},{"text":"user_profiles_autocreate_and_autoselect_tenant"},{"binary":"00000001000000000000001900000008000000010000012b2d2d20456e7375726520757365725f70726f66696c657320657869737473202b20697320706f70756c617465642c20616e642063757272656e745f74656e616e745f6964206973206175746f2d73656c65637465642e0a2d2d20466978657320226e6f20776f726b737061636522207768656e2070726f66696c6520726f77206973206d697373696e672e0a0a637265617465207461626c65206966206e6f7420657869737473207075626c69632e757365725f70726f66696c657320280a2020757365725f69642075756964207072696d617279206b65792c0a202063757272656e745f74656e616e745f69642075756964206e756c6c2c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728290a29000000fc2d2d204261636b66696c6c2070726f66696c657320666f7220616e792075736572207468617420616c726561647920686173206d656d62657273686970730a696e7365727420696e746f207075626c69632e757365725f70726f66696c65732028757365725f6964290a73656c6563742064697374696e637420746d2e757365725f69640a66726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a6c656674206a6f696e207075626c69632e757365725f70726f66696c6573207570206f6e2075702e757365725f6964203d20746d2e757365725f69640a77686572652075702e757365725f6964206973206e756c6c00000343637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e656e737572655f757365725f70726f66696c655f616e645f74656e616e7428290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a6465636c6172650a2020765f75696420757569643b0a2020765f63757220757569643b0a2020765f666972737420757569643b0a626567696e0a2020765f756964203a3d20617574682e75696428293b0a2020696620765f756964206973206e756c6c207468656e0a2020202072657475726e3b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e757365725f70726f66696c65732028757365725f6964290a202076616c7565732028765f756964290a20206f6e20636f6e666c6963742028757365725f69642920646f206e6f7468696e673b0a0a202073656c6563742063757272656e745f74656e616e745f696420696e746f20765f6375720a202066726f6d207075626c69632e757365725f70726f66696c65730a2020776865726520757365725f6964203d20765f7569643b0a0a2020696620765f637572206973206e756c6c207468656e0a2020202073656c65637420746d2e74656e616e745f696420696e746f20765f66697273740a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e757365725f6964203d20765f7569640a202020206f7264657220627920746d2e637265617465645f6174206173630a202020206c696d697420313b0a0a20202020696620765f6669727374206973206e6f74206e756c6c207468656e0a202020202020757064617465207075626c69632e757365725f70726f66696c65730a2020202020207365742063757272656e745f74656e616e745f6964203d20765f66697273740a202020202020776865726520757365725f6964203d20765f7569643b0a20202020656e642069663b0a2020656e642069663b0a656e64202466756e6374696f6e240000004a7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e656e737572655f757365725f70726f66696c655f616e645f74656e616e7428292066726f6d207075626c6963000000526772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e656e737572655f757365725f70726f66696c655f616e645f74656e616e74282920746f2061757468656e74696361746564000003052d2d204175746f2d6865616c2070726f66696c652f73656c656374696f6e207768656e6576657220746865206170702061736b7320666f7220656e7469746c656d656e74730a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202077697468205f656e7375726520617320280a2020202073656c656374207075626c69632e656e737572655f757365725f70726f66696c655f616e645f74656e616e7428290a2020290a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020742e737562736372697074696f6e5f746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20202020616e6420746d2e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a20206c696d697420313b0a2466756e6374696f6e240000003c7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328292066726f6d207075626c6963000000446772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e7473282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42P07","Message":"relation \"user_profiles\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"parse_utilcmd.c","Line":207,"Routine":"transformCreateStmt","UnknownFields":null}
NOTICE (42P07): relation "user_profiles" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124203303_workspaces_list_rpc_and_user_profiles_policies.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- user_profiles: enable self access so the row can exist and be read/updated by the owner\nalter table public.user_profiles enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists user_profiles_select_own on public.user_profiles","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy user_profiles_select_own\non public.user_profiles\nfor select\nto authenticated\nusing (user_id = auth.uid())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists user_profiles_insert_own on public.user_profiles","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy user_profiles_insert_own\non public.user_profiles\nfor insert\nto authenticated\nwith check (user_id = auth.uid())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop policy if exists user_profiles_update_own on public.user_profiles","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create policy user_profiles_update_own\non public.user_profiles\nfor update\nto authenticated\nusing (user_id = auth.uid())\nwith check (user_id = auth.uid())","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- list all workspaces for the current user (does NOT depend on current_tenant_id)\ncreate or replace function public.get_my_workspaces()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role,\n    t.subscription_tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_workspaces() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_workspaces() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124203303"},{"text":"workspaces_list_rpc_and_user_profiles_policies"},{"binary":"0000000100000000000000190000000a00000001000000952d2d20757365725f70726f66696c65733a20656e61626c652073656c662061636365737320736f2074686520726f772063616e20657869737420616e6420626520726561642f7570646174656420627920746865206f776e65720a616c746572207461626c65207075626c69632e757365725f70726f66696c657320656e61626c6520726f77206c6576656c2073656375726974790000004664726f7020706f6c6963792069662065786973747320757365725f70726f66696c65735f73656c6563745f6f776e206f6e207075626c69632e757365725f70726f66696c65730000007763726561746520706f6c69637920757365725f70726f66696c65735f73656c6563745f6f776e0a6f6e207075626c69632e757365725f70726f66696c65730a666f722073656c6563740a746f2061757468656e746963617465640a7573696e672028757365725f6964203d20617574682e7569642829290000004664726f7020706f6c6963792069662065786973747320757365725f70726f66696c65735f696e736572745f6f776e206f6e207075626c69632e757365725f70726f66696c65730000007c63726561746520706f6c69637920757365725f70726f66696c65735f696e736572745f6f776e0a6f6e207075626c69632e757365725f70726f66696c65730a666f7220696e736572740a746f2061757468656e746963617465640a7769746820636865636b2028757365725f6964203d20617574682e7569642829290000004664726f7020706f6c6963792069662065786973747320757365725f70726f66696c65735f7570646174655f6f776e206f6e207075626c69632e757365725f70726f66696c65730000009963726561746520706f6c69637920757365725f70726f66696c65735f7570646174655f6f776e0a6f6e207075626c69632e757365725f70726f66696c65730a666f72207570646174650a746f2061757468656e746963617465640a7573696e672028757365725f6964203d20617574682e7569642829290a7769746820636865636b2028757365725f6964203d20617574682e756964282929000002aa2d2d206c69737420616c6c20776f726b73706163657320666f72207468652063757272656e7420757365722028646f6573204e4f5420646570656e64206f6e2063757272656e745f74656e616e745f6964290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020742e737562736372697074696f6e5f746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f617420646573633b0a2466756e6374696f6e240000003d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328292066726f6d207075626c6963000000456772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b737061636573282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"user_profiles_select_own\" for relation \"public.user_profiles\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "user_profiles_select_own" for relation "public.user_profiles" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"user_profiles_insert_own\" for relation \"public.user_profiles\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "user_profiles_insert_own" for relation "public.user_profiles" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"policy \"user_profiles_update_own\" for relation \"public.user_profiles\" does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): policy "user_profiles_update_own" for relation "public.user_profiles" does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE POLICY"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124203424_fix_get_entitlements_remove_membership_tier.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Fix: tenant_memberships has no tier column. Tier is on tenants.\ncreate or replace function public.get_entitlements()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  with _ensure as (\n    select public.ensure_user_profile_and_tenant()\n  )\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role,\n    t.subscription_tier as tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n    and tm.tenant_id = public.current_tenant_id()\n  limit 1;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_entitlements() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Also fix list rpc to use tenant tier\ncreate or replace function public.get_my_workspaces()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role,\n    t.subscription_tier as tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_workspaces() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_workspaces() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124203424"},{"text":"fix_get_entitlements_remove_membership_tier"},{"binary":"00000001000000000000001900000006000000010000030a2d2d204669783a2074656e616e745f6d656d626572736869707320686173206e6f207469657220636f6c756d6e2e2054696572206973206f6e2074656e616e74732e0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202077697468205f656e7375726520617320280a2020202073656c656374207075626c69632e656e737572655f757365725f70726f66696c655f616e645f74656e616e7428290a2020290a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020742e737562736372697074696f6e5f7469657220617320746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20202020616e6420746d2e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a20206c696d697420313b0a2466756e6374696f6e240000003c7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328292066726f6d207075626c6963000000446772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e7473282920746f2061757468656e74696361746564000002872d2d20416c736f20666978206c6973742072706320746f207573652074656e616e7420746965720a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020742e737562736372697074696f6e5f7469657220617320746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f617420646573633b0a2466756e6374696f6e240000003d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328292066726f6d207075626c6963000000456772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b737061636573282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260124203753_create_get_my_workspaces_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.get_my_workspaces()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, extensions, pg_temp\nas $function$\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role,\n    t.subscription_tier as tier,\n    t.subscription_status as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_workspaces() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_workspaces() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260124203753"},{"text":"create_get_my_workspaces_rpc"},{"binary":"00000001000000000000001900000003000000010000025f637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20657874656e73696f6e732c2070675f74656d700a6173202466756e6374696f6e240a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020742e737562736372697074696f6e5f7469657220617320746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f617420646573633b0a2466756e6374696f6e240000003d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328292066726f6d207075626c6963000000456772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b737061636573282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125075221_recreate_get_my_workspaces.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- recreate get_my_workspaces with the correct OUT signature\ndrop function if exists public.get_my_workspaces()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_my_workspaces()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status public.subscription_status,\n  trial_ends_at timestamptz,\n  seat_limit int,\n  seat_count int\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $function$\n  select\n    t.id as tenant_id,\n    t.workspace_name,\n    tm.role::text as role,\n    t.subscription_tier::text as tier,\n    t.subscription_status as status,\n    t.trial_ends_at,\n    t.seat_limit,\n    t.seat_count\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by t.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_workspaces() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_workspaces() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125075221"},{"text":"recreate_get_my_workspaces"},{"binary":"00000001000000000000001900000004000000010000006f2d2d207265637265617465206765745f6d795f776f726b73706163657320776974682074686520636f7272656374204f5554207369676e61747572650a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f6d795f776f726b7370616365732829000002a76372656174652066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a2020737461747573207075626c69632e737562736372697074696f6e5f7374617475732c0a2020747269616c5f656e64735f61742074696d657374616d70747a2c0a2020736561745f6c696d697420696e742c0a2020736561745f636f756e7420696e740a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a202073656c6563740a20202020742e69642061732074656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c653a3a7465787420617320726f6c652c0a20202020742e737562736372697074696f6e5f746965723a3a7465787420617320746965722c0a20202020742e737562736372697074696f6e5f737461747573206173207374617475732c0a20202020742e747269616c5f656e64735f61742c0a20202020742e736561745f6c696d69742c0a20202020742e736561745f636f756e740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920742e637265617465645f617420646573633b0a2466756e6374696f6e240000003d7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b73706163657328292066726f6d207075626c6963000000456772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f776f726b737061636573282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125080113_workspace_leave_delete.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- leave workspace (non-owner only)\ncreate or replace function public.leave_workspace(p_tenant_id uuid)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not public.is_member(p_tenant_id, auth.uid()) then\n    raise exception 'NOT_A_MEMBER';\n  end if;\n\n  if exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = p_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_CANNOT_LEAVE';\n  end if;\n\n  delete from public.tenant_memberships\n  where tenant_id = p_tenant_id\n    and user_id = auth.uid();\n\n  -- if profiles exist, clear current_tenant_id when leaving it\n  if to_regclass('public.user_profiles') is not null then\n    execute format(\n      'update public.user_profiles set current_tenant_id = null where user_id = %L and current_tenant_id = %L',\n      auth.uid(), p_tenant_id\n    );\n  end if;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.leave_workspace(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.leave_workspace(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- delete workspace (owner only)\ncreate or replace function public.delete_workspace(p_tenant_id uuid)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = p_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  -- best-effort cleanup (covers the tables we know exist)\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', p_tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', p_tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', p_tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = p_tenant_id;\n  delete from public.tenants where id = p_tenant_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_workspace(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_workspace(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125080113"},{"text":"workspace_leave_delete"},{"binary":"0000000100000000000000190000000600000001000004092d2d206c6561766520776f726b737061636520286e6f6e2d6f776e6572206f6e6c79290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6c656176655f776f726b737061636528705f74656e616e745f69642075756964290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e69735f6d656d62657228705f74656e616e745f69642c20617574682e756964282929207468656e0a20202020726169736520657863657074696f6e20274e4f545f415f4d454d424552273b0a2020656e642069663b0a0a202069662065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f43414e4e4f545f4c45415645273b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970730a202077686572652074656e616e745f6964203d20705f74656e616e745f69640a20202020616e6420757365725f6964203d20617574682e75696428293b0a0a20202d2d2069662070726f66696c65732065786973742c20636c6561722063757272656e745f74656e616e745f6964207768656e206c656176696e672069740a2020696620746f5f726567636c61737328277075626c69632e757365725f70726f66696c65732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174280a20202020202027757064617465207075626c69632e757365725f70726f66696c6573207365742063757272656e745f74656e616e745f6964203d206e756c6c20776865726520757365725f6964203d20254c20616e642063757272656e745f74656e616e745f6964203d20254c272c0a202020202020617574682e75696428292c20705f74656e616e745f69640a20202020293b0a2020656e642069663b0a656e643b0a2466756e6374696f6e240000003f7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6c656176655f776f726b73706163652875756964292066726f6d207075626c6963000000476772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6c656176655f776f726b737061636528757569642920746f2061757468656e74696361746564000004862d2d2064656c65746520776f726b737061636520286f776e6572206f6e6c79290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e64656c6574655f776f726b737061636528705f74656e616e745f69642075756964290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a20202d2d20626573742d6566666f727420636c65616e75702028636f7665727320746865207461626c6573207765206b6e6f77206578697374290a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20705f74656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20705f74656e616e745f69643b0a656e643b0a2466756e6374696f6e24000000407265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163652875756964292066726f6d207075626c6963000000486772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b737061636528757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125080646_fix_delete_workspace_and_reload_pgrst.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Fix delete_workspace RPC visibility + force PostgREST schema reload\ndrop function if exists public.delete_workspace(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_workspace(p_tenant_id uuid)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = p_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', p_tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', p_tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', p_tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = p_tenant_id;\n  delete from public.tenants where id = p_tenant_id;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_workspace(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_workspace(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_workspace(uuid) is 'Owner-only hard delete of a tenant workspace.'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125080646"},{"text":"fix_delete_workspace_and_reload_pgrst"},{"binary":"00000001000000000000001900000005000000010000007c2d2d204669782064656c6574655f776f726b737061636520525043207669736962696c697479202b20666f72636520506f7374675245535420736368656d612072656c6f61640a64726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f776f726b73706163652875756964290000041f6372656174652066756e6374696f6e207075626c69632e64656c6574655f776f726b737061636528705f74656e616e745f69642075756964290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20705f74656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20705f74656e616e745f69643b0a656e643b0a2466756e6374696f6e24000000407265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163652875756964292066726f6d207075626c6963000000486772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b737061636528757569642920746f2061757468656e7469636174656400000064636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b737061636528757569642920697320274f776e65722d6f6e6c7920686172642064656c657465206f6620612074656e616e7420776f726b73706163652e27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125081125_delete_workspace_rpc_wrapper.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Wrapper RPC to avoid PostgREST schema-cache issues on delete_workspace()\ndrop function if exists public.delete_workspace_rpc(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_workspace_rpc(p_tenant_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\nbegin\n  -- call the underlying function if present; otherwise perform inline delete (same logic)\n  if to_regprocedure('public.delete_workspace(uuid)') is not null then\n    perform public.delete_workspace(p_tenant_id);\n  else\n    if auth.uid() is null then raise exception 'AUTH_REQUIRED'; end if;\n\n    if not exists (\n      select 1\n      from public.tenant_memberships tm\n      where tm.tenant_id = p_tenant_id\n        and tm.user_id = auth.uid()\n        and tm.role::text = 'owner'\n    ) then\n      raise exception 'OWNER_ONLY';\n    end if;\n\n    if to_regclass('public.documents') is not null then\n      execute format('delete from public.documents where tenant_id = %L', p_tenant_id);\n    end if;\n\n    if to_regclass('public.deals') is not null then\n      execute format('delete from public.deals where tenant_id = %L', p_tenant_id);\n    end if;\n\n    if to_regclass('public.tenant_invites') is not null then\n      execute format('delete from public.tenant_invites where tenant_id = %L', p_tenant_id);\n    end if;\n\n    delete from public.tenant_memberships where tenant_id = p_tenant_id;\n    delete from public.tenants where id = p_tenant_id;\n  end if;\n\n  return jsonb_build_object('ok', true, 'tenant_id', p_tenant_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_workspace_rpc(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_workspace_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_workspace_rpc(uuid) is 'Owner-only hard delete of a tenant workspace (RPC wrapper).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125081125"},{"text":"delete_workspace_rpc_wrapper"},{"binary":"0000000100000000000000190000000500000001000000852d2d20577261707065722052504320746f2061766f696420506f7374675245535420736368656d612d636163686520697373756573206f6e2064656c6574655f776f726b737061636528290a64726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f776f726b73706163655f727063287575696429000005716372656174652066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f72706328705f74656e616e745f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a626567696e0a20202d2d2063616c6c2074686520756e6465726c79696e672066756e6374696f6e2069662070726573656e743b206f746865727769736520706572666f726d20696e6c696e652064656c657465202873616d65206c6f676963290a2020696620746f5f72656770726f63656475726528277075626c69632e64656c6574655f776f726b73706163652875756964292729206973206e6f74206e756c6c207468656e0a20202020706572666f726d207075626c69632e64656c6574655f776f726b737061636528705f74656e616e745f6964293b0a2020656c73650a20202020696620617574682e7569642829206973206e756c6c207468656e20726169736520657863657074696f6e2027415554485f5245515549524544273b20656e642069663b0a0a202020206966206e6f742065786973747320280a20202020202073656c65637420310a20202020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a202020202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640a2020202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a2020202029207468656e0a202020202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a20202020656e642069663b0a0a20202020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a2020202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a20202020656e642069663b0a0a20202020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a2020202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a20202020656e642069663b0a0a20202020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a2020202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20705f74656e616e745f6964293b0a20202020656e642069663b0a0a2020202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20705f74656e616e745f69643b0a2020202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20705f74656e616e745f69643b0a2020656e642069663b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20705f74656e616e745f6964293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f7270632875756964292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f72706328757569642920746f2061757468656e7469636174656400000076636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f72706328757569642920697320274f776e65722d6f6e6c7920686172642064656c657465206f6620612074656e616e7420776f726b737061636520285250432077726170706572292e27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.delete_workspace_rpc(uuid) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.delete_workspace_rpc(uuid) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125081550_recreate_delete_workspace_rpc_argname.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.delete_workspace_rpc(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_workspace_rpc(tenant_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = tenant_id;\n  delete from public.tenants where id = tenant_id;\n\n  return jsonb_build_object('ok', true, 'tenant_id', tenant_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_workspace_rpc(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_workspace_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_workspace_rpc(uuid) is 'Owner-only hard delete of a tenant workspace (RPC wrapper).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125081550"},{"text":"recreate_delete_workspace_rpc_argname"},{"binary":"00000001000000000000001900000005000000010000003964726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f776f726b73706163655f727063287575696429000004586372656174652066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f7270632874656e616e745f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d2074656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c2074656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c2074656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c2074656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d2074656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d2074656e616e745f69643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c2074656e616e745f6964293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f7270632875756964292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f72706328757569642920746f2061757468656e7469636174656400000076636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f776f726b73706163655f72706328757569642920697320274f776e65722d6f6e6c7920686172642064656c657465206f6620612074656e616e7420776f726b737061636520285250432077726170706572292e27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125081951_delete_current_workspace_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- (comment cleaned: removed schema-cache wording)\ndrop function if exists public.delete_current_workspace()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_current_workspace()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_tenant_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_tenant_id := public.current_tenant_id();\n  if v_tenant_id is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', v_tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = v_tenant_id;\n  delete from public.tenants where id = v_tenant_id;\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tenant_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_current_workspace() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_current_workspace() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_current_workspace() is 'Owner-only hard delete of the CURRENT tenant workspace (no args).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125081951"},{"text":"delete_current_workspace_rpc"},{"binary":"00000001000000000000001900000005000000010000006c2d2d2028636f6d6d656e7420636c65616e65643a2072656d6f76656420736368656d612d636163686520776f7264696e67290a64726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f63757272656e745f776f726b73706163652829000004f76372656174652066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b737061636528290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f74656e616e745f6964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20765f74656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20765f74656e616e745f69643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f74656e616e745f6964293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b737061636528292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b7370616365282920746f2061757468656e746963617465640000007c636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b7370616365282920697320274f776e65722d6f6e6c7920686172642064656c657465206f66207468652043555252454e542074656e616e7420776f726b737061636520286e6f2061726773292e27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.delete_current_workspace() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.delete_current_workspace() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125082044_delete_current_workspace_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- (comment cleaned: removed schema-cache wording)\ndrop function if exists public.delete_current_workspace()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_current_workspace()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_tenant_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_tenant_id := public.current_tenant_id();\n  if v_tenant_id is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', v_tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = v_tenant_id;\n  delete from public.tenants where id = v_tenant_id;\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tenant_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_current_workspace() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_current_workspace() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_current_workspace() is 'Owner-only hard delete of the CURRENT tenant workspace (no args).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125082044"},{"text":"delete_current_workspace_rpc"},{"binary":"00000001000000000000001900000005000000010000006c2d2d2028636f6d6d656e7420636c65616e65643a2072656d6f76656420736368656d612d636163686520776f7264696e67290a64726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f63757272656e745f776f726b73706163652829000004f76372656174652066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b737061636528290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f74656e616e745f6964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20765f74656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20765f74656e616e745f69643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f74656e616e745f6964293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b737061636528292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b7370616365282920746f2061757468656e746963617465640000007c636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b7370616365282920697320274f776e65722d6f6e6c7920686172642064656c657465206f66207468652043555252454e542074656e616e7420776f726b737061636520286e6f2061726773292e27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125082652_rpc_wrappers_invite_delete.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Canonical wrappers to avoid PostgREST schema-cache + arg-name mismatches.\n\n-- CREATE INVITE (canonical)\ndrop function if exists public.create_invite_rpc(uuid, text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.create_invite_rpc(tenant_id uuid, email text)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_token text;\n  v_seat_limit int;\n  v_seat_count int;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if tenant_id is null or coalesce(email,'') = '' then\n    raise exception 'tenant_id and email required';\n  end if;\n\n  if to_regclass('public.tenant_invites') is null then\n    raise exception 'tenant_invites table missing';\n  end if;\n\n  -- must be owner/admin of tenant\n  if not public.is_owner_or_admin(tenant_id, auth.uid()) then\n    raise exception 'OWNER_OR_ADMIN_ONLY';\n  end if;\n\n  -- seat enforcement (block if already full)\n  select t.seat_limit, t.seat_count\n    into v_seat_limit, v_seat_count\n  from public.tenants t\n  where t.id = tenant_id;\n\n  if v_seat_limit is not null and v_seat_count is not null and v_seat_count \u003e= v_seat_limit then\n    raise exception 'SEAT_LIMIT_REACHED';\n  end if;\n\n  -- token\n  v_token := encode(extensions.gen_random_bytes(16), 'hex');\n\n  insert into public.tenant_invites(tenant_id, email, token, created_by, revoked_at, accepted_at)\n  values (tenant_id, lower(email), v_token, auth.uid(), null, null);\n\n  return jsonb_build_object('ok', true, 'token', v_token, 'tenant_id', tenant_id, 'email', lower(email));\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.create_invite_rpc(uuid, text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_invite_rpc(uuid, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.create_invite_rpc(uuid, text) is 'Canonical invite RPC: create_invite_rpc(tenant_id uuid, email text).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- DELETE CURRENT WORKSPACE (canonical, no args)\ndrop function if exists public.delete_current_workspace_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.delete_current_workspace_rpc()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_tenant_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_tenant_id := public.current_tenant_id();\n  if v_tenant_id is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text = 'owner'\n  ) then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  if to_regclass('public.documents') is not null then\n    execute format('delete from public.documents where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.deals') is not null then\n    execute format('delete from public.deals where tenant_id = %L', v_tenant_id);\n  end if;\n\n  if to_regclass('public.tenant_invites') is not null then\n    execute format('delete from public.tenant_invites where tenant_id = %L', v_tenant_id);\n  end if;\n\n  delete from public.tenant_memberships where tenant_id = v_tenant_id;\n  delete from public.tenants where id = v_tenant_id;\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tenant_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.delete_current_workspace_rpc() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.delete_current_workspace_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.delete_current_workspace_rpc() is 'Canonical delete RPC: deletes CURRENT tenant (owner-only).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.create_invite_rpc(uuid,text) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125082652"},{"text":"rpc_wrappers_invite_delete"},{"binary":"0000000100000000000000190000000a00000001000000a72d2d2043616e6f6e6963616c20777261707065727320746f2061766f696420506f7374675245535420736368656d612d6361636865202b206172672d6e616d65206d69736d6174636865732e0a0a2d2d2043524541544520494e56495445202863616e6f6e6963616c290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6372656174655f696e766974655f72706328757569642c2074657874290000056d6372656174652066756e6374696f6e207075626c69632e6372656174655f696e766974655f7270632874656e616e745f696420757569642c20656d61696c2074657874290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f746f6b656e20746578743b0a2020765f736561745f6c696d697420696e743b0a2020765f736561745f636f756e7420696e743b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202069662074656e616e745f6964206973206e756c6c206f7220636f616c6573636528656d61696c2c272729203d202727207468656e0a20202020726169736520657863657074696f6e202774656e616e745f696420616e6420656d61696c207265717569726564273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e756c6c207468656e0a20202020726169736520657863657074696f6e202774656e616e745f696e7669746573207461626c65206d697373696e67273b0a2020656e642069663b0a0a20202d2d206d757374206265206f776e65722f61646d696e206f662074656e616e740a20206966206e6f74207075626c69632e69735f6f776e65725f6f725f61646d696e2874656e616e745f69642c20617574682e756964282929207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f525f41444d494e5f4f4e4c59273b0a2020656e642069663b0a0a20202d2d207365617420656e666f7263656d656e742028626c6f636b20696620616c72656164792066756c6c290a202073656c65637420742e736561745f6c696d69742c20742e736561745f636f756e740a20202020696e746f20765f736561745f6c696d69742c20765f736561745f636f756e740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d2074656e616e745f69643b0a0a2020696620765f736561745f6c696d6974206973206e6f74206e756c6c20616e6420765f736561745f636f756e74206973206e6f74206e756c6c20616e6420765f736561745f636f756e74203e3d20765f736561745f6c696d6974207468656e0a20202020726169736520657863657074696f6e2027534541545f4c494d49545f52454143484544273b0a2020656e642069663b0a0a20202d2d20746f6b656e0a2020765f746f6b656e203a3d20656e636f646528657874656e73696f6e732e67656e5f72616e646f6d5f6279746573283136292c202768657827293b0a0a2020696e7365727420696e746f207075626c69632e74656e616e745f696e76697465732874656e616e745f69642c20656d61696c2c20746f6b656e2c20637265617465645f62792c207265766f6b65645f61742c2061636365707465645f6174290a202076616c756573202874656e616e745f69642c206c6f77657228656d61696c292c20765f746f6b656e2c20617574682e75696428292c206e756c6c2c206e756c6c293b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c2027746f6b656e272c20765f746f6b656e2c202774656e616e745f6964272c2074656e616e745f69642c2027656d61696c272c206c6f77657228656d61696c29293b0a656e643b0a2466756e6374696f6e24000000477265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c2074657874292066726f6d207075626c69630000004f6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c20746578742920746f2061757468656e7469636174656400000082636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c207465787429206973202743616e6f6e6963616c20696e76697465205250433a206372656174655f696e766974655f7270632874656e616e745f696420757569642c20656d61696c2074657874292e270000006e2d2d2044454c4554452043555252454e5420574f524b5350414345202863616e6f6e6963616c2c206e6f2061726773290a64726f702066756e6374696f6e20696620657869737473207075626c69632e64656c6574655f63757272656e745f776f726b73706163655f7270632829000004fb6372656174652066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b73706163655f72706328290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f74656e616e745f6964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a74657874203d20276f776e6572270a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e646f63756d656e74732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e646f63756d656e74732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e6465616c732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e6465616c732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a2020696620746f5f726567636c61737328277075626c69632e74656e616e745f696e76697465732729206973206e6f74206e756c6c207468656e0a202020206578656375746520666f726d6174282764656c6574652066726f6d207075626c69632e74656e616e745f696e76697465732077686572652074656e616e745f6964203d20254c272c20765f74656e616e745f6964293b0a2020656e642069663b0a0a202064656c6574652066726f6d207075626c69632e74656e616e745f6d656d62657273686970732077686572652074656e616e745f6964203d20765f74656e616e745f69643b0a202064656c6574652066726f6d207075626c69632e74656e616e7473207768657265206964203d20765f74656e616e745f69643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f74656e616e745f6964293b0a656e643b0a2466756e6374696f6e24000000487265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b73706163655f72706328292066726f6d207075626c6963000000506772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b73706163655f727063282920746f2061757468656e7469636174656400000079636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e64656c6574655f63757272656e745f776f726b73706163655f7270632829206973202743616e6f6e6963616c2064656c657465205250433a2064656c657465732043555252454e542074656e616e7420286f776e65722d6f6e6c79292e27"}],"ResultFormatCodes":[]}
NOTICE (00000): function public.create_invite_rpc(uuid,text) does not exist, skipping
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.delete_current_workspace_rpc() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.delete_current_workspace_rpc() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125083631_invites_accept_revoke_list.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure tenant_invites has columns required by get_invites_rpc (idempotent; fixes replay drift)\ndo $m$\nbegin\n  if exists (\n    select 1\n    from information_schema.tables\n    where table_schema='public' and table_name='tenant_invites'\n  ) then\n    alter table public.tenant_invites add column if not exists invited_role text not null default 'member';\n    alter table public.tenant_invites add column if not exists token text not null default '';\n    alter table public.tenant_invites add column if not exists created_at timestamptz not null default now();\n    alter table public.tenant_invites add column if not exists expires_at timestamptz;\n    alter table public.tenant_invites add column if not exists revoked_at timestamptz;\n    alter table public.tenant_invites add column if not exists accepted_at timestamptz;\n    alter table public.tenant_invites add column if not exists accepted_by uuid;\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"begin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Create invite (owner/admin only) -\u003e matches tenant_invites columns\ncreate or replace function public.create_invite_rpc(tenant_id uuid, email text)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_token text;\n  v_seat_limit int;\n  v_seat_count int;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if tenant_id is null or coalesce(email,'') = '' then\n    raise exception 'tenant_id and email required';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = create_invite_rpc.tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text in ('owner','admin')\n  ) then\n    raise exception 'OWNER_OR_ADMIN_ONLY';\n  end if;\n\n  select t.seat_limit, t.seat_count\n    into v_seat_limit, v_seat_count\n  from public.tenants t\n  where t.id = create_invite_rpc.tenant_id;\n\n  if v_seat_limit is not null and v_seat_count is not null and v_seat_count \u003e= v_seat_limit then\n    raise exception 'SEAT_LIMIT_REACHED';\n  end if;\n\n  v_token := encode(extensions.gen_random_bytes(16), 'hex');\n\n  insert into public.tenant_invites(\n    tenant_id,\n    invited_email,\n    invited_email_lc,\n    invited_role,\n    token,\n    created_by,\n    expires_at,\n    revoked_at,\n    accepted_at,\n    accepted_by\n  )\n  values (\n    create_invite_rpc.tenant_id,\n    email,\n    lower(email),\n    'member',\n    v_token,\n    auth.uid(),\n    now() + interval '7 days',\n    null,\n    null,\n    null\n  );\n\n  return jsonb_build_object(\n    'ok', true,\n    'tenant_id', create_invite_rpc.tenant_id,\n    'email', lower(create_invite_rpc.email),\n    'token', v_token\n  );\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.create_invite_rpc(uuid, text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_invite_rpc(uuid, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.create_invite_rpc(uuid, text) is 'Create invite (owner/admin).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- List invites for CURRENT tenant (owner/admin only)\ndrop function if exists public.get_invites_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_invites_rpc()\nreturns table (\n  id uuid,\n  tenant_id uuid,\n  invited_email text,\n  invited_role text,\n  token text,\n  created_at timestamptz,\n  expires_at timestamptz,\n  revoked_at timestamptz,\n  accepted_at timestamptz,\n  accepted_by uuid\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $function$\n  with ct as (\n    select public.current_tenant_id() as tenant_id\n  )\n  select\n    i.id,\n    i.tenant_id,\n    i.invited_email,\n    i.invited_role,\n    i.token,\n    i.created_at,\n    i.expires_at,\n    i.revoked_at,\n    i.accepted_at,\n    i.accepted_by\n  from public.tenant_invites i\n  join ct on ct.tenant_id = i.tenant_id\n  where auth.uid() is not null\n    and exists (\n      select 1\n      from public.tenant_memberships tm\n      where tm.tenant_id = i.tenant_id\n        and tm.user_id = auth.uid()\n        and tm.role::text in ('owner','admin')\n    )\n  order by i.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_invites_rpc() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_invites_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.get_invites_rpc() is 'List invites for CURRENT tenant (owner/admin).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Revoke invite by invite id (owner/admin only)\ndrop function if exists public.revoke_invite_rpc(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.revoke_invite_rpc(invite_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_tenant_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  select i.tenant_id into v_tenant_id\n  from public.tenant_invites i\n  where i.id = revoke_invite_rpc.invite_id;\n\n  if v_tenant_id is null then\n    raise exception 'INVITE_NOT_FOUND';\n  end if;\n\n  if not exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tenant_id\n      and tm.user_id = auth.uid()\n      and tm.role::text in ('owner','admin')\n  ) then\n    raise exception 'OWNER_OR_ADMIN_ONLY';\n  end if;\n\n  update public.tenant_invites\n  set revoked_at = now()\n  where id = revoke_invite_rpc.invite_id\n    and revoked_at is null\n    and accepted_at is null;\n\n  return jsonb_build_object('ok', true, 'invite_id', revoke_invite_rpc.invite_id);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.revoke_invite_rpc(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.revoke_invite_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.revoke_invite_rpc(uuid) is 'Revoke invite (owner/admin).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Accept invite by token (authenticated)\ndrop function if exists public.accept_invite_rpc(text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.accept_invite_rpc(token text)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_inv public.tenant_invites%rowtype;\n  v_email text;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_email := lower(coalesce(auth.jwt()-\u003e\u003e'email',''));\n\n  select *\n  into v_inv\n  from public.tenant_invites i\n  where i.token = accept_invite_rpc.token\n  limit 1;\n\n  if v_inv.id is null then\n    raise exception 'INVITE_NOT_FOUND';\n  end if;\n\n  if v_inv.revoked_at is not null then\n    raise exception 'INVITE_REVOKED';\n  end if;\n\n  if v_inv.accepted_at is not null then\n    raise exception 'INVITE_ALREADY_ACCEPTED';\n  end if;\n\n  if v_inv.expires_at is not null and v_inv.expires_at \u003c now() then\n    raise exception 'INVITE_EXPIRED';\n  end if;\n\n  -- If we have email in JWT, enforce match to invited_email_lc\n  if v_email \u003c\u003e '' and v_inv.invited_email_lc is not null and v_email \u003c\u003e v_inv.invited_email_lc then\n    raise exception 'EMAIL_MISMATCH';\n  end if;\n\n  -- Ensure membership (role from invite)\n  insert into public.tenant_memberships(tenant_id, user_id, role)\n  values (v_inv.tenant_id, auth.uid(), v_inv.invited_role::public.tenant_role)\n  on conflict (tenant_id, user_id) do nothing;\n\n  update public.tenant_invites\n  set accepted_at = now(),\n      accepted_by = auth.uid()\n  where id = v_inv.id;\n\n  -- Set current tenant if profile exists\n  if to_regclass('public.user_profiles') is not null then\n    update public.user_profiles\n    set current_tenant_id = v_inv.tenant_id\n    where user_id = auth.uid();\n  end if;\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_inv.tenant_id, 'role', v_inv.invited_role);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.accept_invite_rpc(text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.accept_invite_rpc(text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.accept_invite_rpc(text) is 'Accept invite by token; creates membership and selects tenant.'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125083631"},{"text":"invites_accept_revoke_list"},{"binary":"0000000100000000000000190000001600000001000003972d2d20456e737572652074656e616e745f696e76697465732068617320636f6c756d6e73207265717569726564206279206765745f696e76697465735f72706320286964656d706f74656e743b206669786573207265706c6179206472696674290a646f20246d240a626567696e0a202069662065786973747320280a2020202073656c65637420310a2020202066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c65730a202020207768657265207461626c655f736368656d613d277075626c69632720616e64207461626c655f6e616d653d2774656e616e745f696e7669746573270a202029207468656e0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f742065786973747320696e76697465645f726f6c652074657874206e6f74206e756c6c2064656661756c7420276d656d626572273b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f742065786973747320746f6b656e2074657874206e6f74206e756c6c2064656661756c742027273b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f742065786973747320637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728293b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f742065786973747320657870697265735f61742074696d657374616d70747a3b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f7420657869737473207265766f6b65645f61742074696d657374616d70747a3b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f74206578697374732061636365707465645f61742074696d657374616d70747a3b0a20202020616c746572207461626c65207075626c69632e74656e616e745f696e76697465732061646420636f6c756d6e206966206e6f74206578697374732061636365707465645f627920757569643b0a2020656e642069663b0a656e640a246d2400000005626567696e000006a72d2d2043726561746520696e7669746520286f776e65722f61646d696e206f6e6c7929202d3e206d6174636865732074656e616e745f696e766974657320636f6c756d6e730a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6372656174655f696e766974655f7270632874656e616e745f696420757569642c20656d61696c2074657874290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f746f6b656e20746578743b0a2020765f736561745f6c696d697420696e743b0a2020765f736561745f636f756e7420696e743b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202069662074656e616e745f6964206973206e756c6c206f7220636f616c6573636528656d61696c2c272729203d202727207468656e0a20202020726169736520657863657074696f6e202774656e616e745f696420616e6420656d61696c207265717569726564273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d206372656174655f696e766974655f7270632e74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a7465787420696e2028276f776e6572272c2761646d696e27290a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f525f41444d494e5f4f4e4c59273b0a2020656e642069663b0a0a202073656c65637420742e736561745f6c696d69742c20742e736561745f636f756e740a20202020696e746f20765f736561745f6c696d69742c20765f736561745f636f756e740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d206372656174655f696e766974655f7270632e74656e616e745f69643b0a0a2020696620765f736561745f6c696d6974206973206e6f74206e756c6c20616e6420765f736561745f636f756e74206973206e6f74206e756c6c20616e6420765f736561745f636f756e74203e3d20765f736561745f6c696d6974207468656e0a20202020726169736520657863657074696f6e2027534541545f4c494d49545f52454143484544273b0a2020656e642069663b0a0a2020765f746f6b656e203a3d20656e636f646528657874656e73696f6e732e67656e5f72616e646f6d5f6279746573283136292c202768657827293b0a0a2020696e7365727420696e746f207075626c69632e74656e616e745f696e7669746573280a2020202074656e616e745f69642c0a20202020696e76697465645f656d61696c2c0a20202020696e76697465645f656d61696c5f6c632c0a20202020696e76697465645f726f6c652c0a20202020746f6b656e2c0a20202020637265617465645f62792c0a20202020657870697265735f61742c0a202020207265766f6b65645f61742c0a2020202061636365707465645f61742c0a2020202061636365707465645f62790a2020290a202076616c75657320280a202020206372656174655f696e766974655f7270632e74656e616e745f69642c0a20202020656d61696c2c0a202020206c6f77657228656d61696c292c0a20202020276d656d626572272c0a20202020765f746f6b656e2c0a20202020617574682e75696428292c0a202020206e6f772829202b20696e74657276616c2027372064617973272c0a202020206e756c6c2c0a202020206e756c6c2c0a202020206e756c6c0a2020293b0a0a202072657475726e206a736f6e625f6275696c645f6f626a656374280a20202020276f6b272c20747275652c0a202020202774656e616e745f6964272c206372656174655f696e766974655f7270632e74656e616e745f69642c0a2020202027656d61696c272c206c6f776572286372656174655f696e766974655f7270632e656d61696c292c0a2020202027746f6b656e272c20765f746f6b656e0a2020293b0a656e643b0a2466756e6374696f6e24000000477265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c2074657874292066726f6d207075626c69630000004f6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c20746578742920746f2061757468656e746963617465640000005a636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c207465787429206973202743726561746520696e7669746520286f776e65722f61646d696e292e27000000662d2d204c69737420696e766974657320666f722043555252454e542074656e616e7420286f776e65722f61646d696e206f6e6c79290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f696e76697465735f7270632829000003b06372656174652066756e6374696f6e207075626c69632e6765745f696e76697465735f72706328290a72657475726e73207461626c6520280a2020696420757569642c0a202074656e616e745f696420757569642c0a2020696e76697465645f656d61696c20746578742c0a2020696e76697465645f726f6c6520746578742c0a2020746f6b656e20746578742c0a2020637265617465645f61742074696d657374616d70747a2c0a2020657870697265735f61742074696d657374616d70747a2c0a20207265766f6b65645f61742074696d657374616d70747a2c0a202061636365707465645f61742074696d657374616d70747a2c0a202061636365707465645f627920757569640a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a20207769746820637420617320280a2020202073656c656374207075626c69632e63757272656e745f74656e616e745f696428292061732074656e616e745f69640a2020290a202073656c6563740a20202020692e69642c0a20202020692e74656e616e745f69642c0a20202020692e696e76697465645f656d61696c2c0a20202020692e696e76697465645f726f6c652c0a20202020692e746f6b656e2c0a20202020692e637265617465645f61742c0a20202020692e657870697265735f61742c0a20202020692e7265766f6b65645f61742c0a20202020692e61636365707465645f61742c0a20202020692e61636365707465645f62790a202066726f6d207075626c69632e74656e616e745f696e766974657320690a20206a6f696e206374206f6e2063742e74656e616e745f6964203d20692e74656e616e745f69640a2020776865726520617574682e7569642829206973206e6f74206e756c6c0a20202020616e642065786973747320280a20202020202073656c65637420310a20202020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a202020202020776865726520746d2e74656e616e745f6964203d20692e74656e616e745f69640a2020202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a2020202020202020616e6420746d2e726f6c653a3a7465787420696e2028276f776e6572272c2761646d696e27290a20202020290a20206f7264657220627920692e637265617465645f617420646573633b0a2466756e6374696f6e240000003b7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f696e76697465735f72706328292066726f6d207075626c6963000000436772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f696e76697465735f727063282920746f2061757468656e7469636174656400000060636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6765745f696e76697465735f727063282920697320274c69737420696e766974657320666f722043555252454e542074656e616e7420286f776e65722f61646d696e292e27000000672d2d205265766f6b6520696e7669746520627920696e7669746520696420286f776e65722f61646d696e206f6e6c79290a64726f702066756e6374696f6e20696620657869737473207075626c69632e7265766f6b655f696e766974655f727063287575696429000003bc6372656174652066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f72706328696e766974655f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420692e74656e616e745f696420696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f696e766974657320690a2020776865726520692e6964203d207265766f6b655f696e766974655f7270632e696e766974655f69643b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f4e4f545f464f554e44273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420746d2e757365725f6964203d20617574682e75696428290a202020202020616e6420746d2e726f6c653a3a7465787420696e2028276f776e6572272c2761646d696e27290a202029207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f525f41444d494e5f4f4e4c59273b0a2020656e642069663b0a0a2020757064617465207075626c69632e74656e616e745f696e76697465730a2020736574207265766f6b65645f6174203d206e6f7728290a20207768657265206964203d207265766f6b655f696e766974655f7270632e696e766974655f69640a20202020616e64207265766f6b65645f6174206973206e756c6c0a20202020616e642061636365707465645f6174206973206e756c6c3b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c2027696e766974655f6964272c207265766f6b655f696e766974655f7270632e696e766974655f6964293b0a656e643b0a2466756e6374696f6e24000000417265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f7270632875756964292066726f6d207075626c6963000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f72706328757569642920746f2061757468656e7469636174656400000054636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f72706328757569642920697320275265766f6b6520696e7669746520286f776e65722f61646d696e292e27000000602d2d2041636365707420696e7669746520627920746f6b656e202861757468656e74696361746564290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6163636570745f696e766974655f727063287465787429000006c56372656174652066756e6374696f6e207075626c69632e6163636570745f696e766974655f72706328746f6b656e2074657874290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f696e76207075626c69632e74656e616e745f696e766974657325726f77747970653b0a2020765f656d61696c20746578743b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f656d61696c203a3d206c6f77657228636f616c6573636528617574682e6a777428292d3e3e27656d61696c272c272729293b0a0a202073656c656374202a0a2020696e746f20765f696e760a202066726f6d207075626c69632e74656e616e745f696e766974657320690a2020776865726520692e746f6b656e203d206163636570745f696e766974655f7270632e746f6b656e0a20206c696d697420313b0a0a2020696620765f696e762e6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f4e4f545f464f554e44273b0a2020656e642069663b0a0a2020696620765f696e762e7265766f6b65645f6174206973206e6f74206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f5245564f4b4544273b0a2020656e642069663b0a0a2020696620765f696e762e61636365707465645f6174206973206e6f74206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f414c52454144595f4143434550544544273b0a2020656e642069663b0a0a2020696620765f696e762e657870697265735f6174206973206e6f74206e756c6c20616e6420765f696e762e657870697265735f6174203c206e6f772829207468656e0a20202020726169736520657863657074696f6e2027494e564954455f45585049524544273b0a2020656e642069663b0a0a20202d2d204966207765206861766520656d61696c20696e204a57542c20656e666f726365206d6174636820746f20696e76697465645f656d61696c5f6c630a2020696620765f656d61696c203c3e20272720616e6420765f696e762e696e76697465645f656d61696c5f6c63206973206e6f74206e756c6c20616e6420765f656d61696c203c3e20765f696e762e696e76697465645f656d61696c5f6c63207468656e0a20202020726169736520657863657074696f6e2027454d41494c5f4d49534d41544348273b0a2020656e642069663b0a0a20202d2d20456e73757265206d656d626572736869702028726f6c652066726f6d20696e76697465290a2020696e7365727420696e746f207075626c69632e74656e616e745f6d656d62657273686970732874656e616e745f69642c20757365725f69642c20726f6c65290a202076616c7565732028765f696e762e74656e616e745f69642c20617574682e75696428292c20765f696e762e696e76697465645f726f6c653a3a7075626c69632e74656e616e745f726f6c65290a20206f6e20636f6e666c696374202874656e616e745f69642c20757365725f69642920646f206e6f7468696e673b0a0a2020757064617465207075626c69632e74656e616e745f696e76697465730a20207365742061636365707465645f6174203d206e6f7728292c0a20202020202061636365707465645f6279203d20617574682e75696428290a20207768657265206964203d20765f696e762e69643b0a0a20202d2d205365742063757272656e742074656e616e742069662070726f66696c65206578697374730a2020696620746f5f726567636c61737328277075626c69632e757365725f70726f66696c65732729206973206e6f74206e756c6c207468656e0a20202020757064617465207075626c69632e757365725f70726f66696c65730a202020207365742063757272656e745f74656e616e745f6964203d20765f696e762e74656e616e745f69640a20202020776865726520757365725f6964203d20617574682e75696428293b0a2020656e642069663b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f696e762e74656e616e745f69642c2027726f6c65272c20765f696e762e696e76697465645f726f6c65293b0a656e643b0a2466756e6374696f6e24000000417265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6163636570745f696e766974655f7270632874657874292066726f6d207075626c6963000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6163636570745f696e766974655f72706328746578742920746f2061757468656e7469636174656400000076636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6163636570745f696e766974655f727063287465787429206973202741636365707420696e7669746520627920746f6b656e3b2063726561746573206d656d6265727368697020616e642073656c656374732074656e616e742e2700000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"invited_role\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists invited_role text not null default 'member'\"\nPL/pgSQL function inline_code_block line 8 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "invited_role" of relation "tenant_invites" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"token\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists token text not null default ''\"\nPL/pgSQL function inline_code_block line 9 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"created_at\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists created_at timestamptz not null default now()\"\nPL/pgSQL function inline_code_block line 10 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "token" of relation "tenant_invites" already exists, skipping
NOTICE (42701): column "created_at" of relation "tenant_invites" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"revoked_at\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists revoked_at timestamptz\"\nPL/pgSQL function inline_code_block line 12 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"accepted_at\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists accepted_at timestamptz\"\nPL/pgSQL function inline_code_block line 13 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "revoked_at" of relation "tenant_invites" already exists, skipping
NOTICE (42701): column "accepted_at" of relation "tenant_invites" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"accepted_by\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"SQL statement \"alter table public.tenant_invites add column if not exists accepted_by uuid\"\nPL/pgSQL function inline_code_block line 14 at SQL statement","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "accepted_by" of relation "tenant_invites" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.get_invites_rpc() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.get_invites_rpc() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.revoke_invite_rpc(uuid) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.revoke_invite_rpc(uuid) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.accept_invite_rpc(text) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.accept_invite_rpc(text) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125084459_invites_pending_preview.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"begin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Backfill invited_email_lc skipped: invited_email_lc is a GENERATED column.\n-- If you need to recompute, update invited_email (source column) instead.-- List my open invites (by my auth.jwt email), includes who invited me + workspace name\ndrop function if exists public.get_my_pending_invites_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_my_pending_invites_rpc()\nreturns table (\n  invite_id uuid,\n  tenant_id uuid,\n  workspace_name text,\n  invited_role text,\n  token text,\n  inviter_email text,\n  created_at timestamptz,\n  expires_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $function$\n  with me as (\n    select lower(coalesce(auth.jwt()-\u003e\u003e'email','')) as email_lc\n  )\n  select\n    i.id as invite_id,\n    i.tenant_id,\n    t.workspace_name,\n    i.invited_role,\n    i.token,\n    u.email as inviter_email,\n    i.created_at,\n    i.expires_at\n  from public.tenant_invites i\n  join public.tenants t on t.id = i.tenant_id\n  left join auth.users u on u.id = i.created_by\n  join me on me.email_lc \u003c\u003e ''\n  where i.invited_email_lc = me.email_lc\n    and i.revoked_at is null\n    and i.accepted_at is null\n    and (i.expires_at is null or i.expires_at \u003e now())\n  order by i.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_pending_invites_rpc() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_pending_invites_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.get_my_pending_invites_rpc() is 'List open invites for current user email (includes inviter + workspace).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Preview a token (for /app/accept-invite?token=...), shows inviter + workspace, enforces email match if JWT has email\ndrop function if exists public.get_invite_preview_rpc(text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_invite_preview_rpc(token text)\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  invited_email text,\n  invited_role text,\n  inviter_email text,\n  created_at timestamptz,\n  expires_at timestamptz,\n  status text\n)\nlanguage plpgsql\nstable\nsecurity definer\nset search_path = public, auth\nas $function$\ndeclare\n  v_email text := lower(coalesce(auth.jwt()-\u003e\u003e'email',''));\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  return query\n  select\n    i.tenant_id,\n    t.workspace_name,\n    i.invited_email,\n    i.invited_role,\n    u.email as inviter_email,\n    i.created_at,\n    i.expires_at,\n    case\n      when i.id is null then 'not_found'\n      when i.revoked_at is not null then 'revoked'\n      when i.accepted_at is not null then 'accepted'\n      when i.expires_at is not null and i.expires_at \u003c= now() then 'expired'\n      when v_email \u003c\u003e '' and i.invited_email_lc is not null and v_email \u003c\u003e i.invited_email_lc then 'email_mismatch'\n      else 'open'\n    end as status\n  from public.tenant_invites i\n  join public.tenants t on t.id = i.tenant_id\n  left join auth.users u on u.id = i.created_by\n  where i.token = get_invite_preview_rpc.token\n  limit 1;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_invite_preview_rpc(text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_invite_preview_rpc(text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"comment on function public.get_invite_preview_rpc(text) is 'Preview invite token (shows inviter/workspace; email mismatch flagged).'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125084459"},{"text":"invites_pending_preview"},{"binary":"0000000100000000000000190000000c0000000100000005626567696e0000012c2d2d204261636b66696c6c20696e76697465645f656d61696c5f6c6320736b69707065643a20696e76697465645f656d61696c5f6c6320697320612047454e45524154454420636f6c756d6e2e0a2d2d20496620796f75206e65656420746f207265636f6d707574652c2075706461746520696e76697465645f656d61696c2028736f7572636520636f6c756d6e2920696e73746561642e2d2d204c697374206d79206f70656e20696e766974657320286279206d7920617574682e6a777420656d61696c292c20696e636c756465732077686f20696e7669746564206d65202b20776f726b7370616365206e616d650a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290000039a6372656174652066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290a72657475726e73207461626c6520280a2020696e766974655f696420757569642c0a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020696e76697465645f726f6c6520746578742c0a2020746f6b656e20746578742c0a2020696e76697465725f656d61696c20746578742c0a2020637265617465645f61742074696d657374616d70747a2c0a2020657870697265735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a202077697468206d6520617320280a2020202073656c656374206c6f77657228636f616c6573636528617574682e6a777428292d3e3e27656d61696c272c2727292920617320656d61696c5f6c630a2020290a202073656c6563740a20202020692e696420617320696e766974655f69642c0a20202020692e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020692e696e76697465645f726f6c652c0a20202020692e746f6b656e2c0a20202020752e656d61696c20617320696e76697465725f656d61696c2c0a20202020692e637265617465645f61742c0a20202020692e657870697265735f61740a202066726f6d207075626c69632e74656e616e745f696e766974657320690a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20692e74656e616e745f69640a20206c656674206a6f696e20617574682e75736572732075206f6e20752e6964203d20692e637265617465645f62790a20206a6f696e206d65206f6e206d652e656d61696c5f6c63203c3e2027270a2020776865726520692e696e76697465645f656d61696c5f6c63203d206d652e656d61696c5f6c630a20202020616e6420692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e642028692e657870697265735f6174206973206e756c6c206f7220692e657870697265735f6174203e206e6f772829290a20206f7264657220627920692e637265617465645f617420646573633b0a2466756e6374696f6e24000000467265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328292066726f6d207075626c69630000004e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f727063282920746f2061757468656e7469636174656400000085636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f727063282920697320274c697374206f70656e20696e766974657320666f722063757272656e74207573657220656d61696c2028696e636c7564657320696e7669746572202b20776f726b7370616365292e27000000b32d2d2050726576696577206120746f6b656e2028666f72202f6170702f6163636570742d696e766974653f746f6b656e3d2e2e2e292c2073686f777320696e7669746572202b20776f726b73706163652c20656e666f7263657320656d61696c206d61746368206966204a57542068617320656d61696c0a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f696e766974655f707265766965775f727063287465787429000004d46372656174652066756e6374696f6e207075626c69632e6765745f696e766974655f707265766965775f72706328746f6b656e2074657874290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020696e76697465645f656d61696c20746578742c0a2020696e76697465645f726f6c6520746578742c0a2020696e76697465725f656d61696c20746578742c0a2020637265617465645f61742074696d657374616d70747a2c0a2020657870697265735f61742074696d657374616d70747a2c0a202073746174757320746578740a290a6c616e677561676520706c706773716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a6173202466756e6374696f6e240a6465636c6172650a2020765f656d61696c2074657874203a3d206c6f77657228636f616c6573636528617574682e6a777428292d3e3e27656d61696c272c272729293b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202072657475726e2071756572790a202073656c6563740a20202020692e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020692e696e76697465645f656d61696c2c0a20202020692e696e76697465645f726f6c652c0a20202020752e656d61696c20617320696e76697465725f656d61696c2c0a20202020692e637265617465645f61742c0a20202020692e657870697265735f61742c0a20202020636173650a2020202020207768656e20692e6964206973206e756c6c207468656e20276e6f745f666f756e64270a2020202020207768656e20692e7265766f6b65645f6174206973206e6f74206e756c6c207468656e20277265766f6b6564270a2020202020207768656e20692e61636365707465645f6174206973206e6f74206e756c6c207468656e20276163636570746564270a2020202020207768656e20692e657870697265735f6174206973206e6f74206e756c6c20616e6420692e657870697265735f6174203c3d206e6f772829207468656e202765787069726564270a2020202020207768656e20765f656d61696c203c3e20272720616e6420692e696e76697465645f656d61696c5f6c63206973206e6f74206e756c6c20616e6420765f656d61696c203c3e20692e696e76697465645f656d61696c5f6c63207468656e2027656d61696c5f6d69736d61746368270a202020202020656c736520276f70656e270a20202020656e64206173207374617475730a202066726f6d207075626c69632e74656e616e745f696e766974657320690a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20692e74656e616e745f69640a20206c656674206a6f696e20617574682e75736572732075206f6e20752e6964203d20692e637265617465645f62790a2020776865726520692e746f6b656e203d206765745f696e766974655f707265766965775f7270632e746f6b656e0a20206c696d697420313b0a656e643b0a2466756e6374696f6e24000000467265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f696e766974655f707265766965775f7270632874657874292066726f6d207075626c69630000004e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f696e766974655f707265766965775f72706328746578742920746f2061757468656e7469636174656400000084636f6d6d656e74206f6e2066756e6374696f6e207075626c69632e6765745f696e766974655f707265766965775f72706328746578742920697320275072657669657720696e7669746520746f6b656e202873686f777320696e76697465722f776f726b73706163653b20656d61696c206d69736d6174636820666c6167676564292e2700000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.get_my_pending_invites_rpc() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.get_my_pending_invites_rpc() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.get_invite_preview_rpc(text) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.get_invite_preview_rpc(text) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMENT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125085212_pending_invites_one_click.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Pending invites + one-click accept (clean)\n-- No BEGIN/COMMIT wrappers.\n\nalter table public.tenant_invites\n  add column if not exists accepted_at timestamptz,\n  add column if not exists accepted_by uuid","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- MUST drop first if signature/return type changed\ndrop function if exists public.get_my_pending_invites_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.accept_invite_by_id_rpc(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_my_pending_invites_rpc()\nreturns table (\n  invite_id uuid,\n  tenant_id uuid,\n  workspace_name text,\n  invited_role text,\n  invited_email text,\n  inviter_email text,\n  created_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth\nas $fn$\n  select\n    i.id as invite_id,\n    i.tenant_id,\n    t.workspace_name,\n    i.invited_role,\n    i.invited_email,\n    u.email as inviter_email,\n    i.created_at\n  from public.tenant_invites i\n  join public.tenants t on t.id = i.tenant_id\n  left join auth.users u on u.id = i.created_by\n  where\n    i.revoked_at is null\n    and i.accepted_at is null\n    and i.invited_email_lc = lower(coalesce(auth.jwt()-\u003e\u003e'email',''));\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_pending_invites_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.accept_invite_by_id_rpc(invite_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $plpgsql$\ndeclare\n  v_token text;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  select i.token\n    into v_token\n  from public.tenant_invites i\n  where i.id = invite_id\n    and i.revoked_at is null\n    and i.accepted_at is null\n    and i.invited_email_lc = lower(coalesce(auth.jwt()-\u003e\u003e'email',''));\n\n  if v_token is null then\n    raise exception 'INVITE_NOT_FOUND';\n  end if;\n\n  return public.accept_invite(v_token);\nend;\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.accept_invite_by_id_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125085212"},{"text":"pending_invites_one_click"},{"binary":"0000000100000000000000190000000700000001000000cd2d2d2050656e64696e6720696e7669746573202b206f6e652d636c69636b206163636570742028636c65616e290a2d2d204e6f20424547494e2f434f4d4d49542077726170706572732e0a0a616c746572207461626c65207075626c69632e74656e616e745f696e76697465730a202061646420636f6c756d6e206966206e6f74206578697374732061636365707465645f61742074696d657374616d70747a2c0a202061646420636f6c756d6e206966206e6f74206578697374732061636365707465645f627920757569640000006f2d2d204d5553542064726f70206669727374206966207369676e61747572652f72657475726e2074797065206368616e6765640a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290000003c64726f702066756e6374696f6e20696620657869737473207075626c69632e6163636570745f696e766974655f62795f69645f727063287575696429000002cd6372656174652066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290a72657475726e73207461626c6520280a2020696e766974655f696420757569642c0a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020696e76697465645f726f6c6520746578742c0a2020696e76697465645f656d61696c20746578742c0a2020696e76697465725f656d61696c20746578742c0a2020637265617465645f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024666e240a202073656c6563740a20202020692e696420617320696e766974655f69642c0a20202020692e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020692e696e76697465645f726f6c652c0a20202020692e696e76697465645f656d61696c2c0a20202020752e656d61696c20617320696e76697465725f656d61696c2c0a20202020692e637265617465645f61740a202066726f6d207075626c69632e74656e616e745f696e766974657320690a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20692e74656e616e745f69640a20206c656674206a6f696e20617574682e75736572732075206f6e20752e6964203d20692e637265617465645f62790a202077686572650a20202020692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e6420692e696e76697465645f656d61696c5f6c63203d206c6f77657228636f616c6573636528617574682e6a777428292d3e3e27656d61696c272c272729293b0a24666e240000004e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f727063282920746f2061757468656e74696361746564000002666372656174652066756e6374696f6e207075626c69632e6163636570745f696e766974655f62795f69645f72706328696e766974655f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024706c706773716c240a6465636c6172650a2020765f746f6b656e20746578743b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420692e746f6b656e0a20202020696e746f20765f746f6b656e0a202066726f6d207075626c69632e74656e616e745f696e766974657320690a2020776865726520692e6964203d20696e766974655f69640a20202020616e6420692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e6420692e696e76697465645f656d61696c5f6c63203d206c6f77657228636f616c6573636528617574682e6a777428292d3e3e27656d61696c272c272729293b0a0a2020696620765f746f6b656e206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f4e4f545f464f554e44273b0a2020656e642069663b0a0a202072657475726e207075626c69632e6163636570745f696e7669746528765f746f6b656e293b0a656e643b0a24706c706773716c240000004f6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6163636570745f696e766974655f62795f69645f72706328757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"accepted_at\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"accepted_by\" of relation \"tenant_invites\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "accepted_at" of relation "tenant_invites" already exists, skipping
NOTICE (42701): column "accepted_by" of relation "tenant_invites" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.accept_invite_by_id_rpc(uuid) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.accept_invite_by_id_rpc(uuid) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125090020_week2_rpcs_idempotency_rowversion_audit.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure deals has columns required by list_deals() (idempotent; fixes replay drift)\ndo $m$\nbegin\n  if exists (\n    select 1\n    from information_schema.tables\n    where table_schema='public' and table_name='deals'\n  ) then\n    alter table public.deals add column if not exists market_area text;\n  end if;\nend\n$m$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Week 2 RPCs: idempotency + row_version + audit + list/create/update\n-- Clean rewrite (removes any injected \"OK:\" garbage). No BEGIN/COMMIT wrappers.\n\ncreate table if not exists public.rpc_idempotency (\n  scope text not null,\n  action text not null,\n  idempotency_key text not null,\n  result jsonb not null,\n  created_at timestamptz not null default now(),\n  primary key (scope, action, idempotency_key)\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.rpc_idempotency from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.rpc_idempotency from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on table public.rpc_idempotency from authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.deals\n  add column if not exists row_version int not null default 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.deals\n  add column if not exists updated_at timestamptz not null default now()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.audit_log\n  add column if not exists tenant_id uuid,\n  add column if not exists user_id uuid,\n  add column if not exists action text,\n  add column if not exists entity text,\n  add column if not exists entity_id uuid,\n  add column if not exists payload jsonb","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public._audit_write(\n  p_tenant_id uuid,\n  p_action text,\n  p_entity text,\n  p_entity_id uuid,\n  p_payload jsonb\n)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $plpgsql$\nbegin\n  insert into public.audit_log (tenant_id, user_id, action, entity, entity_id, payload)\n  values (p_tenant_id, auth.uid(), p_action, p_entity, p_entity_id, p_payload);\nend;\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public._audit_write(uuid,text,text,uuid,jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public._audit_write(uuid,text,text,uuid,jsonb) from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public._audit_write(uuid,text,text,uuid,jsonb) from authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.list_deals()\nreturns table (\n  id uuid,\n  status public.deal_status,\n  market_area text,\n  row_version int,\n  updated_at timestamptz,\n  created_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, auth\nas $fn$\n  select\n    d.id,\n    d.status,\n    d.market_area,\n    d.row_version,\n    d.updated_at,\n    d.created_at\n  from public.deals d\n  where d.tenant_id = public.current_tenant_id()\n  order by d.updated_at desc\n  limit 100;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.list_deals() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.create_deal(\n  payload jsonb,\n  idempotency_key text\n)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $plpgsql$\ndeclare\n  v_tenant_id uuid;\n  v_scope text;\n  v_existing jsonb;\n  v_deal_id uuid;\n  v_row_version int;\n  v_status public.deal_status;\n  v_market_area text;\n  v_result jsonb;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_tenant_id := public.current_tenant_id();\n  if v_tenant_id is null then\n    raise exception 'NO_TENANT_SELECTED';\n  end if;\n\n  if not public.tenant_write_allowed(v_tenant_id) then\n    raise exception 'WRITE_NOT_ALLOWED';\n  end if;\n\n  if idempotency_key is null or btrim(idempotency_key) = '' then\n    raise exception 'IDEMPOTENCY_KEY_REQUIRED';\n  end if;\n\n  v_scope := v_tenant_id::text;\n\n  select ri.result into v_existing\n  from public.rpc_idempotency ri\n  where ri.scope = v_scope\n    and ri.action = 'create_deal'\n    and ri.idempotency_key = idempotency_key;\n\n  if v_existing is not null then\n    return v_existing;\n  end if;\n\n  v_status := coalesce(nullif(payload-\u003e\u003e'status',''), 'New')::public.deal_status;\n  v_market_area := coalesce(nullif(payload-\u003e\u003e'market_area',''), 'default');\n\n  insert into public.deals (tenant_id, status, market_area, updated_at)\n  values (v_tenant_id, v_status, v_market_area, now())\n  returning id, row_version into v_deal_id, v_row_version;\n\n  perform public._audit_write(\n    v_tenant_id,\n    'create_deal',\n    'deals',\n    v_deal_id,\n    jsonb_build_object('payload', payload)\n  );\n\n  v_result := jsonb_build_object(\n    'ok', true,\n    'deal_id', v_deal_id,\n    'row_version', v_row_version\n  );\n\n  insert into public.rpc_idempotency (scope, action, idempotency_key, result)\n  values (v_scope, 'create_deal', idempotency_key, v_result);\n\n  return v_result;\nend;\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_deal(jsonb,text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.update_deal(\n  payload jsonb,\n  expected_row_version int,\n  idempotency_key text\n)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth\nas $plpgsql$\ndeclare\n  v_tenant_id uuid;\n  v_scope text;\n  v_existing jsonb;\n  v_deal_id uuid;\n  v_current_row_version int;\n  v_new_row_version int;\n  v_status public.deal_status;\n  v_market_area text;\n  v_result jsonb;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_tenant_id := public.current_tenant_id();\n  if v_tenant_id is null then\n    raise exception 'NO_TENANT_SELECTED';\n  end if;\n\n  if not public.tenant_write_allowed(v_tenant_id) then\n    raise exception 'WRITE_NOT_ALLOWED';\n  end if;\n\n  if idempotency_key is null or btrim(idempotency_key) = '' then\n    raise exception 'IDEMPOTENCY_KEY_REQUIRED';\n  end if;\n\n  v_scope := v_tenant_id::text;\n\n  select ri.result into v_existing\n  from public.rpc_idempotency ri\n  where ri.scope = v_scope\n    and ri.action = 'update_deal'\n    and ri.idempotency_key = idempotency_key;\n\n  if v_existing is not null then\n    return v_existing;\n  end if;\n\n  v_deal_id := nullif(payload-\u003e\u003e'id','')::uuid;\n  if v_deal_id is null then\n    raise exception 'DEAL_ID_REQUIRED';\n  end if;\n\n  select d.row_version into v_current_row_version\n  from public.deals d\n  where d.id = v_deal_id\n    and d.tenant_id = v_tenant_id;\n\n  if v_current_row_version is null then\n    raise exception 'NOT_FOUND';\n  end if;\n\n  if expected_row_version is null then\n    raise exception 'EXPECTED_ROW_VERSION_REQUIRED';\n  end if;\n\n  if v_current_row_version \u003c\u003e expected_row_version then\n    raise exception 'ROW_VERSION_CONFLICT';\n  end if;\n\n  v_status := coalesce(nullif(payload-\u003e\u003e'status',''), null)::public.deal_status;\n  v_market_area := coalesce(nullif(payload-\u003e\u003e'market_area',''), null);\n\n  update public.deals d\n  set\n    status = coalesce(v_status, d.status),\n    market_area = coalesce(v_market_area, d.market_area),\n    row_version = d.row_version + 1,\n    updated_at = now()\n  where d.id = v_deal_id\n    and d.tenant_id = v_tenant_id\n  returning row_version into v_new_row_version;\n\n  perform public._audit_write(\n    v_tenant_id,\n    'update_deal',\n    'deals',\n    v_deal_id,\n    jsonb_build_object(\n      'payload', payload,\n      'expected_row_version', expected_row_version\n    )\n  );\n\n  v_result := jsonb_build_object(\n    'ok', true,\n    'deal_id', v_deal_id,\n    'row_version', v_new_row_version\n  );\n\n  insert into public.rpc_idempotency (scope, action, idempotency_key, result)\n  values (v_scope, 'update_deal', idempotency_key, v_result);\n\n  return v_result;\nend;\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.update_deal(jsonb,int,text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125090020"},{"text":"week2_rpcs_idempotency_rowversion_audit"},{"binary":"00000001000000000000001900000012000000010000013a2d2d20456e73757265206465616c732068617320636f6c756d6e73207265717569726564206279206c6973745f6465616c73282920286964656d706f74656e743b206669786573207265706c6179206472696674290a646f20246d240a626567696e0a202069662065786973747320280a2020202073656c65637420310a2020202066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c65730a202020207768657265207461626c655f736368656d613d277075626c69632720616e64207461626c655f6e616d653d276465616c73270a202029207468656e0a20202020616c746572207461626c65207075626c69632e6465616c732061646420636f6c756d6e206966206e6f7420657869737473206d61726b65745f6172656120746578743b0a2020656e642069663b0a656e640a246d24000001972d2d205765656b203220525043733a206964656d706f74656e6379202b20726f775f76657273696f6e202b206175646974202b206c6973742f6372656174652f7570646174650a2d2d20436c65616e2072657772697465202872656d6f76657320616e7920696e6a656374656420224f4b3a222067617262616765292e204e6f20424547494e2f434f4d4d49542077726170706572732e0a0a637265617465207461626c65206966206e6f7420657869737473207075626c69632e7270635f6964656d706f74656e637920280a202073636f70652074657874206e6f74206e756c6c2c0a2020616374696f6e2074657874206e6f74206e756c6c2c0a20206964656d706f74656e63795f6b65792074657874206e6f74206e756c6c2c0a2020726573756c74206a736f6e62206e6f74206e756c6c2c0a2020637265617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a20207072696d617279206b6579202873636f70652c20616374696f6e2c206964656d706f74656e63795f6b6579290a29000000367265766f6b6520616c6c206f6e207461626c65207075626c69632e7270635f6964656d706f74656e63792066726f6d207075626c6963000000347265766f6b6520616c6c206f6e207461626c65207075626c69632e7270635f6964656d706f74656e63792066726f6d20616e6f6e0000003d7265766f6b6520616c6c206f6e207461626c65207075626c69632e7270635f6964656d706f74656e63792066726f6d2061757468656e7469636174656400000056616c746572207461626c65207075626c69632e6465616c730a202061646420636f6c756d6e206966206e6f742065786973747320726f775f76657273696f6e20696e74206e6f74206e756c6c2064656661756c74203100000061616c746572207461626c65207075626c69632e6465616c730a202061646420636f6c756d6e206966206e6f742065786973747320757064617465645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f77282900000114616c746572207461626c65207075626c69632e61756469745f6c6f670a202061646420636f6c756d6e206966206e6f74206578697374732074656e616e745f696420757569642c0a202061646420636f6c756d6e206966206e6f742065786973747320757365725f696420757569642c0a202061646420636f6c756d6e206966206e6f742065786973747320616374696f6e20746578742c0a202061646420636f6c756d6e206966206e6f742065786973747320656e7469747920746578742c0a202061646420636f6c756d6e206966206e6f742065786973747320656e746974795f696420757569642c0a202061646420636f6c756d6e206966206e6f7420657869737473207061796c6f6164206a736f6e62000001a5637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e5f61756469745f7772697465280a2020705f74656e616e745f696420757569642c0a2020705f616374696f6e20746578742c0a2020705f656e7469747920746578742c0a2020705f656e746974795f696420757569642c0a2020705f7061796c6f6164206a736f6e620a290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024706c706773716c240a626567696e0a2020696e7365727420696e746f207075626c69632e61756469745f6c6f67202874656e616e745f69642c20757365725f69642c20616374696f6e2c20656e746974792c20656e746974795f69642c207061796c6f6164290a202076616c7565732028705f74656e616e745f69642c20617574682e75696428292c20705f616374696f6e2c20705f656e746974792c20705f656e746974795f69642c20705f7061796c6f6164293b0a656e643b0a24706c706773716c24000000517265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e5f61756469745f777269746528757569642c746578742c746578742c757569642c6a736f6e62292066726f6d207075626c69630000004f7265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e5f61756469745f777269746528757569642c746578742c746578742c757569642c6a736f6e62292066726f6d20616e6f6e000000587265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e5f61756469745f777269746528757569642c746578742c746578742c757569642c6a736f6e62292066726f6d2061757468656e74696361746564000001e7637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6c6973745f6465616c7328290a72657475726e73207461626c6520280a2020696420757569642c0a2020737461747573207075626c69632e6465616c5f7374617475732c0a20206d61726b65745f6172656120746578742c0a2020726f775f76657273696f6e20696e742c0a2020757064617465645f61742074696d657374616d70747a2c0a2020637265617465645f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024666e240a202073656c6563740a20202020642e69642c0a20202020642e7374617475732c0a20202020642e6d61726b65745f617265612c0a20202020642e726f775f76657273696f6e2c0a20202020642e757064617465645f61742c0a20202020642e637265617465645f61740a202066726f6d207075626c69632e6465616c7320640a2020776865726520642e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a20206f7264657220627920642e757064617465645f617420646573630a20206c696d6974203130303b0a24666e240000003e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6c6973745f6465616c73282920746f2061757468656e746963617465640000073c637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6372656174655f6465616c280a20207061796c6f6164206a736f6e622c0a20206964656d706f74656e63795f6b657920746578740a290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024706c706773716c240a6465636c6172650a2020765f74656e616e745f696420757569643b0a2020765f73636f706520746578743b0a2020765f6578697374696e67206a736f6e623b0a2020765f6465616c5f696420757569643b0a2020765f726f775f76657273696f6e20696e743b0a2020765f737461747573207075626c69632e6465616c5f7374617475733b0a2020765f6d61726b65745f6172656120746578743b0a2020765f726573756c74206a736f6e623b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f74656e616e745f6964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f54454e414e545f53454c4543544544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e74656e616e745f77726974655f616c6c6f77656428765f74656e616e745f696429207468656e0a20202020726169736520657863657074696f6e202757524954455f4e4f545f414c4c4f574544273b0a2020656e642069663b0a0a20206966206964656d706f74656e63795f6b6579206973206e756c6c206f7220627472696d286964656d706f74656e63795f6b657929203d202727207468656e0a20202020726169736520657863657074696f6e20274944454d504f54454e43595f4b45595f5245515549524544273b0a2020656e642069663b0a0a2020765f73636f7065203a3d20765f74656e616e745f69643a3a746578743b0a0a202073656c6563742072692e726573756c7420696e746f20765f6578697374696e670a202066726f6d207075626c69632e7270635f6964656d706f74656e63792072690a202077686572652072692e73636f7065203d20765f73636f70650a20202020616e642072692e616374696f6e203d20276372656174655f6465616c270a20202020616e642072692e6964656d706f74656e63795f6b6579203d206964656d706f74656e63795f6b65793b0a0a2020696620765f6578697374696e67206973206e6f74206e756c6c207468656e0a2020202072657475726e20765f6578697374696e673b0a2020656e642069663b0a0a2020765f737461747573203a3d20636f616c65736365286e756c6c6966287061796c6f61642d3e3e27737461747573272c2727292c20274e657727293a3a7075626c69632e6465616c5f7374617475733b0a2020765f6d61726b65745f61726561203a3d20636f616c65736365286e756c6c6966287061796c6f61642d3e3e276d61726b65745f61726561272c2727292c202764656661756c7427293b0a0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c207374617475732c206d61726b65745f617265612c20757064617465645f6174290a202076616c7565732028765f74656e616e745f69642c20765f7374617475732c20765f6d61726b65745f617265612c206e6f772829290a202072657475726e696e672069642c20726f775f76657273696f6e20696e746f20765f6465616c5f69642c20765f726f775f76657273696f6e3b0a0a2020706572666f726d207075626c69632e5f61756469745f7772697465280a20202020765f74656e616e745f69642c0a20202020276372656174655f6465616c272c0a20202020276465616c73272c0a20202020765f6465616c5f69642c0a202020206a736f6e625f6275696c645f6f626a65637428277061796c6f6164272c207061796c6f6164290a2020293b0a0a2020765f726573756c74203a3d206a736f6e625f6275696c645f6f626a656374280a20202020276f6b272c20747275652c0a20202020276465616c5f6964272c20765f6465616c5f69642c0a2020202027726f775f76657273696f6e272c20765f726f775f76657273696f6e0a2020293b0a0a2020696e7365727420696e746f207075626c69632e7270635f6964656d706f74656e6379202873636f70652c20616374696f6e2c206964656d706f74656e63795f6b65792c20726573756c74290a202076616c7565732028765f73636f70652c20276372656174655f6465616c272c206964656d706f74656e63795f6b65792c20765f726573756c74293b0a0a202072657475726e20765f726573756c743b0a656e643b0a24706c706773716c24000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f6465616c286a736f6e622c746578742920746f2061757468656e7469636174656400000a55637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7570646174655f6465616c280a20207061796c6f6164206a736f6e622c0a202065787065637465645f726f775f76657273696f6e20696e742c0a20206964656d706f74656e63795f6b657920746578740a290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024706c706773716c240a6465636c6172650a2020765f74656e616e745f696420757569643b0a2020765f73636f706520746578743b0a2020765f6578697374696e67206a736f6e623b0a2020765f6465616c5f696420757569643b0a2020765f63757272656e745f726f775f76657273696f6e20696e743b0a2020765f6e65775f726f775f76657273696f6e20696e743b0a2020765f737461747573207075626c69632e6465616c5f7374617475733b0a2020765f6d61726b65745f6172656120746578743b0a2020765f726573756c74206a736f6e623b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f74656e616e745f6964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f54454e414e545f53454c4543544544273b0a2020656e642069663b0a0a20206966206e6f74207075626c69632e74656e616e745f77726974655f616c6c6f77656428765f74656e616e745f696429207468656e0a20202020726169736520657863657074696f6e202757524954455f4e4f545f414c4c4f574544273b0a2020656e642069663b0a0a20206966206964656d706f74656e63795f6b6579206973206e756c6c206f7220627472696d286964656d706f74656e63795f6b657929203d202727207468656e0a20202020726169736520657863657074696f6e20274944454d504f54454e43595f4b45595f5245515549524544273b0a2020656e642069663b0a0a2020765f73636f7065203a3d20765f74656e616e745f69643a3a746578743b0a0a202073656c6563742072692e726573756c7420696e746f20765f6578697374696e670a202066726f6d207075626c69632e7270635f6964656d706f74656e63792072690a202077686572652072692e73636f7065203d20765f73636f70650a20202020616e642072692e616374696f6e203d20277570646174655f6465616c270a20202020616e642072692e6964656d706f74656e63795f6b6579203d206964656d706f74656e63795f6b65793b0a0a2020696620765f6578697374696e67206973206e6f74206e756c6c207468656e0a2020202072657475726e20765f6578697374696e673b0a2020656e642069663b0a0a2020765f6465616c5f6964203a3d206e756c6c6966287061796c6f61642d3e3e276964272c2727293a3a757569643b0a2020696620765f6465616c5f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274445414c5f49445f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420642e726f775f76657273696f6e20696e746f20765f63757272656e745f726f775f76657273696f6e0a202066726f6d207075626c69632e6465616c7320640a2020776865726520642e6964203d20765f6465616c5f69640a20202020616e6420642e74656e616e745f6964203d20765f74656e616e745f69643b0a0a2020696620765f63757272656e745f726f775f76657273696f6e206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f545f464f554e44273b0a2020656e642069663b0a0a202069662065787065637465645f726f775f76657273696f6e206973206e756c6c207468656e0a20202020726169736520657863657074696f6e202745585045435445445f524f575f56455253494f4e5f5245515549524544273b0a2020656e642069663b0a0a2020696620765f63757272656e745f726f775f76657273696f6e203c3e2065787065637465645f726f775f76657273696f6e207468656e0a20202020726169736520657863657074696f6e2027524f575f56455253494f4e5f434f4e464c494354273b0a2020656e642069663b0a0a2020765f737461747573203a3d20636f616c65736365286e756c6c6966287061796c6f61642d3e3e27737461747573272c2727292c206e756c6c293a3a7075626c69632e6465616c5f7374617475733b0a2020765f6d61726b65745f61726561203a3d20636f616c65736365286e756c6c6966287061796c6f61642d3e3e276d61726b65745f61726561272c2727292c206e756c6c293b0a0a2020757064617465207075626c69632e6465616c7320640a20207365740a20202020737461747573203d20636f616c6573636528765f7374617475732c20642e737461747573292c0a202020206d61726b65745f61726561203d20636f616c6573636528765f6d61726b65745f617265612c20642e6d61726b65745f61726561292c0a20202020726f775f76657273696f6e203d20642e726f775f76657273696f6e202b20312c0a20202020757064617465645f6174203d206e6f7728290a2020776865726520642e6964203d20765f6465616c5f69640a20202020616e6420642e74656e616e745f6964203d20765f74656e616e745f69640a202072657475726e696e6720726f775f76657273696f6e20696e746f20765f6e65775f726f775f76657273696f6e3b0a0a2020706572666f726d207075626c69632e5f61756469745f7772697465280a20202020765f74656e616e745f69642c0a20202020277570646174655f6465616c272c0a20202020276465616c73272c0a20202020765f6465616c5f69642c0a202020206a736f6e625f6275696c645f6f626a656374280a202020202020277061796c6f6164272c207061796c6f61642c0a2020202020202765787065637465645f726f775f76657273696f6e272c2065787065637465645f726f775f76657273696f6e0a20202020290a2020293b0a0a2020765f726573756c74203a3d206a736f6e625f6275696c645f6f626a656374280a20202020276f6b272c20747275652c0a20202020276465616c5f6964272c20765f6465616c5f69642c0a2020202027726f775f76657273696f6e272c20765f6e65775f726f775f76657273696f6e0a2020293b0a0a2020696e7365727420696e746f207075626c69632e7270635f6964656d706f74656e6379202873636f70652c20616374696f6e2c206964656d706f74656e63795f6b65792c20726573756c74290a202076616c7565732028765f73636f70652c20277570646174655f6465616c272c206964656d706f74656e63795f6b65792c20765f726573756c74293b0a0a202072657475726e20765f726573756c743b0a656e643b0a24706c706773716c240000004d6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7570646174655f6465616c286a736f6e622c696e742c746578742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"row_version\" of relation \"deals\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"updated_at\" of relation \"deals\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "row_version" of relation "deals" already exists, skipping
NOTICE (42701): column "updated_at" of relation "deals" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"tenant_id\" of relation \"audit_log\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "tenant_id" of relation "audit_log" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"action\" of relation \"audit_log\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42701","Message":"column \"entity_id\" of relation \"audit_log\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"tablecmds.c","Line":7471,"Routine":"check_for_column_name_collision","UnknownFields":null}
NOTICE (42701): column "action" of relation "audit_log" already exists, skipping
NOTICE (42701): column "entity_id" of relation "audit_log" already exists, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125090121_week2_get_deal_rpc_and_rpc_status_update.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Week 2: get_deal RPC (clean rewrite). No BEGIN/COMMIT wrappers.\n\ndrop function if exists public.get_deal(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_deal(deal_id uuid)\nreturns table (\n  id uuid,\n  status public.deal_status,\n  market_area text,\n  row_version int,\n  updated_at timestamptz,\n  created_at timestamptz\n)\nlanguage sql\nsecurity definer\nset search_path = public, auth\nas $fn$\n  select\n    d.id,\n    d.status,\n    d.market_area,\n    d.row_version,\n    d.updated_at,\n    d.created_at\n  from public.deals d\n  where d.id = deal_id\n    and d.tenant_id = public.current_tenant_id();\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_deal(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125090121"},{"text":"week2_get_deal_rpc_and_rpc_status_update"},{"binary":"0000000100000000000000190000000300000001000000712d2d205765656b20323a206765745f6465616c205250432028636c65616e2072657772697465292e204e6f20424547494e2f434f4d4d49542077726170706572732e0a0a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f6465616c287575696429000001d46372656174652066756e6374696f6e207075626c69632e6765745f6465616c286465616c5f69642075756964290a72657475726e73207461626c6520280a2020696420757569642c0a2020737461747573207075626c69632e6465616c5f7374617475732c0a20206d61726b65745f6172656120746578742c0a2020726f775f76657273696f6e20696e742c0a2020757064617465645f61742074696d657374616d70747a2c0a2020637265617465645f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574680a61732024666e240a202073656c6563740a20202020642e69642c0a20202020642e7374617475732c0a20202020642e6d61726b65745f617265612c0a20202020642e726f775f76657273696f6e2c0a20202020642e757064617465645f61742c0a20202020642e637265617465645f61740a202066726f6d207075626c69632e6465616c7320640a2020776865726520642e6964203d206465616c5f69640a20202020616e6420642e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428293b0a24666e24000000406772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6465616c28757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.get_deal(uuid) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.get_deal(uuid) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125152424_week3_upgrade_save_idempotency.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Week 3: Upgrade \u0026 Save idempotency (deal-level)\nbegin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 1) Add idempotency key to deals\nalter table public.deals\n  add column if not exists idempotency_key text","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Unique per tenant to allow retry-safe create\ncreate unique index if not exists deals_tenant_id_idempotency_key_ux\n  on public.deals(tenant_id, idempotency_key)\n  where idempotency_key is not null","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 2) Replace provision_upgrade_save to accept an idempotency key and reuse the seeded deal on retries.\n-- Signature change is intentional and canonical.\ndrop function if exists public.provision_upgrade_save(text, jsonb)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.provision_upgrade_save(\n  p_workspace_name text,\n  p_first_deal jsonb,\n  p_idempotency_key text default null\n)\nreturns table (tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_user_id uuid := auth.uid();\n  v_tenant_id uuid;\n  v_existing_deal_id uuid;\n  v_deal_id uuid;\nbegin\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  -- Reuse first tenant membership for the user if it exists\n  select tm.tenant_id\n    into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = v_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  -- Create tenant + owner membership if missing\n  if v_tenant_id is null then\n    insert into public.tenants (workspace_name, subscription_status, trial_started_at, trial_ends_at)\n    values (coalesce(p_workspace_name,''), 'trialing'::public.subscription_status, now(), now() + interval '14 days')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, v_user_id, 'owner');\n  end if;\n\n  -- If idempotency_key provided and a deal already exists for this tenant, reuse it\n  if p_idempotency_key is not null then\n    select d.id into v_existing_deal_id\n    from public.deals d\n    where d.tenant_id = v_tenant_id\n      and d.idempotency_key = p_idempotency_key\n    limit 1;\n\n    if v_existing_deal_id is not null then\n      tenant_id := v_tenant_id;\n      deal_id := v_existing_deal_id;\n      return next;\n      return;\n    end if;\n  end if;\n\n  -- Seed first deal\n  insert into public.deals (tenant_id, status, market_area, idempotency_key)\n  values (\n    v_tenant_id,\n    coalesce((p_first_deal-\u003e\u003e'status')::public.deal_status, 'New'::public.deal_status),\n    coalesce(p_first_deal-\u003e\u003e'market_area', 'default'),\n    p_idempotency_key\n  )\n  returning id into v_deal_id;\n\n  tenant_id := v_tenant_id;\n  deal_id := v_deal_id;\n  return next;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.provision_upgrade_save(text, jsonb, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125152424"},{"text":"week3_upgrade_save_idempotency"},{"binary":"0000000100000000000000190000000700000001000000382d2d205765656b20333a205570677261646520262053617665206964656d706f74656e637920286465616c2d6c6576656c290a626567696e0000006b2d2d20312920416464206964656d706f74656e6379206b657920746f206465616c730a616c746572207461626c65207075626c69632e6465616c730a202061646420636f6c756d6e206966206e6f7420657869737473206964656d706f74656e63795f6b65792074657874000000c62d2d20556e69717565207065722074656e616e7420746f20616c6c6f772072657472792d73616665206372656174650a63726561746520756e6971756520696e646578206966206e6f7420657869737473206465616c735f74656e616e745f69645f6964656d706f74656e63795f6b65795f75780a20206f6e207075626c69632e6465616c732874656e616e745f69642c206964656d706f74656e63795f6b6579290a20207768657265206964656d706f74656e63795f6b6579206973206e6f74206e756c6c000000dc2d2d203229205265706c6163652070726f766973696f6e5f757067726164655f7361766520746f2061636365707420616e206964656d706f74656e6379206b657920616e642072657573652074686520736565646564206465616c206f6e20726574726965732e0a2d2d205369676e6174757265206368616e676520697320696e74656e74696f6e616c20616e642063616e6f6e6963616c2e0a64726f702066756e6374696f6e20696620657869737473207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e6229000007c3637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f73617665280a2020705f776f726b73706163655f6e616d6520746578742c0a2020705f66697273745f6465616c206a736f6e622c0a2020705f6964656d706f74656e63795f6b657920746578742064656661756c74206e756c6c0a290a72657475726e73207461626c65202874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f757365725f69642075756964203a3d20617574682e75696428293b0a2020765f74656e616e745f696420757569643b0a2020765f6578697374696e675f6465616c5f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a20202d2d2052657573652066697273742074656e616e74206d656d6265727368697020666f72207468652075736572206966206974206578697374730a202073656c65637420746d2e74656e616e745f69640a20202020696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20765f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a20202d2d204372656174652074656e616e74202b206f776e6572206d656d62657273686970206966206d697373696e670a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e74732028776f726b73706163655f6e616d652c20737562736372697074696f6e5f7374617475732c20747269616c5f737461727465645f61742c20747269616c5f656e64735f6174290a2020202076616c7565732028636f616c6573636528705f776f726b73706163655f6e616d652c2727292c2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c206e6f7728292c206e6f772829202b20696e74657276616c20273134206461797327290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20765f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a20202d2d204966206964656d706f74656e63795f6b65792070726f766964656420616e642061206465616c20616c72656164792065786973747320666f7220746869732074656e616e742c2072657573652069740a2020696620705f6964656d706f74656e63795f6b6579206973206e6f74206e756c6c207468656e0a2020202073656c65637420642e696420696e746f20765f6578697374696e675f6465616c5f69640a2020202066726f6d207075626c69632e6465616c7320640a20202020776865726520642e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420642e6964656d706f74656e63795f6b6579203d20705f6964656d706f74656e63795f6b65790a202020206c696d697420313b0a0a20202020696620765f6578697374696e675f6465616c5f6964206973206e6f74206e756c6c207468656e0a20202020202074656e616e745f6964203a3d20765f74656e616e745f69643b0a2020202020206465616c5f6964203a3d20765f6578697374696e675f6465616c5f69643b0a20202020202072657475726e206e6578743b0a20202020202072657475726e3b0a20202020656e642069663b0a2020656e642069663b0a0a20202d2d2053656564206669727374206465616c0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c207374617475732c206d61726b65745f617265612c206964656d706f74656e63795f6b6579290a202076616c75657320280a20202020765f74656e616e745f69642c0a20202020636f616c657363652828705f66697273745f6465616c2d3e3e2773746174757327293a3a7075626c69632e6465616c5f7374617475732c20274e6577273a3a7075626c69632e6465616c5f737461747573292c0a20202020636f616c6573636528705f66697273745f6465616c2d3e3e276d61726b65745f61726561272c202764656661756c7427292c0a20202020705f6964656d706f74656e63795f6b65790a2020290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202074656e616e745f6964203a3d20765f74656e616e745f69643b0a20206465616c5f6964203a3d20765f6465616c5f69643b0a202072657475726e206e6578743b0a656e643b0a2466756e6374696f6e240000005b6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e622c20746578742920746f2061757468656e7469636174656400000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE INDEX"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125152844_week3_provision_upgrade_save_wrapper_arg_order.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- NO-OP PLACEHOLDER\n-- This migration version exists on remote and was previously applied.\n-- The actual wrapper function is no longer used (superseded by later migrations).\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125152844"},{"text":"week3_provision_upgrade_save_wrapper_arg_order"},{"binary":"0000000100000000000000190000000100000001000000b72d2d204e4f2d4f5020504c414345484f4c4445520a2d2d2054686973206d6967726174696f6e2076657273696f6e20657869737473206f6e2072656d6f746520616e64207761732070726576696f75736c79206170706c6965642e0a2d2d205468652061637475616c20777261707065722066756e6374696f6e206973206e6f206c6f6e6765722075736564202873757065727365646564206279206c61746572206d6967726174696f6e73292e0a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125153205_week3_provision_upgrade_save_single_signature.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Week 3: provision_upgrade_save single signature (remove overload ambiguity)\nbegin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Drop both existing overloads\ndrop function if exists public.provision_upgrade_save(text, jsonb, text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.provision_upgrade_save(jsonb, text, text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Create ONE function with PostgREST-friendly signature/order\ncreate or replace function public.provision_upgrade_save(\n  p_first_deal jsonb,\n  p_idempotency_key text,\n  p_workspace_name text\n)\nreturns table (tenant_id uuid, deal_id uuid)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_user_id uuid := auth.uid();\n  v_tenant_id uuid;\n  v_existing_deal_id uuid;\n  v_deal_id uuid;\nbegin\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  select tm.tenant_id\n    into v_tenant_id\n  from public.tenant_memberships tm\n  where tm.user_id = v_user_id\n  order by tm.created_at asc\n  limit 1;\n\n  if v_tenant_id is null then\n    insert into public.tenants (workspace_name, subscription_status, trial_started_at, trial_ends_at)\n    values (coalesce(p_workspace_name,''), 'trialing'::public.subscription_status, now(), now() + interval '14 days')\n    returning id into v_tenant_id;\n\n    insert into public.tenant_memberships (tenant_id, user_id, role)\n    values (v_tenant_id, v_user_id, 'owner');\n  end if;\n\n  if p_idempotency_key is not null then\n    select d.id into v_existing_deal_id\n    from public.deals d\n    where d.tenant_id = v_tenant_id\n      and d.idempotency_key = p_idempotency_key\n    limit 1;\n\n    if v_existing_deal_id is not null then\n      tenant_id := v_tenant_id;\n      deal_id := v_existing_deal_id;\n      return next;\n      return;\n    end if;\n  end if;\n\n  insert into public.deals (tenant_id, status, market_area, idempotency_key)\n  values (\n    v_tenant_id,\n    coalesce((p_first_deal-\u003e\u003e'status')::public.deal_status, 'New'::public.deal_status),\n    coalesce(p_first_deal-\u003e\u003e'market_area', 'default'),\n    p_idempotency_key\n  )\n  returning id into v_deal_id;\n\n  tenant_id := v_tenant_id;\n  deal_id := v_deal_id;\n  return next;\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.provision_upgrade_save(jsonb, text, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125153205"},{"text":"week3_provision_upgrade_save_single_signature"},{"binary":"0000000100000000000000190000000600000001000000542d2d205765656b20333a2070726f766973696f6e5f757067726164655f736176652073696e676c65207369676e6174757265202872656d6f7665206f7665726c6f616420616d62696775697479290a626567696e000000682d2d2044726f7020626f7468206578697374696e67206f7665726c6f6164730a64726f702066756e6374696f6e20696620657869737473207075626c69632e70726f766973696f6e5f757067726164655f7361766528746578742c206a736f6e622c2074657874290000004864726f702066756e6374696f6e20696620657869737473207075626c69632e70726f766973696f6e5f757067726164655f73617665286a736f6e622c20746578742c2074657874290000071d2d2d20437265617465204f4e452066756e6374696f6e207769746820506f737467524553542d667269656e646c79207369676e61747572652f6f726465720a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f73617665280a2020705f66697273745f6465616c206a736f6e622c0a2020705f6964656d706f74656e63795f6b657920746578742c0a2020705f776f726b73706163655f6e616d6520746578740a290a72657475726e73207461626c65202874656e616e745f696420757569642c206465616c5f69642075756964290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f757365725f69642075756964203a3d20617574682e75696428293b0a2020765f74656e616e745f696420757569643b0a2020765f6578697374696e675f6465616c5f696420757569643b0a2020765f6465616c5f696420757569643b0a626567696e0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420746d2e74656e616e745f69640a20202020696e746f20765f74656e616e745f69640a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a2020776865726520746d2e757365725f6964203d20765f757365725f69640a20206f7264657220627920746d2e637265617465645f6174206173630a20206c696d697420313b0a0a2020696620765f74656e616e745f6964206973206e756c6c207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e74732028776f726b73706163655f6e616d652c20737562736372697074696f6e5f7374617475732c20747269616c5f737461727465645f61742c20747269616c5f656e64735f6174290a2020202076616c7565732028636f616c6573636528705f776f726b73706163655f6e616d652c2727292c2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c206e6f7728292c206e6f772829202b20696e74657276616c20273134206461797327290a2020202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c65290a2020202076616c7565732028765f74656e616e745f69642c20765f757365725f69642c20276f776e657227293b0a2020656e642069663b0a0a2020696620705f6964656d706f74656e63795f6b6579206973206e6f74206e756c6c207468656e0a2020202073656c65637420642e696420696e746f20765f6578697374696e675f6465616c5f69640a2020202066726f6d207075626c69632e6465616c7320640a20202020776865726520642e74656e616e745f6964203d20765f74656e616e745f69640a202020202020616e6420642e6964656d706f74656e63795f6b6579203d20705f6964656d706f74656e63795f6b65790a202020206c696d697420313b0a0a20202020696620765f6578697374696e675f6465616c5f6964206973206e6f74206e756c6c207468656e0a20202020202074656e616e745f6964203a3d20765f74656e616e745f69643b0a2020202020206465616c5f6964203a3d20765f6578697374696e675f6465616c5f69643b0a20202020202072657475726e206e6578743b0a20202020202072657475726e3b0a20202020656e642069663b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e6465616c73202874656e616e745f69642c207374617475732c206d61726b65745f617265612c206964656d706f74656e63795f6b6579290a202076616c75657320280a20202020765f74656e616e745f69642c0a20202020636f616c657363652828705f66697273745f6465616c2d3e3e2773746174757327293a3a7075626c69632e6465616c5f7374617475732c20274e6577273a3a7075626c69632e6465616c5f737461747573292c0a20202020636f616c6573636528705f66697273745f6465616c2d3e3e276d61726b65745f61726561272c202764656661756c7427292c0a20202020705f6964656d706f74656e63795f6b65790a2020290a202072657475726e696e6720696420696e746f20765f6465616c5f69643b0a0a202074656e616e745f6964203a3d20765f74656e616e745f69643b0a20206465616c5f6964203a3d20765f6465616c5f69643b0a202072657475726e206e6578743b0a656e643b0a2466756e6374696f6e240000005b6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e70726f766973696f6e5f757067726164655f73617665286a736f6e622c20746578742c20746578742920746f2061757468656e7469636174656400000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.provision_upgrade_save(jsonb,text,text) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.provision_upgrade_save(jsonb,text,text) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"COMMIT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125184011_pending_invites_no_token_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- No-token invite discovery + accept RPCs\n-- Canonical names; no overloads; no signature churn.\n\ndrop function if exists public.get_my_pending_invites_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.accept_my_invite_rpc(uuid)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.get_my_pending_invites_rpc()\nreturns table (\n  invite_id uuid,\n  tenant_id uuid,\n  workspace_name text,\n  invited_role text,\n  inviter_email text,\n  created_at timestamptz\n)\nlanguage sql\nsecurity definer\nstable\nset search_path = public, auth, extensions\nas $function$\n  with me as (\n    select lower(u.email) as email_lc\n    from auth.users u\n    where u.id = auth.uid()\n  )\n  select\n    i.id as invite_id,\n    i.tenant_id,\n    t.workspace_name,\n    i.invited_role,\n    (select u.email from auth.users u where u.id = i.created_by) as inviter_email,\n    i.created_at\n  from public.tenant_invites i\n  join public.tenants t on t.id = i.tenant_id\n  join me on true\n  where\n    i.revoked_at is null\n    and i.accepted_at is null\n    and i.invited_email_lc = me.email_lc\n  order by i.created_at desc;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.get_my_pending_invites_rpc() from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_my_pending_invites_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.accept_my_invite_rpc(p_invite_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nvolatile\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_token text;\n  v_my_email_lc text;\nbegin\n  select lower(u.email) into v_my_email_lc\n  from auth.users u\n  where u.id = auth.uid();\n\n  if v_my_email_lc is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  select i.token into v_token\n  from public.tenant_invites i\n  where\n    i.id = p_invite_id\n    and i.revoked_at is null\n    and i.accepted_at is null\n    and i.invited_email_lc = v_my_email_lc;\n\n  if v_token is null then\n    raise exception 'INVITE_NOT_FOUND';\n  end if;\n\n  return public.accept_invite(v_token);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.accept_my_invite_rpc(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.accept_my_invite_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125184011"},{"text":"pending_invites_no_token_rpc"},{"binary":"00000001000000000000001900000008000000010000009d2d2d204e6f2d746f6b656e20696e7669746520646973636f76657279202b2061636365707420525043730a2d2d2043616e6f6e6963616c206e616d65733b206e6f206f7665726c6f6164733b206e6f207369676e617475726520636875726e2e0a0a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290000003964726f702066756e6374696f6e20696620657869737473207075626c69632e6163636570745f6d795f696e766974655f7270632875756964290000033c6372656174652066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328290a72657475726e73207461626c6520280a2020696e766974655f696420757569642c0a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020696e76697465645f726f6c6520746578742c0a2020696e76697465725f656d61696c20746578742c0a2020637265617465645f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a736563757269747920646566696e65720a737461626c650a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a202077697468206d6520617320280a2020202073656c656374206c6f77657228752e656d61696c2920617320656d61696c5f6c630a2020202066726f6d20617574682e757365727320750a20202020776865726520752e6964203d20617574682e75696428290a2020290a202073656c6563740a20202020692e696420617320696e766974655f69642c0a20202020692e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020692e696e76697465645f726f6c652c0a202020202873656c65637420752e656d61696c2066726f6d20617574682e7573657273207520776865726520752e6964203d20692e637265617465645f62792920617320696e76697465725f656d61696c2c0a20202020692e637265617465645f61740a202066726f6d207075626c69632e74656e616e745f696e766974657320690a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20692e74656e616e745f69640a20206a6f696e206d65206f6e20747275650a202077686572650a20202020692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e6420692e696e76697465645f656d61696c5f6c63203d206d652e656d61696c5f6c630a20206f7264657220627920692e637265617465645f617420646573633b0a2466756e6374696f6e24000000467265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f72706328292066726f6d207075626c69630000004e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f6d795f70656e64696e675f696e76697465735f727063282920746f2061757468656e74696361746564000002d76372656174652066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f72706328705f696e766974655f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a766f6c6174696c650a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f746f6b656e20746578743b0a2020765f6d795f656d61696c5f6c6320746578743b0a626567696e0a202073656c656374206c6f77657228752e656d61696c2920696e746f20765f6d795f656d61696c5f6c630a202066726f6d20617574682e757365727320750a2020776865726520752e6964203d20617574682e75696428293b0a0a2020696620765f6d795f656d61696c5f6c63206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420692e746f6b656e20696e746f20765f746f6b656e0a202066726f6d207075626c69632e74656e616e745f696e766974657320690a202077686572650a20202020692e6964203d20705f696e766974655f69640a20202020616e6420692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e6420692e696e76697465645f656d61696c5f6c63203d20765f6d795f656d61696c5f6c633b0a0a2020696620765f746f6b656e206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f4e4f545f464f554e44273b0a2020656e642069663b0a0a202072657475726e207075626c69632e6163636570745f696e7669746528765f746f6b656e293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f7270632875756964292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f72706328757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.accept_my_invite_rpc(uuid) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.accept_my_invite_rpc(uuid) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125203123_seat_limit_100_and_invite_lc_fix.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 1) Default seat limit = 100, and upgrade existing default-ish rows\nalter table public.tenants\n  alter column seat_limit set default 100","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"update public.tenants\nset seat_limit = 100\nwhere seat_limit = 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 2) Fix create_invite_rpc: do NOT insert invited_email_lc (generated/identity)\n-- Must keep original param names to avoid 42P13.\ndrop function if exists public.create_invite_rpc(uuid, text)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.create_invite_rpc(tenant_id uuid, email text)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nvolatile\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_token text;\n  v_email text;\n  v_email_lc text;\n  v_invite_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  v_email := trim(email);\n  v_email_lc := lower(v_email);\n\n  if v_email_lc is null or v_email_lc = '' then\n    raise exception 'EMAIL_REQUIRED';\n  end if;\n\n  v_token := encode(extensions.gen_random_bytes(24), 'hex');\n\n  insert into public.tenant_invites (\n    tenant_id,\n    invited_email,\n    invited_role,\n    token,\n    created_by\n  )\n  values (\n    tenant_id,\n    v_email,\n    'member',\n    v_token,\n    auth.uid()\n  )\n  returning id into v_invite_id;\n\n  return jsonb_build_object(\n    'ok', true,\n    'invite_id', v_invite_id,\n    'email', v_email,\n    'token', v_token,\n    'tenant_id', tenant_id\n  );\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.create_invite_rpc(uuid, text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_invite_rpc(uuid, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125203123"},{"text":"seat_limit_100_and_invite_lc_fix"},{"binary":"00000001000000000000001900000006000000010000008a2d2d2031292044656661756c742073656174206c696d6974203d203130302c20616e642075706772616465206578697374696e672064656661756c742d69736820726f77730a616c746572207461626c65207075626c69632e74656e616e74730a2020616c74657220636f6c756d6e20736561745f6c696d6974207365742064656661756c74203130300000003f757064617465207075626c69632e74656e616e74730a73657420736561745f6c696d6974203d203130300a776865726520736561745f6c696d6974203d2031000000bf2d2d20322920466978206372656174655f696e766974655f7270633a20646f204e4f5420696e7365727420696e76697465645f656d61696c5f6c63202867656e6572617465642f6964656e74697479290a2d2d204d757374206b656570206f726967696e616c20706172616d206e616d657320746f2061766f69642034325031332e0a64726f702066756e6374696f6e20696620657869737473207075626c69632e6372656174655f696e766974655f72706328757569642c207465787429000003c86372656174652066756e6374696f6e207075626c69632e6372656174655f696e766974655f7270632874656e616e745f696420757569642c20656d61696c2074657874290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a766f6c6174696c650a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f746f6b656e20746578743b0a2020765f656d61696c20746578743b0a2020765f656d61696c5f6c6320746578743b0a2020765f696e766974655f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020765f656d61696c203a3d207472696d28656d61696c293b0a2020765f656d61696c5f6c63203a3d206c6f77657228765f656d61696c293b0a0a2020696620765f656d61696c5f6c63206973206e756c6c206f7220765f656d61696c5f6c63203d202727207468656e0a20202020726169736520657863657074696f6e2027454d41494c5f5245515549524544273b0a2020656e642069663b0a0a2020765f746f6b656e203a3d20656e636f646528657874656e73696f6e732e67656e5f72616e646f6d5f6279746573283234292c202768657827293b0a0a2020696e7365727420696e746f207075626c69632e74656e616e745f696e766974657320280a2020202074656e616e745f69642c0a20202020696e76697465645f656d61696c2c0a20202020696e76697465645f726f6c652c0a20202020746f6b656e2c0a20202020637265617465645f62790a2020290a202076616c75657320280a2020202074656e616e745f69642c0a20202020765f656d61696c2c0a20202020276d656d626572272c0a20202020765f746f6b656e2c0a20202020617574682e75696428290a2020290a202072657475726e696e6720696420696e746f20765f696e766974655f69643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a656374280a20202020276f6b272c20747275652c0a2020202027696e766974655f6964272c20765f696e766974655f69642c0a2020202027656d61696c272c20765f656d61696c2c0a2020202027746f6b656e272c20765f746f6b656e2c0a202020202774656e616e745f6964272c2074656e616e745f69640a2020293b0a656e643b0a2466756e6374696f6e24000000477265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c2074657874292066726f6d207075626c69630000004f6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328757569642c20746578742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260125203814_accept_my_invite_returns_jsonb_ok.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Fix: accept_my_invite_rpc must return valid JSONB for Supabase/PostgREST.\n-- Keep signature stable (uuid -\u003e jsonb). Only change body.\n\ncreate or replace function public.accept_my_invite_rpc(p_invite_id uuid)\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nvolatile\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_token text;\n  v_my_email_lc text;\nbegin\n  select lower(u.email) into v_my_email_lc\n  from auth.users u\n  where u.id = auth.uid();\n\n  if v_my_email_lc is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  select i.token into v_token\n  from public.tenant_invites i\n  where\n    i.id = p_invite_id\n    and i.revoked_at is null\n    and i.accepted_at is null\n    and i.invited_email_lc = v_my_email_lc;\n\n  if v_token is null then\n    raise exception 'INVITE_NOT_FOUND';\n  end if;\n\n  -- IMPORTANT: do not return accept_invite(...) directly (may not be JSON).\n  perform public.accept_invite(v_token);\n\n  return jsonb_build_object('ok', true);\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.accept_my_invite_rpc(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.accept_my_invite_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260125203814"},{"text":"accept_my_invite_returns_jsonb_ok"},{"binary":"0000000100000000000000190000000300000001000003e42d2d204669783a206163636570745f6d795f696e766974655f727063206d7573742072657475726e2076616c6964204a534f4e4220666f722053757061626173652f506f737467524553542e0a2d2d204b656570207369676e617475726520737461626c65202875756964202d3e206a736f6e62292e204f6e6c79206368616e676520626f64792e0a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f72706328705f696e766974655f69642075756964290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a766f6c6174696c650a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f746f6b656e20746578743b0a2020765f6d795f656d61696c5f6c6320746578743b0a626567696e0a202073656c656374206c6f77657228752e656d61696c2920696e746f20765f6d795f656d61696c5f6c630a202066726f6d20617574682e757365727320750a2020776865726520752e6964203d20617574682e75696428293b0a0a2020696620765f6d795f656d61696c5f6c63206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a202073656c65637420692e746f6b656e20696e746f20765f746f6b656e0a202066726f6d207075626c69632e74656e616e745f696e766974657320690a202077686572650a20202020692e6964203d20705f696e766974655f69640a20202020616e6420692e7265766f6b65645f6174206973206e756c6c0a20202020616e6420692e61636365707465645f6174206973206e756c6c0a20202020616e6420692e696e76697465645f656d61696c5f6c63203d20765f6d795f656d61696c5f6c633b0a0a2020696620765f746f6b656e206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027494e564954455f4e4f545f464f554e44273b0a2020656e642069663b0a0a20202d2d20494d504f5254414e543a20646f206e6f742072657475726e206163636570745f696e76697465282e2e2e29206469726563746c7920286d6179206e6f74206265204a534f4e292e0a2020706572666f726d207075626c69632e6163636570745f696e7669746528765f746f6b656e293b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c2074727565293b0a656e643b0a2466756e6374696f6e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f7270632875756964292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6163636570745f6d795f696e766974655f72706328757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126093952_free_trial_core_plan_actions.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Free/Trial/Core plan actions (no Pro)\n-- Assumptions from existing system:\n-- - public.get_entitlements() exists and is used for routing\n-- - public.start_trial(tenant_id uuid) exists (pending -\u003e trialing + stamps 14 days)\n-- - public.current_tenant_id() exists\n-- - tenants.subscription_status is enum public.subscription_status\n-- - tenants.subscription_tier is currently text (existing values like 'core'); we will use 'free' and 'core'\n\ncreate or replace function public.set_plan_free_current_tenant_rpc()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_uid uuid := auth.uid();\n  v_tid uuid := public.current_tenant_id();\n  v_is_owner boolean;\nbegin\n  if v_uid is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if v_tid is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tid\n      and tm.user_id = v_uid\n      and tm.role = 'owner'\n  ) into v_is_owner;\n\n  if not v_is_owner then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  update public.tenants t\n    set subscription_status = 'active'::public.subscription_status,\n        subscription_tier = 'free'\n  where t.id = v_tid;\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tid, 'tier', 'free', 'status', 'active');\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_plan_free_current_tenant_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.start_trial_current_tenant_rpc()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_uid uuid := auth.uid();\n  v_tid uuid := public.current_tenant_id();\n  v_is_owner boolean;\n  v_trial_started_at timestamptz;\nbegin\n  if v_uid is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if v_tid is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tid\n      and tm.user_id = v_uid\n      and tm.role = 'owner'\n  ) into v_is_owner;\n\n  if not v_is_owner then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  select t.trial_started_at\n  into v_trial_started_at\n  from public.tenants t\n  where t.id = v_tid;\n\n  -- One-time trial per workspace: if it ever started, it cannot be started again\n  if v_trial_started_at is not null then\n    raise exception 'TRIAL_ALREADY_USED';\n  end if;\n\n  -- Calls the existing canonical billing transition RPC you already have\n  perform public.start_trial(v_tid);\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tid, 'status', 'trialing', 'tier', 'core');\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.start_trial_current_tenant_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126093952"},{"text":"free_trial_core_plan_actions"},{"binary":"00000001000000000000001900000004000000010000056b2d2d20467265652f547269616c2f436f726520706c616e20616374696f6e7320286e6f2050726f290a2d2d20417373756d7074696f6e732066726f6d206578697374696e672073797374656d3a0a2d2d202d207075626c69632e6765745f656e7469746c656d656e747328292065786973747320616e64206973207573656420666f7220726f7574696e670a2d2d202d207075626c69632e73746172745f747269616c2874656e616e745f696420757569642920657869737473202870656e64696e67202d3e20747269616c696e67202b207374616d70732031342064617973290a2d2d202d207075626c69632e63757272656e745f74656e616e745f69642829206578697374730a2d2d202d2074656e616e74732e737562736372697074696f6e5f73746174757320697320656e756d207075626c69632e737562736372697074696f6e5f7374617475730a2d2d202d2074656e616e74732e737562736372697074696f6e5f746965722069732063757272656e746c79207465787420286578697374696e672076616c756573206c696b652027636f726527293b2077652077696c6c207573652027667265652720616e642027636f7265270a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f706c616e5f667265655f63757272656e745f74656e616e745f72706328290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f7569642075756964203a3d20617574682e75696428293b0a2020765f7469642075756964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020765f69735f6f776e657220626f6f6c65616e3b0a626567696e0a2020696620765f756964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020696620765f746964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f7469640a202020202020616e6420746d2e757365725f6964203d20765f7569640a202020202020616e6420746d2e726f6c65203d20276f776e6572270a20202920696e746f20765f69735f6f776e65723b0a0a20206966206e6f7420765f69735f6f776e6572207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a2020757064617465207075626c69632e74656e616e747320740a2020202073657420737562736372697074696f6e5f737461747573203d2027616374697665273a3a7075626c69632e737562736372697074696f6e5f7374617475732c0a2020202020202020737562736372697074696f6e5f74696572203d202766726565270a2020776865726520742e6964203d20765f7469643b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f7469642c202774696572272c202766726565272c2027737461747573272c202761637469766527293b0a656e643b0a2466756e6374696f6e24000000546772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f706c616e5f667265655f63757272656e745f74656e616e745f727063282920746f2061757468656e74696361746564000004be637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746172745f747269616c5f63757272656e745f74656e616e745f72706328290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f7569642075756964203a3d20617574682e75696428293b0a2020765f7469642075756964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020765f69735f6f776e657220626f6f6c65616e3b0a2020765f747269616c5f737461727465645f61742074696d657374616d70747a3b0a626567696e0a2020696620765f756964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020696620765f746964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f7469640a202020202020616e6420746d2e757365725f6964203d20765f7569640a202020202020616e6420746d2e726f6c65203d20276f776e6572270a20202920696e746f20765f69735f6f776e65723b0a0a20206966206e6f7420765f69735f6f776e6572207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a202073656c65637420742e747269616c5f737461727465645f61740a2020696e746f20765f747269616c5f737461727465645f61740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d20765f7469643b0a0a20202d2d204f6e652d74696d6520747269616c2070657220776f726b73706163653a206966206974206576657220737461727465642c2069742063616e6e6f74206265207374617274656420616761696e0a2020696620765f747269616c5f737461727465645f6174206973206e6f74206e756c6c207468656e0a20202020726169736520657863657074696f6e2027545249414c5f414c52454144595f55534544273b0a2020656e642069663b0a0a20202d2d2043616c6c7320746865206578697374696e672063616e6f6e6963616c2062696c6c696e67207472616e736974696f6e2052504320796f7520616c726561647920686176650a2020706572666f726d207075626c69632e73746172745f747269616c28765f746964293b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f7469642c2027737461747573272c2027747269616c696e67272c202774696572272c2027636f726527293b0a656e643b0a2466756e6374696f6e24000000526772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c5f63757272656e745f74656e616e745f727063282920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126094712_fix_start_trial_current_tenant_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure start_trial_current_tenant_rpc exists + is executable, then force PostgREST schema reload\n\ncreate or replace function public.start_trial_current_tenant_rpc()\nreturns jsonb\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_uid uuid := auth.uid();\n  v_tid uuid := public.current_tenant_id();\n  v_is_owner boolean;\n  v_trial_started_at timestamptz;\nbegin\n  if v_uid is null then\n    raise exception 'AUTH_REQUIRED';\n  end if;\n\n  if v_tid is null then\n    raise exception 'NO_CURRENT_TENANT';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.tenant_id = v_tid\n      and tm.user_id = v_uid\n      and tm.role = 'owner'\n  ) into v_is_owner;\n\n  if not v_is_owner then\n    raise exception 'OWNER_ONLY';\n  end if;\n\n  select t.trial_started_at\n    into v_trial_started_at\n  from public.tenants t\n  where t.id = v_tid;\n\n  if v_trial_started_at is not null then\n    raise exception 'TRIAL_ALREADY_USED';\n  end if;\n\n  perform public.start_trial(v_tid);\n\n  return jsonb_build_object('ok', true, 'tenant_id', v_tid, 'status', 'trialing', 'tier', 'core');\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.start_trial_current_tenant_rpc() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\nexception when others then\n  -- ignore if notify channel not present; local supabase typically supports it\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126094712"},{"text":"fix_start_trial_current_tenant_rpc"},{"binary":"0000000100000000000000190000000300000001000004892d2d20456e737572652073746172745f747269616c5f63757272656e745f74656e616e745f72706320657869737473202b2069732065786563757461626c652c207468656e20666f72636520506f7374675245535420736368656d612072656c6f61640a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746172745f747269616c5f63757272656e745f74656e616e745f72706328290a72657475726e73206a736f6e620a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f7569642075756964203a3d20617574682e75696428293b0a2020765f7469642075756964203a3d207075626c69632e63757272656e745f74656e616e745f696428293b0a2020765f69735f6f776e657220626f6f6c65616e3b0a2020765f747269616c5f737461727465645f61742074696d657374616d70747a3b0a626567696e0a2020696620765f756964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f5245515549524544273b0a2020656e642069663b0a0a2020696620765f746964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20274e4f5f43555252454e545f54454e414e54273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e74656e616e745f6964203d20765f7469640a202020202020616e6420746d2e757365725f6964203d20765f7569640a202020202020616e6420746d2e726f6c65203d20276f776e6572270a20202920696e746f20765f69735f6f776e65723b0a0a20206966206e6f7420765f69735f6f776e6572207468656e0a20202020726169736520657863657074696f6e20274f574e45525f4f4e4c59273b0a2020656e642069663b0a0a202073656c65637420742e747269616c5f737461727465645f61740a20202020696e746f20765f747269616c5f737461727465645f61740a202066726f6d207075626c69632e74656e616e747320740a2020776865726520742e6964203d20765f7469643b0a0a2020696620765f747269616c5f737461727465645f6174206973206e6f74206e756c6c207468656e0a20202020726169736520657863657074696f6e2027545249414c5f414c52454144595f55534544273b0a2020656e642069663b0a0a2020706572666f726d207075626c69632e73746172745f747269616c28765f746964293b0a0a202072657475726e206a736f6e625f6275696c645f6f626a65637428276f6b272c20747275652c202774656e616e745f6964272c20765f7469642c2027737461747573272c2027747269616c696e67272c202774696572272c2027636f726527293b0a656e643b0a2466756e6374696f6e24000000526772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c5f63757272656e745f74656e616e745f727063282920746f2061757468656e7469636174656400000095646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20202d2d2069676e6f7265206966206e6f74696679206368616e6e656c206e6f742070726573656e743b206c6f63616c207375706162617365207479706963616c6c7920737570706f7274732069740a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126100752_fix_start_trial_sets_core_trialing.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure start_trial transitions a workspace into trialing + core (no tier=free during trial)\n-- This resolves gate/entitlements inconsistency.\n\ncreate or replace function public.start_trial(p_tenant_id uuid, p_days integer default 14)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\ndeclare\n  v_trial_ends timestamptz := now() + (p_days || ' days')::interval;\nbegin\n  update public.tenants t\n    set subscription_status = 'trialing'::public.subscription_status,\n        subscription_tier   = 'core',\n        trial_started_at    = coalesce(t.trial_started_at, now()),\n        trial_ends_at       = v_trial_ends\n  where t.id = p_tenant_id;\n\n  -- keep existing billing/audit logic if you have it elsewhere; this is the minimal state fix\nend;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.start_trial(uuid, integer) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.start_trial(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\nexception when others then\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126100752"},{"text":"fix_start_trial_sets_core_trialing"},{"binary":"0000000100000000000000190000000400000001000003272d2d20456e737572652073746172745f747269616c207472616e736974696f6e73206120776f726b737061636520696e746f20747269616c696e67202b20636f726520286e6f20746965723d6672656520647572696e6720747269616c290a2d2d2054686973207265736f6c76657320676174652f656e7469746c656d656e747320696e636f6e73697374656e63792e0a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e73746172745f747269616c28705f74656e616e745f696420757569642c20705f6461797320696e74656765722064656661756c74203134290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a6465636c6172650a2020765f747269616c5f656e64732074696d657374616d70747a203a3d206e6f772829202b2028705f64617973207c7c2027206461797327293a3a696e74657276616c3b0a626567696e0a2020757064617465207075626c69632e74656e616e747320740a2020202073657420737562736372697074696f6e5f737461747573203d2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c0a2020202020202020737562736372697074696f6e5f746965722020203d2027636f7265272c0a2020202020202020747269616c5f737461727465645f6174202020203d20636f616c6573636528742e747269616c5f737461727465645f61742c206e6f772829292c0a2020202020202020747269616c5f656e64735f6174202020202020203d20765f747269616c5f656e64730a2020776865726520742e6964203d20705f74656e616e745f69643b0a0a20202d2d206b656570206578697374696e672062696c6c696e672f6175646974206c6f67696320696620796f75206861766520697420656c736577686572653b207468697320697320746865206d696e696d616c207374617465206669780a656e643b0a2466756e6374696f6e240000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c28757569642c20696e74656765722920746f2061757468656e74696361746564000000436772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e73746172745f747269616c28757569642920746f2061757468656e7469636174656400000045646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126100955_effective_trial_entitlements.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Required: cannot change return type with CREATE OR REPLACE. Must DROP then CREATE.\ndrop function if exists public.get_entitlements()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Make entitlements reflect an active trial as (tier=core, status=trialing),\n-- even if subscription_tier/status still say free/active.\n-- Also backfill tenant rows for active trials.\n\n-- 1) Backfill tenant rows where trial window is active\nupdate public.tenants t\nset\n  subscription_status = 'trialing'::public.subscription_status,\n  subscription_tier   = 'core'\nwhere\n  t.trial_started_at is not null\n  and t.trial_ends_at is not null\n  and now() \u003c t.trial_ends_at\n  and (t.subscription_status \u003c\u003e 'trialing'::public.subscription_status or t.subscription_tier \u003c\u003e 'core')","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 2) Replace get_entitlements() to compute effective tier/status from trial window\ncreate function public.get_entitlements()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status text,\n  trial_ends_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\n  select\n    tm.tenant_id,\n    t.workspace_name,\n    tm.role,\n    case\n      when t.trial_started_at is not null and t.trial_ends_at is not null and now() \u003c t.trial_ends_at then 'core'\n      else coalesce(t.subscription_tier, 'free')\n    end as tier,\n    case\n      when t.trial_started_at is not null and t.trial_ends_at is not null and now() \u003c t.trial_ends_at then 'trialing'\n      else coalesce(t.subscription_status::text, 'pending')\n    end as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc nulls last;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 3) Force PostgREST schema reload\ndo $function$\nbegin\nexception when others then\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126100955"},{"text":"effective_trial_entitlements"},{"binary":"0000000100000000000000190000000500000001000000872d2d2052657175697265643a2063616e6e6f74206368616e67652072657475726e2074797065207769746820435245415445204f52205245504c4143452e204d7573742044524f50207468656e204352454154452e0a64726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f656e7469746c656d656e747328290000023c2d2d204d616b6520656e7469746c656d656e7473207265666c65637420616e2061637469766520747269616c2061732028746965723d636f72652c207374617475733d747269616c696e67292c0a2d2d206576656e20696620737562736372697074696f6e5f746965722f737461747573207374696c6c2073617920667265652f6163746976652e0a2d2d20416c736f206261636b66696c6c2074656e616e7420726f777320666f722061637469766520747269616c732e0a0a2d2d203129204261636b66696c6c2074656e616e7420726f777320776865726520747269616c2077696e646f77206973206163746976650a757064617465207075626c69632e74656e616e747320740a7365740a2020737562736372697074696f6e5f737461747573203d2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f7374617475732c0a2020737562736372697074696f6e5f746965722020203d2027636f7265270a77686572650a2020742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a2020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a2020616e64206e6f772829203c20742e747269616c5f656e64735f61740a2020616e642028742e737562736372697074696f6e5f737461747573203c3e2027747269616c696e67273a3a7075626c69632e737562736372697074696f6e5f737461747573206f7220742e737562736372697074696f6e5f74696572203c3e2027636f72652729000003e02d2d203229205265706c616365206765745f656e7469746c656d656e7473282920746f20636f6d707574652065666665637469766520746965722f7374617475732066726f6d20747269616c2077696e646f770a6372656174652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e747328290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a202073746174757320746578742c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a202073656c6563740a20202020746d2e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c20616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c20616e64206e6f772829203c20742e747269616c5f656e64735f6174207468656e2027636f7265270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f746965722c20276672656527290a20202020656e6420617320746965722c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c20616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c20616e64206e6f772829203c20742e747269616c5f656e64735f6174207468656e2027747269616c696e67270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f7374617475733a3a746578742c202770656e64696e6727290a20202020656e64206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f61742064657363206e756c6c73206c6173743b0a2466756e6374696f6e24000000446772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e7473282920746f2061757468656e74696361746564000000692d2d20332920466f72636520506f7374675245535420736368656d612072656c6f61640a646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"UPDATE 0"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126101209_add_get_entitlements_v2.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.get_entitlements_v2()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status text,\n  trial_ends_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\n  select\n    tm.tenant_id,\n    t.workspace_name,\n    tm.role,\n    case\n      when t.trial_started_at is not null\n       and t.trial_ends_at is not null\n       and now() \u003c t.trial_ends_at\n      then 'core'\n      else coalesce(t.subscription_tier, 'free')\n    end as tier,\n    case\n      when t.trial_started_at is not null\n       and t.trial_ends_at is not null\n       and now() \u003c t.trial_ends_at\n      then 'trialing'\n      else coalesce(t.subscription_status::text, 'pending')\n    end as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc nulls last;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements_v2() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\nexception when others then\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126101209"},{"text":"add_get_entitlements_v2"},{"binary":"0000000100000000000000190000000300000001000003c2637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e74735f763228290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a202073746174757320746578742c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a202073656c6563740a20202020746d2e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a20202020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a20202020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a2020202020207468656e2027636f7265270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f746965722c20276672656527290a20202020656e6420617320746965722c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a20202020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a20202020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a2020202020207468656e2027747269616c696e67270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f7374617475733a3a746578742c202770656e64696e6727290a20202020656e64206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f61742064657363206e756c6c73206c6173743b0a2466756e6374696f6e24000000476772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e74735f7632282920746f2061757468656e7469636174656400000045646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126101329_add_get_entitlements_v2.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.get_entitlements_v2()\nreturns table (\n  tenant_id uuid,\n  workspace_name text,\n  role text,\n  tier text,\n  status text,\n  trial_ends_at timestamptz\n)\nlanguage sql\nstable\nsecurity definer\nset search_path = public, auth, extensions\nas $function$\n  select\n    tm.tenant_id,\n    t.workspace_name,\n    tm.role,\n    case\n      when t.trial_started_at is not null\n       and t.trial_ends_at is not null\n       and now() \u003c t.trial_ends_at\n      then 'core'\n      else coalesce(t.subscription_tier, 'free')\n    end as tier,\n    case\n      when t.trial_started_at is not null\n       and t.trial_ends_at is not null\n       and now() \u003c t.trial_ends_at\n      then 'trialing'\n      else coalesce(t.subscription_status::text, 'pending')\n    end as status,\n    t.trial_ends_at\n  from public.tenant_memberships tm\n  join public.tenants t on t.id = tm.tenant_id\n  where tm.user_id = auth.uid()\n  order by tm.created_at desc nulls last;\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.get_entitlements_v2() to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\nexception when others then\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126101329"},{"text":"add_get_entitlements_v2"},{"binary":"0000000100000000000000190000000300000001000003c2637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e74735f763228290a72657475726e73207461626c6520280a202074656e616e745f696420757569642c0a2020776f726b73706163655f6e616d6520746578742c0a2020726f6c6520746578742c0a20207469657220746578742c0a202073746174757320746578742c0a2020747269616c5f656e64735f61742074696d657374616d70747a0a290a6c616e67756167652073716c0a737461626c650a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69632c20617574682c20657874656e73696f6e730a6173202466756e6374696f6e240a202073656c6563740a20202020746d2e74656e616e745f69642c0a20202020742e776f726b73706163655f6e616d652c0a20202020746d2e726f6c652c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a20202020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a20202020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a2020202020207468656e2027636f7265270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f746965722c20276672656527290a20202020656e6420617320746965722c0a20202020636173650a2020202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a20202020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a20202020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a2020202020207468656e2027747269616c696e67270a202020202020656c736520636f616c6573636528742e737562736372697074696f6e5f7374617475733a3a746578742c202770656e64696e6727290a20202020656e64206173207374617475732c0a20202020742e747269616c5f656e64735f61740a202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20206a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f69640a2020776865726520746d2e757365725f6964203d20617574682e75696428290a20206f7264657220627920746d2e637265617465645f61742064657363206e756c6c73206c6173743b0a2466756e6374696f6e24000000476772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6765745f656e7469746c656d656e74735f7632282920746f2061757468656e7469636174656400000045646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126102842_entitlements_view.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- (comment cleaned: removed schema-cache wording)\n\ncreate or replace view public.v_entitlements as\nselect\n  tm.user_id,\n  tm.tenant_id,\n  t.workspace_name,\n  tm.role,\n  case\n    when t.trial_started_at is not null\n     and t.trial_ends_at is not null\n     and now() \u003c t.trial_ends_at\n    then 'core'\n    else coalesce(t.subscription_tier, 'free')\n  end as tier,\n  case\n    when t.trial_started_at is not null\n     and t.trial_ends_at is not null\n     and now() \u003c t.trial_ends_at\n    then 'trialing'\n    else coalesce(t.subscription_status::text, 'pending')\n  end as status,\n  t.trial_ends_at\nfrom public.tenant_memberships tm\njoin public.tenants t on t.id = tm.tenant_id","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- RLS on views uses underlying tables' RLS.\n-- Ensure tenant_memberships RLS allows selecting own rows (should already).\n-- If not, you must add it later.\n\ngrant select on public.v_entitlements to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126102842"},{"text":"entitlements_view"},{"binary":"00000001000000000000001900000002000000010000029f2d2d2028636f6d6d656e7420636c65616e65643a2072656d6f76656420736368656d612d636163686520776f7264696e67290a0a637265617465206f72207265706c6163652076696577207075626c69632e765f656e7469746c656d656e74732061730a73656c6563740a2020746d2e757365725f69642c0a2020746d2e74656e616e745f69642c0a2020742e776f726b73706163655f6e616d652c0a2020746d2e726f6c652c0a2020636173650a202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a2020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a2020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a202020207468656e2027636f7265270a20202020656c736520636f616c6573636528742e737562736372697074696f6e5f746965722c20276672656527290a2020656e6420617320746965722c0a2020636173650a202020207768656e20742e747269616c5f737461727465645f6174206973206e6f74206e756c6c0a2020202020616e6420742e747269616c5f656e64735f6174206973206e6f74206e756c6c0a2020202020616e64206e6f772829203c20742e747269616c5f656e64735f61740a202020207468656e2027747269616c696e67270a20202020656c736520636f616c6573636528742e737562736372697074696f6e5f7374617475733a3a746578742c202770656e64696e6727290a2020656e64206173207374617475732c0a2020742e747269616c5f656e64735f61740a66726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a6a6f696e207075626c69632e74656e616e74732074206f6e20742e6964203d20746d2e74656e616e745f6964000000d32d2d20524c53206f6e207669657773207573657320756e6465726c79696e67207461626c65732720524c532e0a2d2d20456e737572652074656e616e745f6d656d626572736869707320524c5320616c6c6f77732073656c656374696e67206f776e20726f7773202873686f756c6420616c7265616479292e0a2d2d204966206e6f742c20796f75206d75737420616464206974206c617465722e0a0a6772616e742073656c656374206f6e207075626c69632e765f656e7469746c656d656e747320746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE VIEW"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126103135_create_v_entitlements_and_reload.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- NO-OP (retired)\n-- Reason: v_entitlements is created in 20260126102842_entitlements_view.sql (canonical).\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126103135"},{"text":"create_v_entitlements_and_reload"},{"binary":"0000000100000000000000190000000100000001000000752d2d204e4f2d4f50202872657469726564290a2d2d20526561736f6e3a20765f656e7469746c656d656e7473206973206372656174656420696e2032303236303132363130323834325f656e7469746c656d656e74735f766965772e73716c202863616e6f6e6963616c292e0a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126103607_expose_v_entitlements_to_anon.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Remove anon exposure (security hardening)\nrevoke all on public.v_entitlements from anon","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on public.v_entitlements from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant select on public.v_entitlements to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126103607"},{"text":"expose_v_entitlements_to_anon"},{"binary":"00000001000000000000001900000003000000010000005a2d2d2052656d6f766520616e6f6e206578706f73757265202873656375726974792068617264656e696e67290a7265766f6b6520616c6c206f6e207075626c69632e765f656e7469746c656d656e74732066726f6d20616e6f6e0000002f7265766f6b6520616c6c206f6e207075626c69632e765f656e7469746c656d656e74732066726f6d207075626c6963000000366772616e742073656c656374206f6e207075626c69632e765f656e7469746c656d656e747320746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126104406_cleanup_unused_rpcs.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Cleanup unused/failed schema-cache objects\n\ndrop view if exists public.v_entitlements","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.get_entitlements_v2()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- If created during earlier attempts; safe to drop if not used\ndrop function if exists public.start_trial_current_tenant_rpc()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $function$\nbegin\nexception when others then\n  null;\nend $function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126104406"},{"text":"cleanup_unused_rpcs"},{"binary":"0000000100000000000000190000000400000001000000582d2d20436c65616e757020756e757365642f6661696c656420736368656d612d6361636865206f626a656374730a0a64726f70207669657720696620657869737473207075626c69632e765f656e7469746c656d656e74730000003464726f702066756e6374696f6e20696620657869737473207075626c69632e6765745f656e7469746c656d656e74735f763228290000007f2d2d204966206372656174656420647572696e67206561726c69657220617474656d7074733b207361666520746f2064726f70206966206e6f7420757365640a64726f702066756e6374696f6e20696620657869737473207075626c69632e73746172745f747269616c5f63757272656e745f74656e616e745f727063282900000045646f202466756e6374696f6e240a626567696e0a657863657074696f6e207768656e206f7468657273207468656e0a20206e756c6c3b0a656e64202466756e6374696f6e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP VIEW"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126145850_deal_status_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Deal status RPC (stable signature)\ncreate or replace function public.update_deal_status_rpc(\n  p_deal_id uuid,\n  p_status text,\n  p_expected_row_version integer\n)\nreturns table (\n  id uuid,\n  row_version integer\n)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_id uuid;\n  v_row_version integer;\nbegin\n  -- hard gate: must have write access for current tenant\n  if not public.can_write_current_tenant() then\n    raise exception 'WRITE_NOT_ALLOWED' using errcode = '42501';\n  end if;\n\n  update public.deals d\n     set status = p_status,\n         row_version = d.row_version + 1,\n         updated_at = now()\n   where d.id = p_deal_id\n     and d.tenant_id = public.current_tenant_id()\n     and d.row_version = p_expected_row_version\n  returning d.id, d.row_version into v_id, v_row_version;\n\n  if v_id is null then\n    raise exception 'CONFLICT_OR_NOT_FOUND' using errcode = '40900';\n  end if;\n\n  id := v_id;\n  row_version := v_row_version;\n  return next;\nend\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.update_deal_status_rpc(uuid, text, integer) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.update_deal_status_rpc(uuid, text, integer) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126145850"},{"text":"deal_status_rpc"},{"binary":"0000000100000000000000190000000300000001000003ef2d2d204465616c20737461747573205250432028737461626c65207369676e6174757265290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f727063280a2020705f6465616c5f696420757569642c0a2020705f73746174757320746578742c0a2020705f65787065637465645f726f775f76657273696f6e20696e74656765720a290a72657475726e73207461626c6520280a2020696420757569642c0a2020726f775f76657273696f6e20696e74656765720a290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f696420757569643b0a2020765f726f775f76657273696f6e20696e74656765723b0a626567696e0a20202d2d206861726420676174653a206d75737420686176652077726974652061636365737320666f722063757272656e742074656e616e740a20206966206e6f74207075626c69632e63616e5f77726974655f63757272656e745f74656e616e742829207468656e0a20202020726169736520657863657074696f6e202757524954455f4e4f545f414c4c4f57454427207573696e6720657272636f6465203d20273432353031273b0a2020656e642069663b0a0a2020757064617465207075626c69632e6465616c7320640a202020202073657420737461747573203d20705f7374617475732c0a202020202020202020726f775f76657273696f6e203d20642e726f775f76657273696f6e202b20312c0a202020202020202020757064617465645f6174203d206e6f7728290a202020776865726520642e6964203d20705f6465616c5f69640a2020202020616e6420642e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a2020202020616e6420642e726f775f76657273696f6e203d20705f65787065637465645f726f775f76657273696f6e0a202072657475726e696e6720642e69642c20642e726f775f76657273696f6e20696e746f20765f69642c20765f726f775f76657273696f6e3b0a0a2020696620765f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027434f4e464c4943545f4f525f4e4f545f464f554e4427207573696e6720657272636f6465203d20273430393030273b0a2020656e642069663b0a0a20206964203a3d20765f69643b0a2020726f775f76657273696f6e203a3d20765f726f775f76657273696f6e3b0a202072657475726e206e6578743b0a656e640a2466756e6374696f6e24000000557265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f72706328757569642c20746578742c20696e7465676572292066726f6d207075626c69630000005d6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f72706328757569642c20746578742c20696e74656765722920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126152107_update_deal_status_rpc_fix.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Ensure PostgREST can find: public.update_deal_status_rpc(p_deal_id, p_expected_row_version, p_status)\n\ncreate or replace function public.update_deal_status_rpc(\n  p_deal_id uuid,\n  p_expected_row_version integer,\n  p_status text\n)\nreturns table (\n  id uuid,\n  row_version integer\n)\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $function$\ndeclare\n  v_id uuid;\n  v_row_version integer;\nbegin\n  if not public.can_write_current_tenant() then\n    raise exception 'WRITE_NOT_ALLOWED' using errcode = '42501';\n  end if;\n\n  update public.deals d\n     set status = p_status,\n         row_version = d.row_version + 1,\n         updated_at = now()\n   where d.id = p_deal_id\n     and d.tenant_id = public.current_tenant_id()\n     and d.row_version = p_expected_row_version\n  returning d.id, d.row_version into v_id, v_row_version;\n\n  if v_id is null then\n    raise exception 'CONFLICT_OR_NOT_FOUND' using errcode = '40900';\n  end if;\n\n  id := v_id;\n  row_version := v_row_version;\n  return next;\nend\n$function$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.update_deal_status_rpc(uuid, integer, text) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.update_deal_status_rpc(uuid, integer, text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126152107"},{"text":"update_deal_status_rpc_fix"},{"binary":"0000000100000000000000190000000300000001000003f92d2d20456e7375726520506f737467524553542063616e2066696e643a207075626c69632e7570646174655f6465616c5f7374617475735f72706328705f6465616c5f69642c20705f65787065637465645f726f775f76657273696f6e2c20705f737461747573290a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f727063280a2020705f6465616c5f696420757569642c0a2020705f65787065637465645f726f775f76657273696f6e20696e74656765722c0a2020705f73746174757320746578740a290a72657475726e73207461626c6520280a2020696420757569642c0a2020726f775f76657273696f6e20696e74656765720a290a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a6173202466756e6374696f6e240a6465636c6172650a2020765f696420757569643b0a2020765f726f775f76657273696f6e20696e74656765723b0a626567696e0a20206966206e6f74207075626c69632e63616e5f77726974655f63757272656e745f74656e616e742829207468656e0a20202020726169736520657863657074696f6e202757524954455f4e4f545f414c4c4f57454427207573696e6720657272636f6465203d20273432353031273b0a2020656e642069663b0a0a2020757064617465207075626c69632e6465616c7320640a202020202073657420737461747573203d20705f7374617475732c0a202020202020202020726f775f76657273696f6e203d20642e726f775f76657273696f6e202b20312c0a202020202020202020757064617465645f6174203d206e6f7728290a202020776865726520642e6964203d20705f6465616c5f69640a2020202020616e6420642e74656e616e745f6964203d207075626c69632e63757272656e745f74656e616e745f696428290a2020202020616e6420642e726f775f76657273696f6e203d20705f65787065637465645f726f775f76657273696f6e0a202072657475726e696e6720642e69642c20642e726f775f76657273696f6e20696e746f20765f69642c20765f726f775f76657273696f6e3b0a0a2020696620765f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027434f4e464c4943545f4f525f4e4f545f464f554e4427207573696e6720657272636f6465203d20273430393030273b0a2020656e642069663b0a0a20206964203a3d20765f69643b0a2020726f775f76657273696f6e203a3d20765f726f775f76657273696f6e3b0a202072657475726e206e6578743b0a656e640a2466756e6374696f6e24000000557265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f72706328757569642c20696e74656765722c2074657874292066726f6d207075626c69630000005d6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7570646174655f6465616c5f7374617475735f72706328757569642c20696e74656765722c20746578742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126153900_debug_context_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- NO-OP\n-- Reason: debug RPC migration was corrupted; debug endpoints are not allowed to block deploy.\n-- Original preserved as .bak_noop\n\nselect 1","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126153900"},{"text":"debug_context_rpc"},{"binary":"0000000100000000000000190000000100000001000000942d2d204e4f2d4f500a2d2d20526561736f6e3a20646562756720525043206d6967726174696f6e2077617320636f727275707465643b20646562756720656e64706f696e747320617265206e6f7420616c6c6f77656420746f20626c6f636b206465706c6f792e0a2d2d204f726967696e616c20707265736572766564206173202e62616b5f6e6f6f700a0a73656c6563742031"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"RowDescription","Fields":[{"Name":"?column?","TableOID":0,"TableAttributeNumber":0,"DataTypeOID":23,"DataTypeSize":4,"TypeModifier":-1,"Format":0}]}
2026/01/28 15:06:13 PG Recv: {"Type":"DataRow","Values":[{"text":"1"}]}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"SELECT 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126182809_set_current_tenant_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- set_current_tenant RPC (stable; named dollar-tag)\ncreate or replace function public.set_current_tenant(p_tenant_id uuid)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $set_current_tenant$\ndeclare\n  v_user_id uuid;\n  v_ok boolean;\nbegin\n  v_user_id := public.current_user_id();\n\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED' using errcode = '28000';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.user_id = v_user_id\n      and tm.tenant_id = p_tenant_id\n  ) into v_ok;\n\n  if not v_ok then\n    raise exception 'NOT_MEMBER' using errcode = '42501';\n  end if;\n\n  insert into public.user_profiles (user_id, current_tenant_id)\n  values (v_user_id, p_tenant_id)\n  on conflict (user_id)\n  do update set current_tenant_id = excluded.current_tenant_id;\n\n  return p_tenant_id;\nend;\n$set_current_tenant$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_current_tenant(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_current_tenant(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126182809"},{"text":"set_current_tenant_rpc"},{"binary":"0000000100000000000000190000000300000001000003772d2d207365745f63757272656e745f74656e616e74205250432028737461626c653b206e616d656420646f6c6c61722d746167290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428705f74656e616e745f69642075756964290a72657475726e7320757569640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a617320247365745f63757272656e745f74656e616e74240a6465636c6172650a2020765f757365725f696420757569643b0a2020765f6f6b20626f6f6c65616e3b0a626567696e0a2020765f757365725f6964203a3d207075626c69632e63757272656e745f757365725f696428293b0a0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f524551554952454427207573696e6720657272636f6465203d20273238303030273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e757365725f6964203d20765f757365725f69640a202020202020616e6420746d2e74656e616e745f6964203d20705f74656e616e745f69640a20202920696e746f20765f6f6b3b0a0a20206966206e6f7420765f6f6b207468656e0a20202020726169736520657863657074696f6e20274e4f545f4d454d42455227207573696e6720657272636f6465203d20273432353031273b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e757365725f70726f66696c65732028757365725f69642c2063757272656e745f74656e616e745f6964290a202076616c7565732028765f757365725f69642c20705f74656e616e745f6964290a20206f6e20636f6e666c6963742028757365725f6964290a2020646f20757064617465207365742063757272656e745f74656e616e745f6964203d206578636c756465642e63757272656e745f74656e616e745f69643b0a0a202072657475726e20705f74656e616e745f69643b0a656e643b0a247365745f63757272656e745f74656e616e7424000000427265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e742875756964292066726f6d207075626c69630000004a6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126183616_set_current_tenant_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- set_current_tenant RPC (stable; named dollar-tag)\ncreate or replace function public.set_current_tenant(p_tenant_id uuid)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $set_current_tenant$\ndeclare\n  v_user_id uuid;\n  v_ok boolean;\nbegin\n  v_user_id := public.current_user_id();\n\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED' using errcode = '28000';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.user_id = v_user_id\n      and tm.tenant_id = p_tenant_id\n  ) into v_ok;\n\n  if not v_ok then\n    raise exception 'NOT_MEMBER' using errcode = '42501';\n  end if;\n\n  insert into public.user_profiles (user_id, current_tenant_id)\n  values (v_user_id, p_tenant_id)\n  on conflict (user_id)\n  do update set current_tenant_id = excluded.current_tenant_id;\n\n  return p_tenant_id;\nend;\n$set_current_tenant$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_current_tenant(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_current_tenant(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126183616"},{"text":"set_current_tenant_rpc"},{"binary":"0000000100000000000000190000000300000001000003772d2d207365745f63757272656e745f74656e616e74205250432028737461626c653b206e616d656420646f6c6c61722d746167290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428705f74656e616e745f69642075756964290a72657475726e7320757569640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a617320247365745f63757272656e745f74656e616e74240a6465636c6172650a2020765f757365725f696420757569643b0a2020765f6f6b20626f6f6c65616e3b0a626567696e0a2020765f757365725f6964203a3d207075626c69632e63757272656e745f757365725f696428293b0a0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f524551554952454427207573696e6720657272636f6465203d20273238303030273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e757365725f6964203d20765f757365725f69640a202020202020616e6420746d2e74656e616e745f6964203d20705f74656e616e745f69640a20202920696e746f20765f6f6b3b0a0a20206966206e6f7420765f6f6b207468656e0a20202020726169736520657863657074696f6e20274e4f545f4d454d42455227207573696e6720657272636f6465203d20273432353031273b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e757365725f70726f66696c65732028757365725f69642c2063757272656e745f74656e616e745f6964290a202076616c7565732028765f757365725f69642c20705f74656e616e745f6964290a20206f6e20636f6e666c6963742028757365725f6964290a2020646f20757064617465207365742063757272656e745f74656e616e745f6964203d206578636c756465642e63757272656e745f74656e616e745f69643b0a0a202072657475726e20705f74656e616e745f69643b0a656e643b0a247365745f63757272656e745f74656e616e7424000000427265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e742875756964292066726f6d207075626c69630000004a6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260126183642_set_current_tenant_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- set_current_tenant RPC (stable; named dollar-tag)\ncreate or replace function public.set_current_tenant(p_tenant_id uuid)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $set_current_tenant$\ndeclare\n  v_user_id uuid;\n  v_ok boolean;\nbegin\n  v_user_id := public.current_user_id();\n\n  if v_user_id is null then\n    raise exception 'AUTH_REQUIRED' using errcode = '28000';\n  end if;\n\n  select exists (\n    select 1\n    from public.tenant_memberships tm\n    where tm.user_id = v_user_id\n      and tm.tenant_id = p_tenant_id\n  ) into v_ok;\n\n  if not v_ok then\n    raise exception 'NOT_MEMBER' using errcode = '42501';\n  end if;\n\n  insert into public.user_profiles (user_id, current_tenant_id)\n  values (v_user_id, p_tenant_id)\n  on conflict (user_id)\n  do update set current_tenant_id = excluded.current_tenant_id;\n\n  return p_tenant_id;\nend;\n$set_current_tenant$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.set_current_tenant(uuid) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_current_tenant(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260126183642"},{"text":"set_current_tenant_rpc"},{"binary":"0000000100000000000000190000000300000001000003772d2d207365745f63757272656e745f74656e616e74205250432028737461626c653b206e616d656420646f6c6c61722d746167290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428705f74656e616e745f69642075756964290a72657475726e7320757569640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a617320247365745f63757272656e745f74656e616e74240a6465636c6172650a2020765f757365725f696420757569643b0a2020765f6f6b20626f6f6c65616e3b0a626567696e0a2020765f757365725f6964203a3d207075626c69632e63757272656e745f757365725f696428293b0a0a2020696620765f757365725f6964206973206e756c6c207468656e0a20202020726169736520657863657074696f6e2027415554485f524551554952454427207573696e6720657272636f6465203d20273238303030273b0a2020656e642069663b0a0a202073656c6563742065786973747320280a2020202073656c65637420310a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0a20202020776865726520746d2e757365725f6964203d20765f757365725f69640a202020202020616e6420746d2e74656e616e745f6964203d20705f74656e616e745f69640a20202920696e746f20765f6f6b3b0a0a20206966206e6f7420765f6f6b207468656e0a20202020726169736520657863657074696f6e20274e4f545f4d454d42455227207573696e6720657272636f6465203d20273432353031273b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e757365725f70726f66696c65732028757365725f69642c2063757272656e745f74656e616e745f6964290a202076616c7565732028765f757365725f69642c20705f74656e616e745f6964290a20206f6e20636f6e666c6963742028757365725f6964290a2020646f20757064617465207365742063757272656e745f74656e616e745f6964203d206578636c756465642e63757272656e745f74656e616e745f69643b0a0a202072657475726e20705f74656e616e745f69643b0a656e643b0a247365745f63757272656e745f74656e616e7424000000427265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e742875756964292066726f6d207075626c69630000004a6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e7428757569642920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260127133044_tenant_resolution_lock.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- tenant resolution lock: profile -\u003e dev override -\u003e jwt(optional) -\u003e null\n-- rules:\n-- - current_tenant_id() is pure/stable (no writes)\n-- - mismatch is non-breaking: prefer profile, flag mismatch; no exceptions\n-- - if resolved tenant is null, RLS should deny by design\n\n-- 1) ensure a minimal log table exists (side effects are only in log_tenant_mismatch)\ncreate table if not exists public.tenant_mismatch_log (\n  id uuid primary key default gen_random_uuid(),\n  occurred_at timestamptz not null default now(),\n  user_id uuid not null,\n  profile_tenant_id uuid null,\n  jwt_tenant_id uuid null,\n  context jsonb not null default '{}'::jsonb\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.tenant_mismatch_log enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $plpgsql$\nbegin\n  if not exists (\n    select 1 from pg_policies\n    where schemaname='public' and tablename='tenant_mismatch_log' and policyname='tenant_mismatch_log_owner_read'\n  ) then\n    execute 'create policy tenant_mismatch_log_owner_read on public.tenant_mismatch_log\n             for select to authenticated\n             using (user_id = auth.uid())';\n  end if;\n\n  if not exists (\n    select 1 from pg_policies\n    where schemaname='public' and tablename='tenant_mismatch_log' and policyname='tenant_mismatch_log_owner_insert'\n  ) then\n    execute 'create policy tenant_mismatch_log_owner_insert on public.tenant_mismatch_log\n             for insert to authenticated\n             with check (user_id = auth.uid())';\n  end if;\nend\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 2) jwt-tenant enable toggle (default false)\ndrop function if exists public.jwt_tenant_enabled()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.jwt_tenant_enabled()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  select coalesce(\n    nullif(lower(current_setting('app.enable_jwt_tenant', true)),'') in ('1','true','t','yes','y','on'),\n    false\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 3) profile tenant lookup helper\ndrop function if exists public.profile_current_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.profile_current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select up.current_tenant_id\n  from public.user_profiles up\n  where up.user_id = auth.uid();\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 4) jwt tenant lookup helper (returns null unless enabled + valid uuid)\ndrop function if exists public.jwt_current_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.jwt_current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select case\n    when public.jwt_tenant_enabled() is distinct from true then null\n    else nullif(auth.jwt()-\u003e\u003e'tenant_id','')::uuid\n  end;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 5) dev/test override tenant lookup helper (GUC app.tenant_id)\ndrop function if exists public.dev_override_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.dev_override_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select nullif(current_setting('app.tenant_id', true),'')::uuid;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 6) canonical tenant resolver (PURE/STABLE): profile -\u003e dev override -\u003e jwt(optional) -\u003e null\ncreate or replace function public.current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select coalesce(\n    public.profile_current_tenant_id(),\n    public.dev_override_tenant_id(),\n    public.jwt_current_tenant_id()\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 7) mismatch detector (PURE): true if profile and jwt are both non-null and differ\ndrop function if exists public.tenant_id_mismatch()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.tenant_id_mismatch()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  with v as (\n    select\n      public.profile_current_tenant_id() as profile_tenant_id,\n      public.jwt_current_tenant_id()     as jwt_tenant_id\n  )\n  select\n    (v.profile_tenant_id is not null)\n    and (v.jwt_tenant_id is not null)\n    and (v.profile_tenant_id \u003c\u003e v.jwt_tenant_id)\n  from v;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 8) explicit logger (SIDE EFFECTS OK): callable from RPC entrypoints/middleware ONLY\ndrop function if exists public.log_tenant_mismatch(jsonb)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.log_tenant_mismatch(p_context jsonb default '{}'::jsonb)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $fn$\ndeclare\n  v_user_id uuid;\n  v_profile uuid;\n  v_jwt uuid;\nbegin\n  v_user_id := auth.uid();\n  if v_user_id is null then\n    return;\n  end if;\n\n  v_profile := public.profile_current_tenant_id();\n  v_jwt := public.jwt_current_tenant_id();\n\n  if v_profile is not null and v_jwt is not null and v_profile \u003c\u003e v_jwt then\n    insert into public.tenant_mismatch_log(user_id, profile_tenant_id, jwt_tenant_id, context)\n    values (v_user_id, v_profile, v_jwt, coalesce(p_context,'{}'::jsonb));\n  end if;\nend;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.log_tenant_mismatch(jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.log_tenant_mismatch(jsonb) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 9) update any helper(s) that should never rely on auth.jwt tenant directly\ncreate or replace function public.can_write_current_tenant()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  select public.tenant_write_allowed(public.current_tenant_id());\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 10) enforcement helper: detect drift (policies/functions using jwt tenant_id directly)\ndrop function if exists public.find_jwt_tenant_refs()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.find_jwt_tenant_refs()\nreturns table(kind text, schema_name text, object_name text, detail text)\nlanguage sql\nstable\nas $fn$\n  (\n    select\n      'policy'::text as kind,\n      p.schemaname as schema_name,\n      (p.tablename || '.' || p.policyname) as object_name,\n      coalesce(p.qual,'') || ' | ' || coalesce(p.with_check,'') as detail\n    from pg_policies p\n    where\n      (coalesce(p.qual,'') ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n       or coalesce(p.with_check,'') ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n       or coalesce(p.qual,'') ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%'\n       or coalesce(p.with_check,'') ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%')\n  )\n  union all\n  (\n    select\n      'function'::text as kind,\n      n.nspname as schema_name,\n      p.proname as object_name,\n      pg_get_functiondef(p.oid) as detail\n    from pg_proc p\n    join pg_namespace n on n.oid = p.pronamespace\n    where n.nspname = 'public'\n      and (pg_get_functiondef(p.oid) ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n           or pg_get_functiondef(p.oid) ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%')\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.assert_no_jwt_tenant_refs()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.assert_no_jwt_tenant_refs()\nreturns void\nlanguage plpgsql\nstable\nas $fn$\ndeclare\n  v_cnt int;\nbegin\n  select count(*) into v_cnt from public.find_jwt_tenant_refs();\n  if v_cnt \u003e 0 then\n    raise exception using\n      message = 'JWT tenant_id references found in policies/functions. Replace with public.current_tenant_id(). Run: select * from public.find_jwt_tenant_refs();';\n  end if;\nend;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260127133044"},{"text":"tenant_resolution_lock"},{"binary":"0000000100000000000000190000001700000001000002852d2d2074656e616e74207265736f6c7574696f6e206c6f636b3a2070726f66696c65202d3e20646576206f76657272696465202d3e206a7774286f7074696f6e616c29202d3e206e756c6c0a2d2d2072756c65733a0a2d2d202d2063757272656e745f74656e616e745f6964282920697320707572652f737461626c6520286e6f20777269746573290a2d2d202d206d69736d61746368206973206e6f6e2d627265616b696e673a207072656665722070726f66696c652c20666c6167206d69736d617463683b206e6f20657863657074696f6e730a2d2d202d206966207265736f6c7665642074656e616e74206973206e756c6c2c20524c532073686f756c642064656e792062792064657369676e0a0a2d2d20312920656e737572652061206d696e696d616c206c6f67207461626c6520657869737473202873696465206566666563747320617265206f6e6c7920696e206c6f675f74656e616e745f6d69736d61746368290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e745f6d69736d617463685f6c6f6720280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a20206f636375727265645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757365725f69642075756964206e6f74206e756c6c2c0a202070726f66696c655f74656e616e745f69642075756964206e756c6c2c0a20206a77745f74656e616e745f69642075756964206e756c6c2c0a2020636f6e74657874206a736f6e62206e6f74206e756c6c2064656661756c7420277b7d273a3a6a736f6e620a2900000040616c746572207461626c65207075626c69632e74656e616e745f6d69736d617463685f6c6f6720656e61626c6520726f77206c6576656c207365637572697479000002ee646f2024706c706773716c240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420312066726f6d2070675f706f6c69636965730a20202020776865726520736368656d616e616d653d277075626c69632720616e64207461626c656e616d653d2774656e616e745f6d69736d617463685f6c6f672720616e6420706f6c6963796e616d653d2774656e616e745f6d69736d617463685f6c6f675f6f776e65725f72656164270a202029207468656e0a2020202065786563757465202763726561746520706f6c6963792074656e616e745f6d69736d617463685f6c6f675f6f776e65725f72656164206f6e207075626c69632e74656e616e745f6d69736d617463685f6c6f670a20202020202020202020202020666f722073656c65637420746f2061757468656e746963617465640a202020202020202020202020207573696e672028757365725f6964203d20617574682e756964282929273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420312066726f6d2070675f706f6c69636965730a20202020776865726520736368656d616e616d653d277075626c69632720616e64207461626c656e616d653d2774656e616e745f6d69736d617463685f6c6f672720616e6420706f6c6963796e616d653d2774656e616e745f6d69736d617463685f6c6f675f6f776e65725f696e73657274270a202029207468656e0a2020202065786563757465202763726561746520706f6c6963792074656e616e745f6d69736d617463685f6c6f675f6f776e65725f696e73657274206f6e207075626c69632e74656e616e745f6d69736d617463685f6c6f670a20202020202020202020202020666f7220696e7365727420746f2061757468656e746963617465640a202020202020202020202020207769746820636865636b2028757365725f6964203d20617574682e756964282929273b0a2020656e642069663b0a656e640a24706c706773716c24000000622d2d203229206a77742d74656e616e7420656e61626c6520746f67676c65202864656661756c742066616c7365290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6a77745f74656e616e745f656e61626c65642829000000e76372656174652066756e6374696f6e207075626c69632e6a77745f74656e616e745f656e61626c656428290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636f616c65736365280a202020206e756c6c6966286c6f7765722863757272656e745f73657474696e6728276170702e656e61626c655f6a77745f74656e616e74272c207472756529292c27272920696e20282731272c2774727565272c2774272c27796573272c2779272c276f6e27292c0a2020202066616c73650a2020293b0a24666e240000005d2d2d2033292070726f66696c652074656e616e74206c6f6f6b75702068656c7065720a64726f702066756e6374696f6e20696620657869737473207075626c69632e70726f66696c655f63757272656e745f74656e616e745f69642829000000be6372656174652066756e6374696f6e207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c6563742075702e63757272656e745f74656e616e745f69640a202066726f6d207075626c69632e757365725f70726f66696c65732075700a202077686572652075702e757365725f6964203d20617574682e75696428293b0a24666e24000000802d2d203429206a77742074656e616e74206c6f6f6b75702068656c706572202872657475726e73206e756c6c20756e6c65737320656e61626c6564202b2076616c69642075756964290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6a77745f63757272656e745f74656e616e745f69642829000000e96372656174652066756e6374696f6e207075626c69632e6a77745f63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636173650a202020207768656e207075626c69632e6a77745f74656e616e745f656e61626c656428292069732064697374696e63742066726f6d2074727565207468656e206e756c6c0a20202020656c7365206e756c6c696628617574682e6a777428292d3e3e2774656e616e745f6964272c2727293a3a757569640a2020656e643b0a24666e24000000782d2d203529206465762f74657374206f766572726964652074656e616e74206c6f6f6b75702068656c7065722028475543206170702e74656e616e745f6964290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6465765f6f766572726964655f74656e616e745f696428290000009f6372656174652066756e6374696f6e207075626c69632e6465765f6f766572726964655f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c656374206e756c6c69662863757272656e745f73657474696e6728276170702e74656e616e745f6964272c2074727565292c2727293a3a757569643b0a24666e240000014b2d2d2036292063616e6f6e6963616c2074656e616e74207265736f6c7665722028505552452f535441424c45293a2070726f66696c65202d3e20646576206f76657272696465202d3e206a7774286f7074696f6e616c29202d3e206e756c6c0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636f616c65736365280a202020207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428292c0a202020207075626c69632e6465765f6f766572726964655f74656e616e745f696428292c0a202020207075626c69632e6a77745f63757272656e745f74656e616e745f696428290a2020293b0a24666e24000000882d2d203729206d69736d61746368206465746563746f72202850555245293a20747275652069662070726f66696c6520616e64206a77742061726520626f7468206e6f6e2d6e756c6c20616e64206469666665720a64726f702066756e6374696f6e20696620657869737473207075626c69632e74656e616e745f69645f6d69736d617463682829000001826372656174652066756e6374696f6e207075626c69632e74656e616e745f69645f6d69736d6174636828290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202077697468207620617320280a2020202073656c6563740a2020202020207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428292061732070726f66696c655f74656e616e745f69642c0a2020202020207075626c69632e6a77745f63757272656e745f74656e616e745f6964282920202020206173206a77745f74656e616e745f69640a2020290a202073656c6563740a2020202028762e70726f66696c655f74656e616e745f6964206973206e6f74206e756c6c290a20202020616e642028762e6a77745f74656e616e745f6964206973206e6f74206e756c6c290a20202020616e642028762e70726f66696c655f74656e616e745f6964203c3e20762e6a77745f74656e616e745f6964290a202066726f6d20763b0a24666e24000000902d2d203829206578706c69636974206c6f676765722028534944452045464645435453204f4b293a2063616c6c61626c652066726f6d2052504320656e747279706f696e74732f6d6964646c6577617265204f4e4c590a64726f702066756e6374696f6e20696620657869737473207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e6229000002976372656174652066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d6174636828705f636f6e74657874206a736f6e622064656661756c7420277b7d273a3a6a736f6e62290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a61732024666e240a6465636c6172650a2020765f757365725f696420757569643b0a2020765f70726f66696c6520757569643b0a2020765f6a777420757569643b0a626567696e0a2020765f757365725f6964203a3d20617574682e75696428293b0a2020696620765f757365725f6964206973206e756c6c207468656e0a2020202072657475726e3b0a2020656e642069663b0a0a2020765f70726f66696c65203a3d207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428293b0a2020765f6a7774203a3d207075626c69632e6a77745f63757272656e745f74656e616e745f696428293b0a0a2020696620765f70726f66696c65206973206e6f74206e756c6c20616e6420765f6a7774206973206e6f74206e756c6c20616e6420765f70726f66696c65203c3e20765f6a7774207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d69736d617463685f6c6f6728757365725f69642c2070726f66696c655f74656e616e745f69642c206a77745f74656e616e745f69642c20636f6e74657874290a2020202076616c7565732028765f757365725f69642c20765f70726f66696c652c20765f6a77742c20636f616c6573636528705f636f6e746578742c277b7d273a3a6a736f6e6229293b0a2020656e642069663b0a656e643b0a24666e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e62292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e622920746f2061757468656e74696361746564000000fd2d2d2039292075706461746520616e792068656c70657228732920746861742073686f756c64206e657665722072656c79206f6e20617574682e6a77742074656e616e74206469726563746c790a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63616e5f77726974655f63757272656e745f74656e616e7428290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c656374207075626c69632e74656e616e745f77726974655f616c6c6f776564287075626c69632e63757272656e745f74656e616e745f69642829293b0a24666e240000008f2d2d2031302920656e666f7263656d656e742068656c7065723a206465746563742064726966742028706f6c69636965732f66756e6374696f6e73207573696e67206a77742074656e616e745f6964206469726563746c79290a64726f702066756e6374696f6e20696620657869737473207075626c69632e66696e645f6a77745f74656e616e745f726566732829000004546372656174652066756e6374696f6e207075626c69632e66696e645f6a77745f74656e616e745f7265667328290a72657475726e73207461626c65286b696e6420746578742c20736368656d615f6e616d6520746578742c206f626a6563745f6e616d6520746578742c2064657461696c2074657874290a6c616e67756167652073716c0a737461626c650a61732024666e240a2020280a2020202073656c6563740a20202020202027706f6c696379273a3a74657874206173206b696e642c0a202020202020702e736368656d616e616d6520617320736368656d615f6e616d652c0a20202020202028702e7461626c656e616d65207c7c20272e27207c7c20702e706f6c6963796e616d6529206173206f626a6563745f6e616d652c0a202020202020636f616c6573636528702e7175616c2c272729207c7c2027207c2027207c7c20636f616c6573636528702e776974685f636865636b2c2727292061732064657461696c0a2020202066726f6d2070675f706f6c696369657320700a2020202077686572650a20202020202028636f616c6573636528702e7175616c2c27272920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e776974685f636865636b2c27272920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e7175616c2c27272920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e776974685f636865636b2c27272920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f696427272527290a2020290a2020756e696f6e20616c6c0a2020280a2020202073656c6563740a2020202020202766756e6374696f6e273a3a74657874206173206b696e642c0a2020202020206e2e6e73706e616d6520617320736368656d615f6e616d652c0a202020202020702e70726f6e616d65206173206f626a6563745f6e616d652c0a20202020202070675f6765745f66756e6374696f6e64656628702e6f6964292061732064657461696c0a2020202066726f6d2070675f70726f6320700a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20702e70726f6e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c6963270a202020202020616e64202870675f6765745f66756e6374696f6e64656628702e6f69642920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a20202020202020202020206f722070675f6765745f66756e6374696f6e64656628702e6f69642920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f696427272527290a2020293b0a24666e240000003a64726f702066756e6374696f6e20696620657869737473207075626c69632e6173736572745f6e6f5f6a77745f74656e616e745f726566732829000001a16372656174652066756e6374696f6e207075626c69632e6173736572745f6e6f5f6a77745f74656e616e745f7265667328290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a737461626c650a61732024666e240a6465636c6172650a2020765f636e7420696e743b0a626567696e0a202073656c65637420636f756e74282a2920696e746f20765f636e742066726f6d207075626c69632e66696e645f6a77745f74656e616e745f7265667328293b0a2020696620765f636e74203e2030207468656e0a20202020726169736520657863657074696f6e207573696e670a2020202020206d657373616765203d20274a57542074656e616e745f6964207265666572656e63657320666f756e6420696e20706f6c69636965732f66756e6374696f6e732e205265706c6163652077697468207075626c69632e63757272656e745f74656e616e745f696428292e2052756e3a2073656c656374202a2066726f6d207075626c69632e66696e645f6a77745f74656e616e745f7265667328293b273b0a2020656e642069663b0a656e643b0a24666e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.jwt_tenant_enabled() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.jwt_tenant_enabled() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.profile_current_tenant_id() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.profile_current_tenant_id() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.jwt_current_tenant_id() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.jwt_current_tenant_id() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.dev_override_tenant_id() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.dev_override_tenant_id() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.tenant_id_mismatch() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.tenant_id_mismatch() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.log_tenant_mismatch(jsonb) does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.log_tenant_mismatch(jsonb) does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.find_jwt_tenant_refs() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.find_jwt_tenant_refs() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"00000","Message":"function public.assert_no_jwt_tenant_refs() does not exist, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"dropcmds.c","Line":523,"Routine":"does_not_exist_skipping","UnknownFields":null}
NOTICE (00000): function public.assert_no_jwt_tenant_refs() does not exist, skipping
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260127133101_tenant_resolution_lock.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- tenant resolution lock: profile -\u003e dev override -\u003e jwt(optional) -\u003e null\n-- rules:\n-- - current_tenant_id() is pure/stable (no writes)\n-- - mismatch is non-breaking: prefer profile, flag mismatch; no exceptions\n-- - if resolved tenant is null, RLS should deny by design\n\n-- 1) ensure a minimal log table exists (side effects are only in log_tenant_mismatch)\ncreate table if not exists public.tenant_mismatch_log (\n  id uuid primary key default gen_random_uuid(),\n  occurred_at timestamptz not null default now(),\n  user_id uuid not null,\n  profile_tenant_id uuid null,\n  jwt_tenant_id uuid null,\n  context jsonb not null default '{}'::jsonb\n)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"alter table public.tenant_mismatch_log enable row level security","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"do $plpgsql$\nbegin\n  if not exists (\n    select 1 from pg_policies\n    where schemaname='public' and tablename='tenant_mismatch_log' and policyname='tenant_mismatch_log_owner_read'\n  ) then\n    execute 'create policy tenant_mismatch_log_owner_read on public.tenant_mismatch_log\n             for select to authenticated\n             using (user_id = auth.uid())';\n  end if;\n\n  if not exists (\n    select 1 from pg_policies\n    where schemaname='public' and tablename='tenant_mismatch_log' and policyname='tenant_mismatch_log_owner_insert'\n  ) then\n    execute 'create policy tenant_mismatch_log_owner_insert on public.tenant_mismatch_log\n             for insert to authenticated\n             with check (user_id = auth.uid())';\n  end if;\nend\n$plpgsql$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 2) jwt-tenant enable toggle (default false)\ndrop function if exists public.jwt_tenant_enabled()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.jwt_tenant_enabled()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  select coalesce(\n    nullif(lower(current_setting('app.enable_jwt_tenant', true)),'') in ('1','true','t','yes','y','on'),\n    false\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 3) profile tenant lookup helper\ndrop function if exists public.profile_current_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.profile_current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select up.current_tenant_id\n  from public.user_profiles up\n  where up.user_id = auth.uid();\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 4) jwt tenant lookup helper (returns null unless enabled + valid uuid)\ndrop function if exists public.jwt_current_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.jwt_current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select case\n    when public.jwt_tenant_enabled() is distinct from true then null\n    else nullif(auth.jwt()-\u003e\u003e'tenant_id','')::uuid\n  end;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 5) dev/test override tenant lookup helper (GUC app.tenant_id)\ndrop function if exists public.dev_override_tenant_id()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.dev_override_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select nullif(current_setting('app.tenant_id', true),'')::uuid;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 6) canonical tenant resolver (PURE/STABLE): profile -\u003e dev override -\u003e jwt(optional) -\u003e null\ncreate or replace function public.current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas $fn$\n  select coalesce(\n    public.profile_current_tenant_id(),\n    public.dev_override_tenant_id(),\n    public.jwt_current_tenant_id()\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 7) mismatch detector (PURE): true if profile and jwt are both non-null and differ\ndrop function if exists public.tenant_id_mismatch()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.tenant_id_mismatch()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  with v as (\n    select\n      public.profile_current_tenant_id() as profile_tenant_id,\n      public.jwt_current_tenant_id()     as jwt_tenant_id\n  )\n  select\n    (v.profile_tenant_id is not null)\n    and (v.jwt_tenant_id is not null)\n    and (v.profile_tenant_id \u003c\u003e v.jwt_tenant_id)\n  from v;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Recv: {"Severity":"NOTICE","SeverityUnlocalized":"NOTICE","Code":"42P07","Message":"relation \"tenant_mismatch_log\" already exists, skipping","Detail":"","Hint":"","Position":0,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"parse_utilcmd.c","Line":207,"Routine":"transformCreateStmt","UnknownFields":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
NOTICE (42P07): relation "tenant_mismatch_log" already exists, skipping
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 8) explicit logger (SIDE EFFECTS OK): callable from RPC entrypoints/middleware ONLY\ndrop function if exists public.log_tenant_mismatch(jsonb)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.log_tenant_mismatch(p_context jsonb default '{}'::jsonb)\nreturns void\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $fn$\ndeclare\n  v_user_id uuid;\n  v_profile uuid;\n  v_jwt uuid;\nbegin\n  v_user_id := auth.uid();\n  if v_user_id is null then\n    return;\n  end if;\n\n  v_profile := public.profile_current_tenant_id();\n  v_jwt := public.jwt_current_tenant_id();\n\n  if v_profile is not null and v_jwt is not null and v_profile \u003c\u003e v_jwt then\n    insert into public.tenant_mismatch_log(user_id, profile_tenant_id, jwt_tenant_id, context)\n    values (v_user_id, v_profile, v_jwt, coalesce(p_context,'{}'::jsonb));\n  end if;\nend;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"revoke all on function public.log_tenant_mismatch(jsonb) from public","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.log_tenant_mismatch(jsonb) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 9) update any helper(s) that should never rely on auth.jwt tenant directly\ncreate or replace function public.can_write_current_tenant()\nreturns boolean\nlanguage sql\nstable\nas $fn$\n  select public.tenant_write_allowed(public.current_tenant_id());\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- 10) enforcement helper: detect drift (policies/functions using jwt tenant_id directly)\ndrop function if exists public.find_jwt_tenant_refs()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.find_jwt_tenant_refs()\nreturns table(kind text, schema_name text, object_name text, detail text)\nlanguage sql\nstable\nas $fn$\n  (\n    select\n      'policy'::text as kind,\n      p.schemaname as schema_name,\n      (p.tablename || '.' || p.policyname) as object_name,\n      coalesce(p.qual,'') || ' | ' || coalesce(p.with_check,'') as detail\n    from pg_policies p\n    where\n      (coalesce(p.qual,'') ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n       or coalesce(p.with_check,'') ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n       or coalesce(p.qual,'') ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%'\n       or coalesce(p.with_check,'') ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%')\n  )\n  union all\n  (\n    select\n      'function'::text as kind,\n      n.nspname as schema_name,\n      p.proname as object_name,\n      pg_get_functiondef(p.oid) as detail\n    from pg_proc p\n    join pg_namespace n on n.oid = p.pronamespace\n    where n.nspname = 'public'\n      and (pg_get_functiondef(p.oid) ilike '%auth.jwt()-\u003e\u003e''tenant_id''%'\n           or pg_get_functiondef(p.oid) ilike '%auth.jwt() -\u003e\u003e ''tenant_id''%')\n  );\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"drop function if exists public.assert_no_jwt_tenant_refs()","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create function public.assert_no_jwt_tenant_refs()\nreturns void\nlanguage plpgsql\nstable\nas $fn$\ndeclare\n  v_cnt int;\nbegin\n  select count(*) into v_cnt from public.find_jwt_tenant_refs();\n  if v_cnt \u003e 0 then\n    raise exception using\n      message = 'JWT tenant_id references found in policies/functions. Replace with public.current_tenant_id(). Run: select * from public.find_jwt_tenant_refs();';\n  end if;\nend;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260127133101"},{"text":"tenant_resolution_lock"},{"binary":"0000000100000000000000190000001700000001000002852d2d2074656e616e74207265736f6c7574696f6e206c6f636b3a2070726f66696c65202d3e20646576206f76657272696465202d3e206a7774286f7074696f6e616c29202d3e206e756c6c0a2d2d2072756c65733a0a2d2d202d2063757272656e745f74656e616e745f6964282920697320707572652f737461626c6520286e6f20777269746573290a2d2d202d206d69736d61746368206973206e6f6e2d627265616b696e673a207072656665722070726f66696c652c20666c6167206d69736d617463683b206e6f20657863657074696f6e730a2d2d202d206966207265736f6c7665642074656e616e74206973206e756c6c2c20524c532073686f756c642064656e792062792064657369676e0a0a2d2d20312920656e737572652061206d696e696d616c206c6f67207461626c6520657869737473202873696465206566666563747320617265206f6e6c7920696e206c6f675f74656e616e745f6d69736d61746368290a637265617465207461626c65206966206e6f7420657869737473207075626c69632e74656e616e745f6d69736d617463685f6c6f6720280a202069642075756964207072696d617279206b65792064656661756c742067656e5f72616e646f6d5f7575696428292c0a20206f636375727265645f61742074696d657374616d70747a206e6f74206e756c6c2064656661756c74206e6f7728292c0a2020757365725f69642075756964206e6f74206e756c6c2c0a202070726f66696c655f74656e616e745f69642075756964206e756c6c2c0a20206a77745f74656e616e745f69642075756964206e756c6c2c0a2020636f6e74657874206a736f6e62206e6f74206e756c6c2064656661756c7420277b7d273a3a6a736f6e620a2900000040616c746572207461626c65207075626c69632e74656e616e745f6d69736d617463685f6c6f6720656e61626c6520726f77206c6576656c207365637572697479000002ee646f2024706c706773716c240a626567696e0a20206966206e6f742065786973747320280a2020202073656c65637420312066726f6d2070675f706f6c69636965730a20202020776865726520736368656d616e616d653d277075626c69632720616e64207461626c656e616d653d2774656e616e745f6d69736d617463685f6c6f672720616e6420706f6c6963796e616d653d2774656e616e745f6d69736d617463685f6c6f675f6f776e65725f72656164270a202029207468656e0a2020202065786563757465202763726561746520706f6c6963792074656e616e745f6d69736d617463685f6c6f675f6f776e65725f72656164206f6e207075626c69632e74656e616e745f6d69736d617463685f6c6f670a20202020202020202020202020666f722073656c65637420746f2061757468656e746963617465640a202020202020202020202020207573696e672028757365725f6964203d20617574682e756964282929273b0a2020656e642069663b0a0a20206966206e6f742065786973747320280a2020202073656c65637420312066726f6d2070675f706f6c69636965730a20202020776865726520736368656d616e616d653d277075626c69632720616e64207461626c656e616d653d2774656e616e745f6d69736d617463685f6c6f672720616e6420706f6c6963796e616d653d2774656e616e745f6d69736d617463685f6c6f675f6f776e65725f696e73657274270a202029207468656e0a2020202065786563757465202763726561746520706f6c6963792074656e616e745f6d69736d617463685f6c6f675f6f776e65725f696e73657274206f6e207075626c69632e74656e616e745f6d69736d617463685f6c6f670a20202020202020202020202020666f7220696e7365727420746f2061757468656e746963617465640a202020202020202020202020207769746820636865636b2028757365725f6964203d20617574682e756964282929273b0a2020656e642069663b0a656e640a24706c706773716c24000000622d2d203229206a77742d74656e616e7420656e61626c6520746f67676c65202864656661756c742066616c7365290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6a77745f74656e616e745f656e61626c65642829000000e76372656174652066756e6374696f6e207075626c69632e6a77745f74656e616e745f656e61626c656428290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636f616c65736365280a202020206e756c6c6966286c6f7765722863757272656e745f73657474696e6728276170702e656e61626c655f6a77745f74656e616e74272c207472756529292c27272920696e20282731272c2774727565272c2774272c27796573272c2779272c276f6e27292c0a2020202066616c73650a2020293b0a24666e240000005d2d2d2033292070726f66696c652074656e616e74206c6f6f6b75702068656c7065720a64726f702066756e6374696f6e20696620657869737473207075626c69632e70726f66696c655f63757272656e745f74656e616e745f69642829000000be6372656174652066756e6374696f6e207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c6563742075702e63757272656e745f74656e616e745f69640a202066726f6d207075626c69632e757365725f70726f66696c65732075700a202077686572652075702e757365725f6964203d20617574682e75696428293b0a24666e24000000802d2d203429206a77742074656e616e74206c6f6f6b75702068656c706572202872657475726e73206e756c6c20756e6c65737320656e61626c6564202b2076616c69642075756964290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6a77745f63757272656e745f74656e616e745f69642829000000e96372656174652066756e6374696f6e207075626c69632e6a77745f63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636173650a202020207768656e207075626c69632e6a77745f74656e616e745f656e61626c656428292069732064697374696e63742066726f6d2074727565207468656e206e756c6c0a20202020656c7365206e756c6c696628617574682e6a777428292d3e3e2774656e616e745f6964272c2727293a3a757569640a2020656e643b0a24666e24000000782d2d203529206465762f74657374206f766572726964652074656e616e74206c6f6f6b75702068656c7065722028475543206170702e74656e616e745f6964290a64726f702066756e6374696f6e20696620657869737473207075626c69632e6465765f6f766572726964655f74656e616e745f696428290000009f6372656174652066756e6374696f6e207075626c69632e6465765f6f766572726964655f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c656374206e756c6c69662863757272656e745f73657474696e6728276170702e74656e616e745f6964272c2074727565292c2727293a3a757569643b0a24666e240000014b2d2d2036292063616e6f6e6963616c2074656e616e74207265736f6c7665722028505552452f535441424c45293a2070726f66696c65202d3e20646576206f76657272696465202d3e206a7774286f7074696f6e616c29202d3e206e756c6c0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c65637420636f616c65736365280a202020207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428292c0a202020207075626c69632e6465765f6f766572726964655f74656e616e745f696428292c0a202020207075626c69632e6a77745f63757272656e745f74656e616e745f696428290a2020293b0a24666e24000000882d2d203729206d69736d61746368206465746563746f72202850555245293a20747275652069662070726f66696c6520616e64206a77742061726520626f7468206e6f6e2d6e756c6c20616e64206469666665720a64726f702066756e6374696f6e20696620657869737473207075626c69632e74656e616e745f69645f6d69736d617463682829000001826372656174652066756e6374696f6e207075626c69632e74656e616e745f69645f6d69736d6174636828290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202077697468207620617320280a2020202073656c6563740a2020202020207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428292061732070726f66696c655f74656e616e745f69642c0a2020202020207075626c69632e6a77745f63757272656e745f74656e616e745f6964282920202020206173206a77745f74656e616e745f69640a2020290a202073656c6563740a2020202028762e70726f66696c655f74656e616e745f6964206973206e6f74206e756c6c290a20202020616e642028762e6a77745f74656e616e745f6964206973206e6f74206e756c6c290a20202020616e642028762e70726f66696c655f74656e616e745f6964203c3e20762e6a77745f74656e616e745f6964290a202066726f6d20763b0a24666e24000000902d2d203829206578706c69636974206c6f676765722028534944452045464645435453204f4b293a2063616c6c61626c652066726f6d2052504320656e747279706f696e74732f6d6964646c6577617265204f4e4c590a64726f702066756e6374696f6e20696620657869737473207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e6229000002976372656174652066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d6174636828705f636f6e74657874206a736f6e622064656661756c7420277b7d273a3a6a736f6e62290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a61732024666e240a6465636c6172650a2020765f757365725f696420757569643b0a2020765f70726f66696c6520757569643b0a2020765f6a777420757569643b0a626567696e0a2020765f757365725f6964203a3d20617574682e75696428293b0a2020696620765f757365725f6964206973206e756c6c207468656e0a2020202072657475726e3b0a2020656e642069663b0a0a2020765f70726f66696c65203a3d207075626c69632e70726f66696c655f63757272656e745f74656e616e745f696428293b0a2020765f6a7774203a3d207075626c69632e6a77745f63757272656e745f74656e616e745f696428293b0a0a2020696620765f70726f66696c65206973206e6f74206e756c6c20616e6420765f6a7774206973206e6f74206e756c6c20616e6420765f70726f66696c65203c3e20765f6a7774207468656e0a20202020696e7365727420696e746f207075626c69632e74656e616e745f6d69736d617463685f6c6f6728757365725f69642c2070726f66696c655f74656e616e745f69642c206a77745f74656e616e745f69642c20636f6e74657874290a2020202076616c7565732028765f757365725f69642c20765f70726f66696c652c20765f6a77742c20636f616c6573636528705f636f6e746578742c277b7d273a3a6a736f6e6229293b0a2020656e642069663b0a656e643b0a24666e24000000447265766f6b6520616c6c206f6e2066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e62292066726f6d207075626c69630000004c6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6c6f675f74656e616e745f6d69736d61746368286a736f6e622920746f2061757468656e74696361746564000000fd2d2d2039292075706461746520616e792068656c70657228732920746861742073686f756c64206e657665722072656c79206f6e20617574682e6a77742074656e616e74206469726563746c790a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63616e5f77726974655f63757272656e745f74656e616e7428290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a61732024666e240a202073656c656374207075626c69632e74656e616e745f77726974655f616c6c6f776564287075626c69632e63757272656e745f74656e616e745f69642829293b0a24666e240000008f2d2d2031302920656e666f7263656d656e742068656c7065723a206465746563742064726966742028706f6c69636965732f66756e6374696f6e73207573696e67206a77742074656e616e745f6964206469726563746c79290a64726f702066756e6374696f6e20696620657869737473207075626c69632e66696e645f6a77745f74656e616e745f726566732829000004546372656174652066756e6374696f6e207075626c69632e66696e645f6a77745f74656e616e745f7265667328290a72657475726e73207461626c65286b696e6420746578742c20736368656d615f6e616d6520746578742c206f626a6563745f6e616d6520746578742c2064657461696c2074657874290a6c616e67756167652073716c0a737461626c650a61732024666e240a2020280a2020202073656c6563740a20202020202027706f6c696379273a3a74657874206173206b696e642c0a202020202020702e736368656d616e616d6520617320736368656d615f6e616d652c0a20202020202028702e7461626c656e616d65207c7c20272e27207c7c20702e706f6c6963796e616d6529206173206f626a6563745f6e616d652c0a202020202020636f616c6573636528702e7175616c2c272729207c7c2027207c2027207c7c20636f616c6573636528702e776974685f636865636b2c2727292061732064657461696c0a2020202066726f6d2070675f706f6c696369657320700a2020202077686572650a20202020202028636f616c6573636528702e7175616c2c27272920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e776974685f636865636b2c27272920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e7175616c2c27272920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f6964272725270a202020202020206f7220636f616c6573636528702e776974685f636865636b2c27272920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f696427272527290a2020290a2020756e696f6e20616c6c0a2020280a2020202073656c6563740a2020202020202766756e6374696f6e273a3a74657874206173206b696e642c0a2020202020206e2e6e73706e616d6520617320736368656d615f6e616d652c0a202020202020702e70726f6e616d65206173206f626a6563745f6e616d652c0a20202020202070675f6765745f66756e6374696f6e64656628702e6f6964292061732064657461696c0a2020202066726f6d2070675f70726f6320700a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20702e70726f6e616d6573706163650a202020207768657265206e2e6e73706e616d65203d20277075626c6963270a202020202020616e64202870675f6765745f66756e6374696f6e64656628702e6f69642920696c696b65202725617574682e6a777428292d3e3e272774656e616e745f6964272725270a20202020202020202020206f722070675f6765745f66756e6374696f6e64656628702e6f69642920696c696b65202725617574682e6a77742829202d3e3e20272774656e616e745f696427272527290a2020293b0a24666e240000003a64726f702066756e6374696f6e20696620657869737473207075626c69632e6173736572745f6e6f5f6a77745f74656e616e745f726566732829000001a16372656174652066756e6374696f6e207075626c69632e6173736572745f6e6f5f6a77745f74656e616e745f7265667328290a72657475726e7320766f69640a6c616e677561676520706c706773716c0a737461626c650a61732024666e240a6465636c6172650a2020765f636e7420696e743b0a626567696e0a202073656c65637420636f756e74282a2920696e746f20765f636e742066726f6d207075626c69632e66696e645f6a77745f74656e616e745f7265667328293b0a2020696620765f636e74203e2030207468656e0a20202020726169736520657863657074696f6e207573696e670a2020202020206d657373616765203d20274a57542074656e616e745f6964207265666572656e63657320666f756e6420696e20706f6c69636965732f66756e6374696f6e732e205265706c6163652077697468207075626c69632e63757272656e745f74656e616e745f696428292e2052756e3a2073656c656374202a2066726f6d207075626c69632e66696e645f6a77745f74656e616e745f7265667328293b273b0a2020656e642069663b0a656e643b0a24666e24"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"ALTER TABLE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DO"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"REVOKE"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"DROP FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260128091834_tenant_resolution_lock.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- tenant-resolution lock (profile \u003e app.tenant_id override \u003e jwt claim \u003e null)\n\ncreate or replace function public.current_tenant_id()\nreturns uuid\nlanguage sql\nstable\nas '\n  select coalesce(\n    (select up.current_tenant_id\n       from public.user_profiles up\n      where up.user_id = auth.uid()\n    ),\n    (case\n       when current_setting(''app.tenant_id'', true) ~* ''^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$''\n       then current_setting(''app.tenant_id'', true)::uuid\n     end),\n    (case\n       when (coalesce(current_setting(''app.jwt_tenant_enabled'', true), '''') = ''true'')\n        and (auth.jwt()-\u003e\u003e''tenant_id'') ~* ''^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$''\n       then (auth.jwt()-\u003e\u003e''tenant_id'')::uuid\n     end)\n  );\n'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.current_tenant_mismatch()\nreturns boolean\nlanguage sql\nstable\nas '\n  select\n    (select up.current_tenant_id\n       from public.user_profiles up\n      where up.user_id = auth.uid()\n    ) is not null\n    and (coalesce(current_setting(''app.jwt_tenant_enabled'', true), '''') = ''true'')\n    and (auth.jwt()-\u003e\u003e''tenant_id'') ~* ''^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$''\n    and (select up.current_tenant_id\n           from public.user_profiles up\n          where up.user_id = auth.uid()\n        ) \u003c\u003e (auth.jwt()-\u003e\u003e''tenant_id'')::uuid;\n'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260128091834"},{"text":"tenant_resolution_lock"},{"binary":"0000000100000000000000190000000200000001000003242d2d2074656e616e742d7265736f6c7574696f6e206c6f636b202870726f66696c65203e206170702e74656e616e745f6964206f76657272696465203e206a777420636c61696d203e206e756c6c290a0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f696428290a72657475726e7320757569640a6c616e67756167652073716c0a737461626c650a617320270a202073656c65637420636f616c65736365280a202020202873656c6563742075702e63757272656e745f74656e616e745f69640a2020202020202066726f6d207075626c69632e757365725f70726f66696c65732075700a20202020202077686572652075702e757365725f6964203d20617574682e75696428290a20202020292c0a2020202028636173650a202020202020207768656e2063757272656e745f73657474696e672827276170702e74656e616e745f696427272c207472756529207e2a2027275e5b302d39612d665d7b387d2d5b302d39612d665d7b347d2d5b312d355d5b302d39612d665d7b337d2d5b383961625d5b302d39612d665d7b337d2d5b302d39612d665d7b31327d2427270a202020202020207468656e2063757272656e745f73657474696e672827276170702e74656e616e745f696427272c2074727565293a3a757569640a2020202020656e64292c0a2020202028636173650a202020202020207768656e2028636f616c657363652863757272656e745f73657474696e672827276170702e6a77745f74656e616e745f656e61626c656427272c2074727565292c202727272729203d202727747275652727290a2020202020202020616e642028617574682e6a777428292d3e3e272774656e616e745f6964272729207e2a2027275e5b302d39612d665d7b387d2d5b302d39612d665d7b347d2d5b312d355d5b302d39612d665d7b337d2d5b383961625d5b302d39612d665d7b337d2d5b302d39612d665d7b31327d2427270a202020202020207468656e2028617574682e6a777428292d3e3e272774656e616e745f69642727293a3a757569640a2020202020656e64290a2020293b0a270000025d637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e63757272656e745f74656e616e745f6d69736d6174636828290a72657475726e7320626f6f6c65616e0a6c616e67756167652073716c0a737461626c650a617320270a202073656c6563740a202020202873656c6563742075702e63757272656e745f74656e616e745f69640a2020202020202066726f6d207075626c69632e757365725f70726f66696c65732075700a20202020202077686572652075702e757365725f6964203d20617574682e75696428290a2020202029206973206e6f74206e756c6c0a20202020616e642028636f616c657363652863757272656e745f73657474696e672827276170702e6a77745f74656e616e745f656e61626c656427272c2074727565292c202727272729203d202727747275652727290a20202020616e642028617574682e6a777428292d3e3e272774656e616e745f6964272729207e2a2027275e5b302d39612d665d7b387d2d5b302d39612d665d7b347d2d5b312d355d5b302d39612d665d7b337d2d5b383961625d5b302d39612d665d7b337d2d5b302d39612d665d7b31327d2427270a20202020616e64202873656c6563742075702e63757272656e745f74656e616e745f69640a202020202020202020202066726f6d207075626c69632e757365725f70726f66696c65732075700a2020202020202020202077686572652075702e757365725f6964203d20617574682e75696428290a202020202020202029203c3e2028617574682e6a777428292d3e3e272774656e616e745f69642727293a3a757569643b0a27"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260128101556_create_workspace_rpc.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- create_workspace RPC (required by app)\ncreate or replace function public.create_workspace(p_workspace_name text)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nset search_path = public\nas $fn$\ndeclare\n  v_tenant_id uuid;\nbegin\n  if auth.uid() is null then\n    raise exception 'not_authenticated';\n  end if;\n\n  if p_workspace_name is null or btrim(p_workspace_name) = '' then\n    raise exception 'workspace_name_required';\n  end if;\n\n  insert into public.tenants (name)\n  values (btrim(p_workspace_name))\n  returning id into v_tenant_id;\n\n  insert into public.tenant_memberships (tenant_id, user_id, role, tier, status)\n  values (v_tenant_id, auth.uid(), 'owner', 'core', 'active');\n\n  update public.user_profiles\n     set current_tenant_id = v_tenant_id\n   where user_id = auth.uid();\n\n  return v_tenant_id;\nend;\n$fn$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_workspace(text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260128101556"},{"text":"create_workspace_rpc"},{"binary":"0000000100000000000000190000000200000001000003342d2d206372656174655f776f726b7370616365205250432028726571756972656420627920617070290a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6372656174655f776f726b737061636528705f776f726b73706163655f6e616d652074657874290a72657475726e7320757569640a6c616e677561676520706c706773716c0a736563757269747920646566696e65720a736574207365617263685f70617468203d207075626c69630a61732024666e240a6465636c6172650a2020765f74656e616e745f696420757569643b0a626567696e0a2020696620617574682e7569642829206973206e756c6c207468656e0a20202020726169736520657863657074696f6e20276e6f745f61757468656e74696361746564273b0a2020656e642069663b0a0a2020696620705f776f726b73706163655f6e616d65206973206e756c6c206f7220627472696d28705f776f726b73706163655f6e616d6529203d202727207468656e0a20202020726169736520657863657074696f6e2027776f726b73706163655f6e616d655f7265717569726564273b0a2020656e642069663b0a0a2020696e7365727420696e746f207075626c69632e74656e616e747320286e616d65290a202076616c7565732028627472696d28705f776f726b73706163655f6e616d6529290a202072657475726e696e6720696420696e746f20765f74656e616e745f69643b0a0a2020696e7365727420696e746f207075626c69632e74656e616e745f6d656d6265727368697073202874656e616e745f69642c20757365725f69642c20726f6c652c20746965722c20737461747573290a202076616c7565732028765f74656e616e745f69642c20617574682e75696428292c20276f776e6572272c2027636f7265272c202761637469766527293b0a0a2020757064617465207075626c69632e757365725f70726f66696c65730a20202020207365742063757272656e745f74656e616e745f6964203d20765f74656e616e745f69640a202020776865726520757365725f6964203d20617574682e75696428293b0a0a202072657475726e20765f74656e616e745f69643b0a656e643b0a24666e24000000486772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f776f726b737061636528746578742920746f2061757468656e74696361746564"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"CREATE FUNCTION"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"GRANT"}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"INSERT 0 1"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
Applying migration 20260128140341_rpc_signature_align.sql...
2026/01/28 15:06:13 PG Send: {"Type":"Query","String":"RESET ALL"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"RESET"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"I"}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- Align RPC signatures with app payload keys (PostgREST requires param names)\r\n-- No \r\n\r\nbegin","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- A) accept_invite_rpc(text) currently has param name token; app sends p_token\r\ndo\r\nlanguage plpgsql\r\nas $do$\r\nbegin\r\n  if exists (\r\n    select 1\r\n    from pg_proc p\r\n    join pg_namespace n on n.oid = p.pronamespace\r\n    where n.nspname = 'public'\r\n      and p.proname = 'accept_invite_rpc'\r\n      and pg_get_function_identity_arguments(p.oid) = 'token text'\r\n  ) then\r\n    execute 'alter function public.accept_invite_rpc(text) rename to accept_invite_rpc__v1'\r\n$do$","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"end if","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"end","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"';\r\n\r\ncreate or replace function public.accept_invite_rpc(p_token text)\r\nreturns jsonb\r\nlanguage sql\r\nsecurity definer\r\nset search_path = public\r\nas 'select public.accept_invite_rpc__v1(p_token)","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"';\r\n\r\ngrant execute on function public.accept_invite_rpc(text) to authenticated;\r\n\r\n-- B) revoke_invite_rpc(uuid) currently has param name invite_id; app sends p_invite_id\r\ndo\r\nlanguage plpgsql\r\nas $do$\r\nbegin\r\n  if exists (\r\n    select 1\r\n    from pg_proc p\r\n    join pg_namespace n on n.oid = p.pronamespace\r\n    where n.nspname = 'public'\r\n      and p.proname = 'revoke_invite_rpc'\r\n      and pg_get_function_identity_arguments(p.oid) = 'invite_id uuid'\r\n  ) then\r\n    execute 'alter function public.revoke_invite_rpc(uuid) rename to revoke_invite_rpc__v1'\r\n$do$;\r\n  end if;\r\nend;\r\n'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"create or replace function public.revoke_invite_rpc(p_invite_id uuid)\r\nreturns jsonb\r\nlanguage sql\r\nsecurity definer\r\nset search_path = public\r\nas 'select public.revoke_invite_rpc__v1(p_invite_id);'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.revoke_invite_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- C) create_invite_rpc(text) wrapper: app sends only p_invited_email (tenant comes from current_tenant_id())\r\ncreate or replace function public.create_invite_rpc(p_invited_email text)\r\nreturns jsonb\r\nlanguage sql\r\nsecurity definer\r\nset search_path = public\r\nas 'select public.create_invite_rpc(public.current_tenant_id(), p_invited_email);'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.create_invite_rpc(text) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"-- D) set_current_tenant_rpc(uuid): app sends p_tenant_id\r\ncreate or replace function public.set_current_tenant_rpc(p_tenant_id uuid)\r\nreturns jsonb\r\nlanguage plpgsql\r\nsecurity definer\r\nset search_path = public\r\nas '\r\ndeclare\r\n  v_uid uuid;\r\nbegin\r\n  v_uid := auth.uid();\r\n  if v_uid is null then\r\n    raise exception ''not authenticated'';\r\n  end if;\r\n\r\n  if not exists (\r\n    select 1\r\n    from public.tenant_memberships tm\r\n    where tm.tenant_id = p_tenant_id\r\n      and tm.user_id = v_uid\r\n  ) then\r\n    raise exception ''not a member of tenant'';\r\n  end if;\r\n\r\n  -- Upsert profile current_tenant_id (supports either profiles or profile table)\r\n  if to_regclass(''public.profiles'') is not null then\r\n    insert into public.profiles (user_id, current_tenant_id)\r\n    values (v_uid, p_tenant_id)\r\n    on conflict (user_id) do update\r\n      set current_tenant_id = excluded.current_tenant_id;\r\n  elsif to_regclass(''public.profile'') is not null then\r\n    insert into public.profile (user_id, current_tenant_id)\r\n    values (v_uid, p_tenant_id)\r\n    on conflict (user_id) do update\r\n      set current_tenant_id = excluded.current_tenant_id;\r\n  else\r\n    raise exception ''profile table not found (expected public.profiles or public.profile)'';\r\n  end if;\r\n\r\n  return jsonb_build_object(''ok'', true, ''tenant_id'', p_tenant_id);\r\nend;\r\n'","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"grant execute on function public.set_current_tenant_rpc(uuid) to authenticated","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Recv: {"Type":"ParseComplete"}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Recv: {"Type":"BindComplete"}
2026/01/28 15:06:13 PG Recv: {"Type":"NoData"}
2026/01/28 15:06:13 PG Recv: {"Type":"CommandComplete","CommandTag":"BEGIN"}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"commit","ParameterOIDs":null}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":null,"Parameters":[],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Recv: {"Type":"ErrorResponse","Severity":"ERROR","SeverityUnlocalized":"ERROR","Code":"42601","Message":"syntax error at or near \"as\"","Detail":"","Hint":"","Position":104,"InternalPosition":0,"InternalQuery":"","Where":"","SchemaName":"","TableName":"","ColumnName":"","DataTypeName":"","ConstraintName":"","File":"scan.l","Line":1244,"Routine":"scanner_yyerror","UnknownFields":null}
2026/01/28 15:06:13 PG Send: {"Type":"Parse","Name":"","Query":"INSERT INTO supabase_migrations.schema_migrations(version, name, statements) VALUES($1, $2, $3)","ParameterOIDs":[25,25,1009]}
2026/01/28 15:06:13 PG Send: {"Type":"Bind","DestinationPortal":"","PreparedStatement":"","ParameterFormatCodes":[0,0,1],"Parameters":[{"text":"20260128140341"},{"text":"rpc_signature_align"},{"binary":"0000000100000000000000190000000d000000010000005f2d2d20416c69676e20525043207369676e617475726573207769746820617070207061796c6f6164206b6579732028506f7374675245535420726571756972657320706172616d206e616d6573290d0a2d2d204e6f200d0a0d0a626567696e000001d52d2d204129206163636570745f696e766974655f7270632874657874292063757272656e746c792068617320706172616d206e616d6520746f6b656e3b206170702073656e647320705f746f6b656e0d0a646f0d0a6c616e677561676520706c706773716c0d0a61732024646f240d0a626567696e0d0a202069662065786973747320280d0a2020202073656c65637420310d0a2020202066726f6d2070675f70726f6320700d0a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20702e70726f6e616d6573706163650d0a202020207768657265206e2e6e73706e616d65203d20277075626c6963270d0a202020202020616e6420702e70726f6e616d65203d20276163636570745f696e766974655f727063270d0a202020202020616e642070675f6765745f66756e6374696f6e5f6964656e746974795f617267756d656e747328702e6f696429203d2027746f6b656e2074657874270d0a202029207468656e0d0a20202020657865637574652027616c7465722066756e6374696f6e207075626c69632e6163636570745f696e766974655f7270632874657874292072656e616d6520746f206163636570745f696e766974655f7270635f5f7631270d0a24646f2400000006656e6420696600000003656e64000000c2273b0d0a0d0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6163636570745f696e766974655f72706328705f746f6b656e2074657874290d0a72657475726e73206a736f6e620d0a6c616e67756167652073716c0d0a736563757269747920646566696e65720d0a736574207365617263685f70617468203d207075626c69630d0a6173202773656c656374207075626c69632e6163636570745f696e766974655f7270635f5f763128705f746f6b656e290000024a273b0d0a0d0a6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6163636570745f696e766974655f72706328746578742920746f2061757468656e746963617465643b0d0a0d0a2d2d204229207265766f6b655f696e766974655f7270632875756964292063757272656e746c792068617320706172616d206e616d6520696e766974655f69643b206170702073656e647320705f696e766974655f69640d0a646f0d0a6c616e677561676520706c706773716c0d0a61732024646f240d0a626567696e0d0a202069662065786973747320280d0a2020202073656c65637420310d0a2020202066726f6d2070675f70726f6320700d0a202020206a6f696e2070675f6e616d657370616365206e206f6e206e2e6f6964203d20702e70726f6e616d6573706163650d0a202020207768657265206e2e6e73706e616d65203d20277075626c6963270d0a202020202020616e6420702e70726f6e616d65203d20277265766f6b655f696e766974655f727063270d0a202020202020616e642070675f6765745f66756e6374696f6e5f6964656e746974795f617267756d656e747328702e6f696429203d2027696e766974655f69642075756964270d0a202029207468656e0d0a20202020657865637574652027616c7465722066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f7270632875756964292072656e616d6520746f207265766f6b655f696e766974655f7270635f5f7631270d0a24646f243b0d0a2020656e642069663b0d0a656e643b0d0a27000000c6637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f72706328705f696e766974655f69642075756964290d0a72657475726e73206a736f6e620d0a6c616e67756167652073716c0d0a736563757269747920646566696e65720d0a736574207365617263685f70617468203d207075626c69630d0a6173202773656c656374207075626c69632e7265766f6b655f696e766974655f7270635f5f763128705f696e766974655f6964293b27000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7265766f6b655f696e766974655f72706328757569642920746f2061757468656e74696361746564000001552d2d204329206372656174655f696e766974655f72706328746578742920777261707065723a206170702073656e6473206f6e6c7920705f696e76697465645f656d61696c202874656e616e7420636f6d65732066726f6d2063757272656e745f74656e616e745f69642829290d0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328705f696e76697465645f656d61696c2074657874290d0a72657475726e73206a736f6e620d0a6c616e67756167652073716c0d0a736563757269747920646566696e65720d0a736574207365617263685f70617468203d207075626c69630d0a6173202773656c656374207075626c69632e6372656174655f696e766974655f727063287075626c69632e63757272656e745f74656e616e745f696428292c20705f696e76697465645f656d61696c293b27000000496772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e6372656174655f696e766974655f72706328746578742920746f2061757468656e746963617465640000053c2d2d204429207365745f63757272656e745f74656e616e745f7270632875756964293a206170702073656e647320705f74656e616e745f69640d0a637265617465206f72207265706c6163652066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e745f72706328705f74656e616e745f69642075756964290d0a72657475726e73206a736f6e620d0a6c616e677561676520706c706773716c0d0a736563757269747920646566696e65720d0a736574207365617263685f70617468203d207075626c69630d0a617320270d0a6465636c6172650d0a2020765f75696420757569643b0d0a626567696e0d0a2020765f756964203a3d20617574682e75696428293b0d0a2020696620765f756964206973206e756c6c207468656e0d0a20202020726169736520657863657074696f6e2027276e6f742061757468656e7469636174656427273b0d0a2020656e642069663b0d0a0d0a20206966206e6f742065786973747320280d0a2020202073656c65637420310d0a2020202066726f6d207075626c69632e74656e616e745f6d656d626572736869707320746d0d0a20202020776865726520746d2e74656e616e745f6964203d20705f74656e616e745f69640d0a202020202020616e6420746d2e757365725f6964203d20765f7569640d0a202029207468656e0d0a20202020726169736520657863657074696f6e2027276e6f742061206d656d626572206f662074656e616e7427273b0d0a2020656e642069663b0d0a0d0a20202d2d205570736572742070726f66696c652063757272656e745f74656e616e745f69642028737570706f727473206569746865722070726f66696c6573206f722070726f66696c65207461626c65290d0a2020696620746f5f726567636c6173732827277075626c69632e70726f66696c6573272729206973206e6f74206e756c6c207468656e0d0a20202020696e7365727420696e746f207075626c69632e70726f66696c65732028757365725f69642c2063757272656e745f74656e616e745f6964290d0a2020202076616c7565732028765f7569642c20705f74656e616e745f6964290d0a202020206f6e20636f6e666c6963742028757365725f69642920646f207570646174650d0a2020202020207365742063757272656e745f74656e616e745f6964203d206578636c756465642e63757272656e745f74656e616e745f69643b0d0a2020656c73696620746f5f726567636c6173732827277075626c69632e70726f66696c65272729206973206e6f74206e756c6c207468656e0d0a20202020696e7365727420696e746f207075626c69632e70726f66696c652028757365725f69642c2063757272656e745f74656e616e745f6964290d0a2020202076616c7565732028765f7569642c20705f74656e616e745f6964290d0a202020206f6e20636f6e666c6963742028757365725f69642920646f207570646174650d0a2020202020207365742063757272656e745f74656e616e745f6964203d206578636c756465642e63757272656e745f74656e616e745f69643b0d0a2020656c73650d0a20202020726169736520657863657074696f6e20272770726f66696c65207461626c65206e6f7420666f756e6420286578706563746564207075626c69632e70726f66696c6573206f72207075626c69632e70726f66696c652927273b0d0a2020656e642069663b0d0a0d0a202072657475726e206a736f6e625f6275696c645f6f626a6563742827276f6b27272c20747275652c20272774656e616e745f696427272c20705f74656e616e745f6964293b0d0a656e643b0d0a270000004e6772616e742065786563757465206f6e2066756e6374696f6e207075626c69632e7365745f63757272656e745f74656e616e745f72706328757569642920746f2061757468656e7469636174656400000006636f6d6d6974"}],"ResultFormatCodes":[]}
2026/01/28 15:06:13 PG Send: {"Type":"Describe","ObjectType":"P","Name":""}
2026/01/28 15:06:13 PG Send: {"Type":"Execute","Portal":"","MaxRows":0}
2026/01/28 15:06:13 PG Send: {"Type":"Sync"}
2026/01/28 15:06:13 PG Recv: {"Type":"ReadyForQuery","TxStatus":"E"}
Stopping containers...
2026/01/28 15:06:13 PG Send: {"Type":"Terminate"}
Pruned containers: [4d8a224f8bd817837ce610ed7bfe007213d310cfefa2b66ba9f8c6f153254aa4]
Pruned volumes: [supabase_db_equityflow]
Pruned network: [supabase_network_equityflow]
ERROR: syntax error at or near "as" (SQLSTATE 42601)                           
At statement: 1                                                                
-- A) accept_invite_rpc(text) currently has param name token; app sends p_token
do                                                                             
language plpgsql                                                               
as $do$                                                                        
^                                                                              
EXITCODE: 1
